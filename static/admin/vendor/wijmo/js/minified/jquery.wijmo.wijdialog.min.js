(function(a){var c="ui-state-hover",b="wijmo-wijdialog-defaultdockingzone";a.widget("wijmo.wijdialog",a.ui.dialog,{options:{captionButtons:{},collapsingAnimation:null,expandingAnimation:null,contentUrl:"",minimizeZoneElementId:"",buttonCreating:null,stateChanged:null,blur:null},_create:function(){var d=this,e=d.options;if(window.wijmoApplyWijTouchUtilEvents){a=window.wijmoApplyWijTouchUtilEvents(a)}if(a.isArray(e.buttons)){a.each(e.buttons,function(f,g){var h=g.click;if(h&&(typeof h==="string")&&window[h]){g.click=window[h]}})}d.form=d.element.closest("form[id]");a.ui.dialog.prototype._create.apply(d,arguments);d.uiDialog.addClass("wijmo-wijdialog");d._initWijWindow();d._bindWindowResize();d._attachDraggableResizableEvent();d.originalPosition=e.position;d.isPin=false;if(d.form.length){d.uiDialog.appendTo(d.form)}},_makeDraggable:function(){a.ui.dialog.prototype._makeDraggable.apply(this,arguments);this.uiDialog.draggable("option","cancel",".wijmo-wijdialog-captionbutton")},_handleDisabledOption:function(e,f){var d=this;if(e){if(!d.disabledDiv){d.disabledDiv=d._createDisabledDiv()}d.disabledDiv.appendTo("body");if(a.browser.msie){d.uiDialog.draggable("disable")}}else{if(d.disabledDiv){d.disabledDiv.remove();d.disabledDiv=null;if(a.browser.msie){d.uiDialog.draggable("enable")}}}},_createDisabledDiv:function(){var e=this,h=e.uiDialog,g=h.offset(),f=h.outerWidth(),d=h.outerHeight();return a("<div></div>").addClass("ui-disabled").css({"z-index":"99999",position:"absolute",width:f,height:d,left:g.left,top:g.top})},destroy:function(){var d=this;if(d.disabledDiv){d.disabledDiv.remove();d.disabledDiv=null}a.ui.dialog.prototype.destroy.apply(d,arguments);d.element.unbind(".wijdialog").removeData("wijdialog")},_attachDraggableResizableEvent:function(){var e=this,d=e.uiDialog,f=e.options;if(f.draggable&&d.draggable){d.bind("dragstop",function(g,h){e._saveNormalState();e._destoryIframeMask()}).bind("dragstart",function(g,h){e._createIframeMask()})}if(f.resizable&&d.resizable){d.bind("resizestop",function(g,h){e._saveNormalState();e._destoryIframeMask()}).bind("resizestart",function(g,h){e._createIframeMask()})}},_createIframeMask:function(){var d=this;if(d.innerFrame){d.mask=a("<div style='width:100%;height:100%;position:absolute;top:0px;left:0px;z-index:"+(a.ui.dialog.maxZ+1)+"'></div>").appendTo(d.uiDialog)}},_destoryIframeMask:function(){var d=this;if(d.innerFrame&&d.mask){d.mask.remove();d.mask=undefined}},_initWijWindow:function(){var d=this,e=true;d._createCaptionButtons();d._checkUrl();d.uiDialog.bind("mousedown",function(g){var f=g.target;if(!a.contains(d.element[0],f)){d.uiDialog.focus()}}).bind("mouseenter",function(f){e=true}).bind("mouseleave",function(f){e=false}).bind("focusout",function(f){if(!e){d._trigger("blur",f,{el:d.element})}})},_checkUrl:function(){var d=this,g=d.options,e=g.contentUrl,f=a('<iframe style="width:100%;height:99%;" frameborder="0"></iframe>');if(typeof e==="string"&&e.length>0){d.element.addClass("wijmo-wijdialog-hasframe");d.element.append(f);d.innerFrame=f}d.contentWrapper=d.element},_setOption:function(e,f){var d=this;a.ui.dialog.prototype._setOption.apply(d,arguments);if(e==="disabled"){d._handleDisabledOption(f,d.element)}else{if(e==="contentUrl"){if(d.innerFrame){d.innerFrame.attr("src",f)}else{d._checkUrl()}}else{if(e="captionButtons"){d._createCaptionButtons()}}}},_createCaptionButtons:function(){var h=[],d=this,k=d.options,e,g={pin:{visible:true,click:d.pin,iconClassOn:"ui-icon-pin-w",iconClassOff:"ui-icon-pin-s"},refresh:{visible:true,click:d.refresh,iconClassOn:"ui-icon-refresh"},toggle:{visible:true,click:d.toggle,iconClassOn:"ui-icon-carat-1-n",iconClassOff:"ui-icon-carat-1-s"},minimize:{visible:true,click:d.minimize,iconClassOn:"ui-icon-minus"},maximize:{visible:true,click:d.maximize,iconClassOn:"ui-icon-extlink"},close:{visible:true,click:d.close,iconClassOn:"ui-icon-close"}},f=k.captionButtons,j=d.uiDialogTitlebar;j.children(".ui-dialog-titlebar-close, .wijmo-wijdialog-captionbutton").remove();a.each(g,function(i,l){if(f&&f[i]){a.extend(l,f[i])}h.push({button:i,info:l})});d._trigger("buttonCreating",null,h);for(e=0;e<h.length;e++){d._createCaptionButton(h[e],j)}},_createCaptionButton:function(g,d,i){var l=this,f,k="wijmo-wijdialog-titlebar-"+g.button,h=d.children("."+k),e=g.info,j=a("<span></span>");if(e.visible){if(h.size()===0){j.addClass("ui-icon "+e.iconClassOn).text(e.text||g.button);f=a('<a href="#"></a>').append(j).addClass(k+" ui-corner-all wijmo-wijdialog-captionbutton").attr("role","button").hover(function(){f.addClass(c)},function(){f.removeClass(c)}).click(function(m){if(g.button=="close"){m.preventDefault()}if(j.hasClass(e.iconClassOff)){j.removeClass(e.iconClassOff)}else{j.addClass(e.iconClassOff)}if(a.isFunction(e.click)){e.click.apply(l,arguments)}return false});if(i){return f}else{f.appendTo(d)}}l[g.button+"Button"]=f}else{h.remove()}},pin:function(){var e=this.isPin,d=this.pinButton.children("span");if(!e){if(d.length){if(!d.hasClass("ui-icon-pin-s")){d.addClass("ui-icon-pin-s")}}}else{d.removeClass("ui-icon-pin-s")}this._enableDisableDragger(!e);this.isPin=!e},refresh:function(){var d=this.innerFrame;if(d!==undefined){d.attr("src",d.attr("src"))}},toggle:function(){var e=this,d=e.toggleButton.children("span");if(!e.minimized){if(e.collapsed===undefined||!e.collapsed){e.collapsed=true;if(!d.hasClass("ui-icon-carat-1-s")){d.addClass("ui-icon-carat-1-s")}e._collapseDialogContent(true)}else{e.collapsed=false;if(d.hasClass("ui-icon-carat-1-s")){d.removeClass("ui-icon-carat-1-s")}e._expandDialogContent(true)}}},_expandDialogContent:function(f){var e=this,g=e.options,d=g.expandingAnimation;e.uiDialog.height("auto");if(f&&d!==null){e.contentWrapper.show(d.animated,d.options,d.duration,function(h){e.uiDialog.css("height",e._toggleHeight);if(a.isFunction(d.callback)){d.callback(h)}if(g.resizable){e._enableDisableResizer(false)}})}else{e.contentWrapper.show();if(g.resizable){e._enableDisableResizer(false)}e.uiDialog.css("height",e.toggleHeight)}},_collapseDialogContent:function(f){var e=this,g=e.options,d=g.collapsingAnimation;if(g.resizable){e._enableDisableResizer(true)}e._toggleHeight=e.uiDialog[0].style.height;e.uiDialog.height("auto");if(f&&d!==null){e.contentWrapper.hide(d.animated,d.options,d.duration)}else{e.contentWrapper.hide()}e._enableDisableDragger(e.isPin)},_enableDisableResizer:function(d){var e=this.uiDialog;if(!this.options.resizable){return}e.resizable({disabled:d});if(d){e.removeClass("ui-state-disabled")}},_enableDisableDragger:function(d){var e=this.uiDialog;if(!this.options.draggable){return}e.draggable({disabled:d});if(d){e.removeClass("ui-state-disabled")}},minimize:function(){var r=this,n=r.uiDialog,f=r.options,d=null,p=a("<div></div>"),m=a("<div></div>"),j,g,q,i,k={},h,s={},l="uiDialog",e;if(!r.minimized){i=r.uiDialog.position();k.width=r.uiDialog.width();k.height=r.uiDialog.height();e=r.getState();if(r.maximized){r.maximized=false;r.restoreButton.remove();a(window).unbind(".onWinResize")}else{if(r.collapsed){r._expandDialogContent(false)}r._saveNormalState()}r._enableDisableResizer(true);if(r.collapsed){r._collapseDialogContent(false)}p.appendTo(document.body).css({top:r.uiDialog.offset().top,left:r.uiDialog.offset().left,height:r.uiDialog.innerHeight(),width:r.uiDialog.innerWidth(),position:"absolute"});r.contentWrapper.hide();if(r.uiDialogButtonPane.length){r.uiDialogButtonPane.hide()}n.height("auto");n.width("auto");r._doButtonAction(r.minimizeButton,"hide");r._restoreButton(true,r.minimizeButton,"After");r._doButtonAction(r.pinButton,"hide");r._doButtonAction(r.refreshButton,"hide");r._doButtonAction(r.toggleButton,"hide");r._doButtonAction(r.maximizeButton,"show");if(a.browser.webkit){a(".wijmo-wijdialog-captionbutton",r.uiDialog).css("float","left")}if(r.innerFrame){l="copy";r[l]=r.uiDialog.clone();r[l].empty();r.uiDialogTitlebar.appendTo(r[l])}if(f.minimizeZoneElementId.length>0){d=a("#"+f.minimizeZoneElementId)}if(d!==null&&d.size()>0){d.append(r[l])}else{j=a("."+b);if(j.size()===0){j=a('<div class="'+b+'"></div>');a(document.body).append(j)}j.append(r[l]).css("z-index",n.css("z-index"))}r[l].css("position","static");r[l].css("float","left");if(a.browser.msie&&a.browser.version==="6.0"){g=a(document).scrollTop();q=document.documentElement.clientHeight-j.height()+g;j.css({position:"absolute",left:"0px",top:q})}m.appendTo(document.body).css({top:r[l].offset().top,left:r[l].offset().left,height:r[l].innerHeight(),width:r[l].innerWidth(),position:"absolute"});r.uiDialog.hide();if(r.innerFrame){r[l].hide()}p.effect("transfer",{to:m,className:"ui-widget-content"},100,function(){p.remove();m.remove();r[l].show();r.minimized=true;h=r.uiDialog.position();s.width=r.uiDialog.width();s.height=r.uiDialog.height();r._enableDisableDragger(true);r._trigger("resize",null,{originalPosition:i,originalSize:k,position:h,size:s});r._trigger("stateChanged",null,{originalState:e,state:"minimized"})})}},_doButtonAction:function(d,e){if(d!==undefined){d.removeClass(c);d[e]()}},maximize:function(){var f=this,e=a(window),i,h={},d,g={},j;if(!f.maximized){f._enableDisableDragger(false);i=f.uiDialog.position();h.width=f.uiDialog.width();h.height=f.uiDialog.height();if(f.minimized){f.restore()}else{if(f.collapsed){f._expandDialogContent(false)}f._saveNormalState();j="normal"}f.maximized=true;if(f.maximizeButton!==undefined){f.maximizeButton.hide();f._restoreButton(true,f.maximizeButton,"Before")}if(a.browser.webkit){a(".wijmo-wijdialog-captionbutton").css("float","")}f._onWinResize(f,e);if(f.collapsed){f._collapseDialogContent(false)}if(!f.collapsed){f._enableDisableDragger(true)}f._enableDisableResizer(true);d=f.uiDialog.position();g.width=f.uiDialog.width();g.height=f.uiDialog.height();f._trigger("resize",null,{originalPosition:i,originalSize:h,position:d,size:g});if(j==="normal"){f._trigger("stateChanged",null,{originalState:"normal",state:"maximized"})}}},_bindWindowResize:function(){var e=this,d=a(window),h,g,f;d.resize(function(){if(e.maximized){e._onWinResize(e,d)}});if(a.browser.msie&&a.browser.version==="6.0"){d.bind("scroll.wijdialog resize.wijdialog",function(){if(e.minimized){g=a(document).scrollTop();f=e.uiDialog.parent();h=document.documentElement.clientHeight-f.height()+g;f.css({top:h})}})}},_saveNormalState:function(){var d=this,e=d.uiDialog,f=d.element;if(!d.maximized){d.normalWidth=e.css("width");d.normalLeft=e.css("left");d.normalTop=e.css("top");d.normalHeight=e.css("height");d.normalInnerHeight=f.css("height");d.normalInnerWidth=f.css("width");d.normalInnerMinWidth=f.css("min-width");d.normalInnerMinHeight=f.css("min-height")}},_onWinResize:function(e,d){e.uiDialog.css("top",d.scrollTop());e.uiDialog.css("left",d.scrollLeft());e.uiDialog.setOutWidth(d.width());e.uiDialog.setOutHeight(d.height());e.options.width=e.uiDialog.width();e.options.height=e.uiDialog.height();e._size();if(e.collapsed){e.uiDialog.height("auto");e.contentWrapper.hide()}},_restoreButton:function(e,g,d){var f=this,i={button:"restore",info:{visible:e,click:f.restore,iconClassOn:"ui-icon-newwin"}},h=f._createCaptionButton(i,f.uiDialogTitlebar,true);if(e){h["insert"+d](g);f.restoreButton=h}},_appendToBody:function(d){if(!this.innerFrame){d.appendTo(document.body)}else{this.uiDialogTitlebar.prependTo(d);d.show()}},restore:function(){var l=this,j=l.uiDialog,e,g={},f,m={},k=a("<div></div>"),i=a("<div></div>"),h="uiDialog",d;if(l.minimized){l.minimized=false;if(l.innerFrame){h="copy";if(!l[h]){h="uiDialog"}}e=l[h].position();g.width=l[h].width();g.height=l[h].height();k.appendTo(document.body).css({top:l[h].offset().top,left:l[h].offset().left,height:l[h].innerHeight(),width:l[h].innerWidth(),position:"absolute"});j.css("position","absolute");j.css("float","");l._appendToBody(j);l._enableDisableResizer(false);if(!l.isPin){l._enableDisableDragger(false)}l._restoreToNormal();l.contentWrapper.show();if(l.uiDialogButtonPane.length){l.uiDialogButtonPane.show()}i.appendTo(document.body).css({top:l.uiDialog.offset().top,left:l.uiDialog.offset().left,height:l.uiDialog.innerHeight(),width:l.uiDialog.innerWidth(),position:"absolute"});l.uiDialog.hide();k.effect("transfer",{to:i,className:"ui-widget-content"},150,function(){l.uiDialog.show();f=l.uiDialog.position();m.width=l.uiDialog.width();m.height=l.uiDialog.height();k.remove();i.remove();if(l.copy){l.copy.remove()}l._trigger("resize",null,{originalPosition:e,originalSize:g,position:f,size:m});d=l.getState();l._trigger("stateChanged",null,{originalState:"minimized",state:d})});if(l.collapsed){l._collapseDialogContent()}l._doButtonAction(l.minimizeButton,"show");l._doButtonAction(l.restoreButton,"remove");l._doButtonAction(l.pinButton,"show");l._doButtonAction(l.refreshButton,"show");l._doButtonAction(l.toggleButton,"show");if(a.browser.webkit){a(".wijmo-wijdialog-captionbutton").css("float","")}}else{if(l.maximized){l.maximized=false;e=l.uiDialog.position();g.width=l.uiDialog.width();g.height=l.uiDialog.height();a(window).unbind(".onWinResize");if(l.collapsed){l._expandDialogContent()}l._enableDisableResizer(false);if(!l.isPin){l._enableDisableDragger(false)}l._restoreToNormal();l.contentWrapper.show();if(l.collapsed){l._collapseDialogContent()}if(l.maximizeButton!==undefined){l.maximizeButton.show();l._restoreButton(false,l.maximizeButton,"before")}f=l.uiDialog.position();m.width=l.uiDialog.width();m.height=l.uiDialog.height();l._trigger("resize",null,{originalPosition:e,originalSize:g,position:f,size:m});d=l.getState();l._trigger("stateChanged",null,{originalState:"maximized",state:d})}}},getState:function(){var d=this;return d.minimized?"minimized":(d.maximized?"maximized":"normal")},reset:function(){var d=this;d.normalWidth=d.normalLeft=d.normalTop=d.normalHeight=d.normalInnerHeight=d.normalInnerWidth=d.normalInnerMinWidth=d.normalInnerMinHeight=undefined;d._setOption("position",d.originalPosition)},open:function(){var d=this,e=d.options;if((e.hide==="drop"||e.hide==="bounce")&&a.browser.msie){d.uiDialog.css("filter","auto")}if(!d.innerFrame){if(!d.minimized){a.ui.dialog.prototype.open.apply(d,arguments)}else{d.uiDialog.show();d._isOpen=true}d.uiDialog.wijTriggerVisibility()}else{d.innerFrame.attr("src",e.contentUrl);if(!d.minimized){a.ui.dialog.prototype.open.apply(d,arguments)}else{d.uiDialogTitlebar.show();d._isOpen=true}}if(d.collapsed){d._collapseDialogContent()}if(e.disabled){if(d.disabledDiv){d.disabledDiv.show()}else{d.disable()}}},close:function(){var d=this,e=d.options;if(a.ui.dialog.prototype.close.apply(d,arguments)){if(d.innerFrame){d.innerFrame.attr("src","");if(d.minimized){d.uiDialogTitlebar.hide()}}if(d.disabledDiv&&e.disabled){d.disabledDiv.hide()}}},_restoreToNormal:function(){var d=this,e=d.uiDialog,f=d.element;e.css("width",d.normalWidth);e.css("left",d.normalLeft);e.css("top",d.normalTop);e.css("height",d.normalHeight);f.css("height",d.normalInnerHeight);f.css("width",d.normalInnerWidth);f.css("min-width",d.normalInnerMinWidth);f.css("min-height",d.normalInnerMinHeight);d.options.width=d.uiDialog.width();d.options.height=d.uiDialog.height()}});a.extend(a.ui.dialog.overlay,{create:function(e){a.ui.dialog.latestDlg=e;if(this.instances.length===0){setTimeout(function(){if(a.ui.dialog.overlay.instances.length){a(document).bind(a.ui.dialog.overlay.events,function(f){if(a(f.target).zIndex()<a.ui.dialog.overlay.maxZ&&!a.contains(a.ui.dialog.latestDlg.element[0],f.target)){return false}})}},1);a(document).bind("keydown.dialog-overlay",function(f){if(e.options.closeOnEscape&&!f.isDefaultPrevented()&&f.keyCode&&f.keyCode===a.ui.keyCode.ESCAPE){e.close(f);f.preventDefault()}});a(window).bind("resize.dialog-overlay",a.ui.dialog.overlay.resize)}var d=(this.oldInstances.pop()||a("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});if(a.fn.bgiframe){d.bgiframe()}this.instances.push(d);return d},height:function(){var e,d;if(a.browser.msie){e=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);d=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);if(e<d){return a(window).height()+"px"}else{return e+"px"}}else{return a(document).height()+"px"}},width:function(){var d,e;if(a.browser.msie){d=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);e=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);if(d<e){return a(window).width()+"px"}else{return d+"px"}}else{return a(document).width()+"px"}}})}(jQuery));