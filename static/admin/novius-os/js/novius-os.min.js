/**
 * NOVIUS OS - Web OS for digital communication
 *
 * @copyright  2011 Novius
 * @license    GNU Affero General Public License v3 or (at your option) any later version
 *             http://www.gnu.org/licenses/agpl-3.0.html
 * @link http://www.novius-os.org
 */
define("jquery-nos",["jquery","log","order!jquery-ui","order!wijmo-open","order!wijmo-complete"],function(d){var f=void (0),e=window.$nos=d.sub(),a=f,b=function(){if(a===f){a=e(".nos-ostabs")}return a},c={dialogOpened:[],dialogFocused:-1,open:function(i){var g=this,h=i.data("callbacks.nosdialog");g.dialogOpened.push(i[0]);if(!d.isPlainObject(h)){i.data("callbacks.nosdialog",{})}},focus:function(j){var g=this,i=j.data("callbacks.nosdialog"),h=d.inArray(j[0],g.dialogOpened);if(h!==-1){g.dialogOpened.splice(h,1)}g.dialogOpened.push(j[0]);g.dialogFocused=j[0];if(d.isPlainObject(i)){d.each(i,function(k,l){g.fireDialogEvent(j,l)});j.data("callbacks.nosdialog",{})}},close:function(i){var g=this,h=d.inArray(i[0],g.dialogOpened);if(h!==-1){g.dialogOpened.splice(h,1)}if(h>0){g.focus(d(g.dialogOpened[h-1]))}},fireDialogEvent:function(h,g){var j=h.find("> iframe");var i=d.Event(g.event,{namespace:g.type||null,data:g.data||null});if(j.size()){if(j[0].contentDocument.$){j[0].contentDocument.$("body").trigger(i)}}else{try{h.trigger(i)}catch(i){log(i)}}},dispatchEvent:function(h){var g=this;if(!d.isPlainObject(h)){h={event:h}}d.each(g.dialogOpened,function(){var j=d(this);if(this===g.dialogFocused){g.fireDialogEvent(j,h)}else{var i=j.data("callbacks.nosdialog");if(d.isPlainObject(i)){i[h.event+(h.type?"."+h.type:"")]=h}}})}};e.extend({dispatchEvent:function(g){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos.dispatchEvent(g)}b().ostabs("dispatchEvent",g);c.dispatchEvent(g);return e},notify:function(g,h){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos.notify(g,h)}if(!d.isPlainObject(g)){g={title:g}}if(h!==f){d.extend(g,d.isPlainObject(h)?h:{type:h})}if(d.isPlainObject(g)){require(["link!static/novius-os/admin/vendor/jquery/pnotify/jquery.pnotify.default.css","static/novius-os/admin/vendor/jquery/pnotify/jquery.pnotify"],function(){var i={pnotify_history:false,pnotify_addclass:"nos-notification"};d.each(g,function(j,k){if(j.substr(0,8)!=="pnotify_"){j="pnotify_"+j}i[j]=k});return d.pnotify(i)})}return false}});e.fn.extend({xhr:function(){var m=Array.prototype.slice.call(arguments),g="request";if(m.length>0&&d.inArray(m[0],["request","success","error","saveUserConfig"])!==-1){g=m.shift()}switch(g){case"request":var r=d.extend({dataType:"json",type:"POST",data:{}},m[0]||{}),i=r.success,k=r.error,q=this;if(r.dataType=="json"){r.success=function(s){if(d.isFunction(i)){s.user_success=i}q.xhr("success",s)};r.error=function(s){q.xhr("error",s);if(d.isFunction(k)){k.apply(this,m)}}}return d.ajax(r);break;case"success":var p=m[0];if(p.error){if(d.isArray(p.error)){d.each(p.error,function(){e.notify(this,"error")})}else{e.notify(p.error,"error")}}if(p.notify){if(d.isArray(p.notify)){d.each(p.notify,function(){e.notify(this)})}else{e.notify(p.notify)}}if(d.isFunction(p.user_success)){p.user_success.apply(this,m)}var l=this.closest(".ui-dialog-content").size();if(l){if(p.closeTab){this.tab("close")}}else{if(p.redirect){document.location.href=p.redirect}if(p.replaceTab){this.tab("update",{url:p.replaceTab})}}if(p.dispatchEvent){if(d.isArray(p.dispatchEvent)){d.each(p.dispatchEvent,function(s,t){e.dispatchEvent(t)})}else{e.dispatchEvent(p.dispatchEvent)}}break;case"error":var n=m[0],j=m[1];if(n.status!=0){e.notify("Connection error!","error")}else{if(j=="parsererror"){e.notify("Request seemed a success, but we could not read the answer.")}else{if(j=="timeout"){e.notify("Time out (server is busy?). Please try again.")}}}break;case"saveUserConfig":var o=m[0],h=m[1];this.xhr({url:"/admin/nos/noviusos/save_user_configuration",data:{key:o,configuration:h}});break}return this},media:function(j){j=j||{};var g={all:"/admin/nos/media/list",image:"/admin/nos/media/list?view=image_pick"},k=this;var i=null;var h=d.extend({title:k.attr("title")||"File",allowDelete:true,choose:function(){if(i===null){i=k.dialog({destroyOnClose:false,contentUrl:g[j.mode],ajax:true,title:"Choose a media file"});i.bind("select.media",function(m,l){k.inputFileThumb({file:l.thumbnail});k.val(l.id);i.dialog("close")})}else{i.dialog("open")}}},j.inputFileThumb||{});require(["static/novius-os/admin/vendor/jquery/jquery-ui-input-file-thumb/js/jquery.input-file-thumb","link!static/novius-os/admin/vendor/jquery/jquery-ui-input-file-thumb/css/jquery.input-file-thumb.css"],function(){d(function(){k.inputFileThumb(h)})})},form:function(){var h=Array.prototype.slice.call(arguments),j="ui",g=this;if(h.length>0&&d.inArray(h[0],["ui","validate","ajax"])!==-1){j=h.shift()}switch(j){case"ui":g.find(":input[type='text'],:input[type='password'],:input[type='email'],textarea").wijtextbox();g.find(":input[type='submit'],button").each(function(){var k={};var l=d(this).data("icon");if(l){k.icons={primary:"ui-icon-"+l}}d(this).button(k)});g.find("select").filter(":not(.notransform)").nos().initOnShow("init",function(){d(this).wijdropdown()});g.find(":input[type=checkbox]").nos().initOnShow("init",function(){d(this).wijcheckbox()});g.find(".expander").each(function(){var k=d(this);k.wijexpander(d.extend({expanded:true},k.data("wijexpander-options")))});g.find(".accordion").wijaccordion({header:"h3",selectedIndexChanged:function(l,k){d(l.target).find(".ui-accordion-content").eq(k.newIndex).nos().initOnShow()}});break;case"validate":var i=h[0]||{};if(!g.is("form")){g=g.find("form")}require(["jquery-validate"],function(){g.validate(d.extend({},i,{errorClass:"ui-state-error",success:true,ignore:"input[type=hidden]"}))});break;case"ajax":if(!g.is("form")){g=g.find("form")}require(["jquery-form"],function(){g.ajaxForm({dataType:"json",success:function(k){g.xhr("success",k).triggerHandler("ajax_success",[k])},error:function(){e.notify("An error occured","error")}})});break}return this},initOnShow:function(){var g=Array.prototype.slice.call(arguments),i="show";if(g.length>0&&d.inArray(g[0],["init","show"])!==-1){i=g.shift()}switch(i){case"init":var h=g[0];if(!d.isFunction(h)){return}this.each(function(){var j=d(this);if(j.is(":visible")){h.call(j)}else{j.addClass("nos-init-on-show").data("nos-init-on-show",h)}});break;case"show":this.find(".nos-init-on-show:visible").each(function(){var j=d(this),k=j.data("nos-init-on-show");j.removeClass("nos-init-on-show");k.call(this)});break}return this},dialog:function(){var k=Array.prototype.slice.call(arguments),g="open";if(k.length>0&&d.inArray(k[0],["open","close"])!==-1){g=k.shift()}switch(g){case"open":if(this.is(".ui-dialog")){this.wijdialog("open");return this}var o=k[0]||{},p=d.extend(true,{},{destroyOnClose:true,width:window.innerWidth-200,height:window.innerHeight-100,modal:true,captionButtons:{pin:{visible:false},refresh:{visible:o.contentUrl!=null&&!o.ajax},toggle:{visible:false},minimize:{visible:false},maximize:{visible:false}}},o),l={open:p.open,close:p.close,focus:p.focus},m=this.closest(".nos-dispatcher, body"),n=this,h=d("<div></div>").addClass("nos-dispatcher").appendTo(m);d.extend(p,{close:function(r,q){c.close(h);if(d.isFunction(l.close)){l.close.apply(h,arguments)}if(p.destroyOnClose){h.wijdialog("destroy").remove()}else{h.closest(".ui-dialog").hide().appendTo(m)}},focus:function(r,q){c.focus(h);if(d.isFunction(l.focus)){l.focus.apply(h,arguments)}},open:function(r,q){c.open(h);if(d.isFunction(l.open)){l.open.apply(h,arguments)}if(!p.destroyOnClose){h.closest(".ui-dialog").appendTo("body")}}});if(p.content!==f){h.append(p.content)}var j=true;if(p.ajax){var i=p.contentUrl;delete p.contentUrl;p.autoOpen=false;h.wijdialog(p);d.ajax({url:i,type:"GET",dataType:"html",complete:function(s,q,t){t=s.responseText;if(s.isResolved()){s.done(function(v){t=v});try{var r=d.parseJSON(t);j=false}catch(u){}if(j){h.wijdialog("open").html(t)}else{h.empty().wijdialog("destroy").remove();n.xhr("success",r)}}}})}else{h.wijdialog(p)}if(j&&d.isFunction(p.onLoad)){p.onLoad()}return h;break;case"close":this.closest(":wijmo-wijdialog").wijdialog("close");break}return this},listenEvent:function(g,h){this.closest(".nos-dispatcher, body").on(g,h)},tab:function(){var h=Array.prototype.slice.call(arguments),j="open",i=function(k){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos(window.frameElement).data("nos-ostabs-index")}var l=d(k).parents(".nos-ostabs-panel-content");if(l.size()){return l.data("nos-ostabs-index")}return false},g=this;if(h.length>0&&d.inArray(h[0],["open","close","add","update","init"])!==-1){j=h.shift()}switch(j){case"open":(function(){var n=h[0]||{},m=h[1]||{},l=g.closest(".ui-dialog-content").size();if(l){g.dialog(d.extend({contentUrl:n.url,ajax:!n.iframe,title:n.label},m))}else{if(window.parent!=window&&window.parent.$nos){window.parent.$nos(window.frameElement).tab("open",n,m)}else{if(b().length){var k=b().ostabs("tabs"),o=false;d.each(k,function(q,p){if(p.url===n.url){o=q;return false}});if(o!==false){return b().ostabs("select",o+4)}else{g.tab("add",n)}}else{if(n.url){window.open(n.url)}}}}})();break;case"add":(function(){var m=h[0],k=h[1]||"end";if(window.parent!=window&&window.parent.$nos){window.parent.$nos(window.frameElement).tab("add",m,k)}else{var l;if(d.inArray(k,["before","after"])!==-1){l=i(g)+(k==="before"?-1:1)}if(b().length){l=b().ostabs("add",m,l);b().ostabs("select",l)}else{if(m.url){window.open(m.url)}}}})();break;case"close":(function(){var l=g.closest(":wijmo-wijdialog");if(l.size()){g.dialog("close")}else{if(window.parent!=window&&window.parent.$nos){window.parent.$nos(window.frameElement).tab("close")}else{var k=i(g);if(b().length){b().ostabs("remove",k)}}}})();break;case"update":(function(){var l=h[0];if(window.parent!=window&&window.parent.$nos){window.parent.$nos(window.frameElement).tab("update",l)}else{if(g.size()&&!g.closest(".ui-dialog-content").size()&&b().length){var k=i(g);b().ostabs("update",k,l)}}})();break;case"init":(function(){var l=h[0],k=function(){if(b().length){b().xhr("saveUserConfig","tabs",{selected:a.ostabs("option","selected"),tabs:a.ostabs("tabs")})}};a=g;d.extend(l,{add:k,remove:k,select:k,show:k,drag:k});if(l.user_configuration["tabs"]){if(!l.options){l.options={}}l.initTabs=l.user_configuration["tabs"]["tabs"];l.selected=l.user_configuration["tabs"]["selected"]}a.ostabs(l)})();break}return this}});d.fn.nos=function(){return e(this)};return e});
define("jquery-nos-loadspinner",["jquery","log","order!jquery-ui","order!wijmo-open","order!wijmo-complete","order!jquery-nos"],function(g,f,e,j,i,h){g.widget("nos.loadspinner",{options:{diameter:40,color:null,density:40,range:1.3,scaling:false,fading:true,shape:"circle",speed:2,fps:24},shapes:["circle","square","rectangle","roundedRectangle"],colorReg:/^\#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,colorRgb:/^rgb\((\d+)[ \,]+(\d+)[ \,]+(\d+)\)$/,UISpinnerCanvas:null,UISpinnerContext:null,UISpinnerCacheCanvas:null,UISpinnerCacheContext:null,running:false,ready:false,timer:null,activeId:0,colorRGB:null,_create:function(){this.UISpinnerCanvas=g("<canvas></canvas>").attr("id","CanvasLoader").get(0);this.UISpinnerContext=this.UISpinnerCanvas.getContext("2d");this.element.append(this.UISpinnerCanvas);this.UISpinnerCanvas.width=this.UISpinnerCanvas.height=this.options.diameter;this.UISpinnerCacheCanvas=g("<canvas></canvas>").get(0);g("body").append(this.UISpinnerCacheCanvas);this.UISpinnerCacheContext=this.UISpinnerCacheCanvas.getContext("2d");this.UISpinnerCacheCanvas.width=this.UISpinnerCacheCanvas.height=this.options.diameter;g(this.UISpinnerCacheCanvas).hide()},_init:function(){if(!this.options.color){this.options.color=this.element.css("color")}this._setOption("color",this.options.color);this.ready=true;this._draw();this.start()},_setOption:function(b,c){var a=this;switch(b){case"diameter":if(isNaN(c)){return}c=Math.round(Math.abs(c));break;case"color":this.colorRGB=this._RGB(c);break;case"shape":if(g.inArray(c,this.shapes)==-1){return}break;case"density":if(isNaN(c)){return}c=Math.round(Math.abs(c));break;case"range":if(isNaN(c)){return}c=Math.abs(c);break;case"speed":if(isNaN(c)&&Math.abs(c)>0){return}c=Math.round(Math.abs(c));break;case"fps":if(isNaN(c)){return}c=Math.round(Math.abs(c));break}g.Widget.prototype._setOption.apply(a,arguments);if(g.inArray(b,["diameter","color","shape","density","range","scaling","fading"])!=-1){this._redraw()}else{if(g.inArray(b,["speed","fps"])!=-1){this._reset()}}},_RGB:function(b){var a={};if(this.colorReg.test(b)){b=b.charAt(0)==="#"?b.substring(1,7):b;if(b.length==3){b=b+b}a.r=parseInt(b.substring(0,2),16);a.g=parseInt(b.substring(2,4),16);a.b=parseInt(b.substring(4,6),16)}else{if(this.colorRgb.exec(b)){a.r=parseInt(RegExp.$1);a.g=parseInt(RegExp.$2);a.b=parseInt(RegExp.$3)}else{a.r=0;a.g=0;a.b=0}}return a},_draw:function(){var d=0,r=this.options.diameter*0.07,c,n,q,m,p,o,b,l=0.1,a=Math.round(this.options.density*this.options.range),k;this.UISpinnerCacheContext.clearRect(0,0,this.UISpinnerCacheCanvas.width,this.UISpinnerCacheCanvas.height);this.UISpinnerCanvas.width=this.UISpinnerCanvas.height=this.UISpinnerCacheCanvas.width=this.UISpinnerCacheCanvas.height=this.options.diameter;switch(this.options.shape){case this.shapes[0]:while(d<this.options.density){if(d<=a){k=1-((1-l)/a*d)}else{k=l}c=(this.options.density-d)*((Math.PI*2)/this.options.density);p=this.UISpinnerCanvas.width*0.5+Math.cos(c)*(this.options.diameter*0.45-r)-this.UISpinnerCanvas.width*0.5;o=this.UISpinnerCanvas.height*0.5+Math.sin(c)*(this.options.diameter*0.45-r)-this.UISpinnerCanvas.height*0.5;this.UISpinnerCacheContext.beginPath();if(this.options.fading){this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+k.toString()+")"}else{this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}if(this.options.scaling){this.UISpinnerCacheContext.arc(this.options.diameter*0.5+p,this.options.diameter*0.5+o,r*k,0,Math.PI*2,false)}else{this.UISpinnerCacheContext.arc(this.options.diameter*0.5+p,this.options.diameter*0.5+o,r,0,Math.PI*2,false)}this.UISpinnerCacheContext.closePath();this.UISpinnerCacheContext.fill();d+=1}break;case this.shapes[1]:r=this.UISpinnerCanvas.width*0.12;while(d<this.options.density){if(d<=a){k=1-((1-l)/a*d)}else{k=l}b=360-360/this.options.density*d;c=b/180*Math.PI;p=Math.cos(c)*r*3+this.UISpinnerCacheCanvas.width*0.5;o=Math.sin(c)*r*3+this.UISpinnerCacheCanvas.height*0.5;this.UISpinnerCacheContext.save();this.UISpinnerCacheContext.translate(p,o);this.UISpinnerCacheContext.rotate(c);this.UISpinnerCacheContext.translate(-p,-o);this.UISpinnerCacheContext.beginPath();if(this.options.fading){this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+k.toString()+")"}else{this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}this.UISpinnerCacheContext.fillRect(p,o-r*0.5,r,r);this.UISpinnerCacheContext.closePath();this.UISpinnerCacheContext.fill();this.UISpinnerCacheContext.restore();d+=1}break;case this.shapes[2]:q=this.UISpinnerCacheCanvas.width*0.24;m=q*0.35;while(d<this.options.density){if(d<=a){k=1-((1-l)/a*d)}else{k=l}b=360-360/this.options.density*d;c=b/180*Math.PI;p=Math.cos(c)*(m+(this.UISpinnerCacheCanvas.height-m)*0.13)+this.UISpinnerCacheCanvas.width*0.5;o=Math.sin(c)*(m+(this.UISpinnerCacheCanvas.height-m)*0.13)+this.UISpinnerCacheCanvas.height*0.5;this.UISpinnerCacheContext.save();this.UISpinnerCacheContext.translate(p,o);this.UISpinnerCacheContext.rotate(c);this.UISpinnerCacheContext.translate(-p,-o);this.UISpinnerCacheContext.beginPath();if(this.options.fading){this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+k.toString()+")"}else{this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}this.UISpinnerCacheContext.fillRect(p,o-m*0.5,q,m);this.UISpinnerCacheContext.closePath();this.UISpinnerCacheContext.fill();this.UISpinnerCacheContext.restore();d+=1}break;case this.shapes[3]:q=this.UISpinnerCacheCanvas.width*0.24;m=q*0.35;n=m*0.65;while(d<this.options.density){if(d<=a){k=1-((1-l)/a*d)}else{k=l}b=360-360/this.options.density*d;c=b/180*Math.PI;p=Math.cos(c)*(m+(this.UISpinnerCacheCanvas.height-m)*0.13)+this.UISpinnerCacheCanvas.width*0.5;o=Math.sin(c)*(m+(this.UISpinnerCacheCanvas.height-m)*0.13)+this.UISpinnerCacheCanvas.height*0.5;this.UISpinnerCacheContext.save();this.UISpinnerCacheContext.translate(p,o);this.UISpinnerCacheContext.rotate(c);this.UISpinnerCacheContext.translate(-p,-o);if(this.options.fading){this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+k.toString()+")"}else{this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}this.UISpinnerCacheContext.beginPath();this.UISpinnerCacheContext.moveTo(p+n,o-m*0.5);this.UISpinnerCacheContext.lineTo(p+q-n,o-m*0.5);this.UISpinnerCacheContext.quadraticCurveTo(p+q,o-m*0.5,p+q,o-m*0.5+n);this.UISpinnerCacheContext.lineTo(p+q,o-m*0.5+m-n);this.UISpinnerCacheContext.quadraticCurveTo(p+q,o-m*0.5+m,p+q-n,o-m*0.5+m);this.UISpinnerCacheContext.lineTo(p+n,o-m*0.5+m);this.UISpinnerCacheContext.quadraticCurveTo(p,o-m*0.5+m,p,o-m*0.5+m-n);this.UISpinnerCacheContext.lineTo(p,o-m*0.5+n);this.UISpinnerCacheContext.quadraticCurveTo(p,o-m*0.5,p+n,o-m*0.5);this.UISpinnerCacheContext.closePath();this.UISpinnerCacheContext.fill();this.UISpinnerCacheContext.restore();d+=1}break}this._tick(true);return this},_clean:function(){this.UISpinnerContext.clearRect(0,0,this.UISpinnerCanvas.width,this.UISpinnerCanvas.height);return this},_redraw:function(){if(this.ready){this._clean();this._draw()}return this},_reset:function(){if(this.running){this.stop();this.start()}return this},_tick:function(a){var b=this.options.density>360?this.options.density/360:360/this.options.density;b*=this.options.speed;if(!a){this.activeId+=b}if(this.activeId>360){this.activeId-=360}this.UISpinnerContext.clearRect(0,0,this.options.diameter,this.options.diameter);this.UISpinnerContext.save();this.UISpinnerContext.translate(this.options.diameter*0.5,this.options.diameter*0.5);this.UISpinnerContext.rotate(Math.PI/180*this.activeId);this.UISpinnerContext.translate(-this.options.diameter*0.5,-this.options.diameter*0.5);this.UISpinnerContext.drawImage(this.UISpinnerCacheCanvas,0,0,this.options.diameter,this.options.diameter);this.UISpinnerContext.restore();return this},start:function(){if(!this.running){this.running=true;var a=this;this.timer=window.setInterval(function(){a._tick()},Math.round(1000/this.options.fps))}return this},stop:function(){if(this.running){this.running=false;clearInterval(this.timer);this.timer=null;delete this.timer}return this},destroy:function(){if(this.running){this.stop()}g(this.UISpinnerCanvas).remove();g(this.UISpinnerCacheCanvas).remove();g.Widget.prototype.destroy.apply(this);return this}});return h});
define("jquery-nos-ostabs",["jquery","log","order!jquery-ui","order!wijmo-open","order!wijmo-complete","order!jquery-nos","order!jquery-nos-loadspinner"],function(g,f,e,k,j,i){var h=void (0);g.widget("nos.ostabs",{options:{initTabs:[],newTab:"appsTab",trayTabs:[],appsTab:{},fx:null,labelMinWidth:100,labelMaxWidth:200,selected:null,texts:{scrollLeft:"Scroll left",scrollRight:"Scroll right",newTab:"New tab",removeTab:"Remove tab",closeTab:"Close tab",reloadTab:"Reload tab",spinner:"Loading..."},add:null,remove:null,select:null,show:null,drag:null},tabId:0,stackOpening:[],_create:function(){var a=this,b=a.options;a._tabify(true);g(window).resize(function(){if(b.selected){a._firePanelEvent(a.panels.eq(b.selected),{event:"resizePanel"})}})},_setOption:function(b,c){var a=this;if(b=="selected"){a.select(c)}else{a.options[b]=c;a._tabify()}},_getNextTabId:function(){var a=this;return ++a.tabId},_tabId:function(b){var c=this;return g(b).data("panelid.tabs")||"nos-ostabs-"+c._getNextTabId()},_sanitizeSelector:function(a){return a.replace(/:/g,"\\:")},_ui:function(a,b){var c=this,d=c.lis.index(a);if(b===h){b=c.element.find(c._sanitizeSelector(c.anchors[d].hash))[0]}return{tab:a,panel:b,index:d}},_cleanup:function(){var a=this;a.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span.nos-ostabs-icon").removeClass("nos-ostabs-loader").each(function(){if(g.isFunction(g.fn.loadspinner)){g(this).loadspinner("destroy")}}).html(" ").parent().find("span.nos-ostabs-label").each(function(){var c=g(this),b=c.data("label.tabs");if(b){c.html(b).removeData("label.tabs")}});return a},_tabify:function(t){var u=this,d=u.options,b=/^#.+/;if(t){u.element.addClass("nos-ostabs ui-widget ui-widget-content");u.uiOstabsHeader=g("<div></div>").addClass("ui-widget-header").appendTo(u.element);u.uiOstabsSuperPanel=g("<div></div>").addClass("nos-ostabs-tabs").appendTo(u.uiOstabsHeader);u.uiOstabsTray=g("<ul></ul>").addClass("nos-ostabs-tray nos-ostabs-nav");if(g.isArray(d.trayTabs)){g.each(d.trayTabs,function(o,v){if(g.isPlainObject(v)){u._add(v,u.uiOstabsTray).addClass("nos-ostabs-tray")}})}u.uiOstabsTray.prependTo(u.uiOstabsHeader);if(g.isPlainObject(d.appsTab)){u.uiOstabsAppsTab=g("<ul></ul>").addClass("nos-ostabs-appstab  nos-ostabs-nav").prependTo(u.uiOstabsHeader);u._add(d.appsTab,u.uiOstabsAppsTab).addClass("nos-ostabs-appstab").removeClass("ui-state-default")}else{u.uiOstabsAppsTab=g("<ul></ul>")}u.uiOstabsSuperPanel.css("left",u.uiOstabsAppsTab.outerWidth(true)+25).css("right",u.uiOstabsTray.outerWidth(true)+35).wijsuperpanel({allowResize:false,autoRefresh:true,hScroller:{scrollBarVisibility:"hidden",scrollMode:"buttons",increaseButtonPosition:{my:"left bottom",at:"right bottom"},decreaseButtonPosition:{my:"right bottom",at:"left bottom"}},vScroller:{scrollBarVisibility:"hidden"},showRounder:false}).removeClass("ui-widget ui-widget-content").css("overflow","visible");u.uiOstabsSuperPanelContent=u.uiOstabsSuperPanel.wijsuperpanel("getContentElement");u.uiOstabsTabs=g("<ul></ul>").appendTo(u.uiOstabsSuperPanelContent);if(g.isArray(d.initTabs)){g.each(d.initTabs,function(o,v){u._add(v)})}var c=d.newTab;if(g.isPlainObject(c)){c=g.extend({label:d.texts.newTab,iconClasses:"ui-icon ui-icon-circle-plus"},c)}else{if(c&&g.isPlainObject(d.appsTab)){c=g.extend({},d.appsTab,{label:d.texts.newTab,iconClasses:"ui-icon ui-icon-circle-plus",iconUrl:"",iconSize:16})}else{c=false}}if(c){u.uiOstabsNewTab=u._add(c).addClass("nos-ostabs-newtab")}else{u.uiOstabsNewTab=g("<li>/<li>")}u.uiOstabsNewTab.hover(function(){g(this).find(".nos-ostabs-label").css("display","inline-block");u._tabsWidth()},function(){g(this).find(".nos-ostabs-label").css("display","none");u._tabsWidth()});u.uiOstabsTabs.sortable({items:"li:not(.nos-ostabs-newtab)",appendTo:u.uiOstabsSuperPanelContent,cursor:"move",delay:250,scroll:false,helper:"clone",tolerance:"pointer",axis:"x",zIndex:100000,placeholder:"ui-state-highlight",forcePlaceholderSize:true,start:function(){u.sorting=true},stop:function(){u.sorting=false},update:function(){u._trigger("drag",null);u.lis=u.uiOstabsAppsTab.add(u.uiOstabsTray).add(u.uiOstabsTabs).find("li:has(a[href])");u.anchors=u.lis.map(function(v){var o=g("a",this)[0];u.element.find(u._sanitizeSelector(o.hash)).find(".nos-ostabs-panel-content").data("nos-ostabs-index",v);return o});u._tabsWidth()}});u.tabsWidth=u.uiOstabsSuperPanelContent.width();u.labelWidth=d.labelMaxWidth;u.uiOstabsTabs.width(u.tabsWidth)}u.lis=u.uiOstabsAppsTab.add(u.uiOstabsTray).add(u.uiOstabsTabs).find("li:has(a[href])");u.anchors=u.lis.map(function(){return g("a",this)[0]});u.panels=g([]);u.anchors.each(function(w,o){var v=g(o).attr("href");var x=v.split("#")[0],y,z;if(x&&(x===location.toString().split("#")[0]||(y=g("base")[0])&&x===y.href)){v=o.hash;o.href=v}if(b.test(v)){z=u.element.find(u._sanitizeSelector(v));u.panels=u.panels.add(z)}else{if(v&&v!=="#"){g.data(o,"href.tabs",v);g.data(o,"load.tabs",v.replace(/#.*$/,""));var A=u._tabId(o);o.href="#"+A;z=u.element.find("#"+A);if(!z.length){u.lis.eq(w);z=g("<div></div>").attr("id",A).addClass("nos-ostabs-panel ui-widget-content ui-corner-bottom nos-ostabs-hide").appendTo(u.element);u._actions(z,w)}u.panels=u.panels.add(z)}}z.find(".nos-ostabs-panel-content").data("nos-ostabs-index",w)});if(t){u.uiOstabsTray.add(u.uiOstabsAppsTab).addClass("nos-ostabs-nav ui-helper-reset ui-helper-clearfix");u.lis.addClass("ui-corner-top");u.panels.addClass("nos-ostabs-panel ui-widget-content");if(d.selected===h){if(location.hash){u.anchors.each(function(v,o){if(o.hash==location.hash){d.selected=v;return false}})}if(typeof d.selected!=="number"&&u.lis.filter(".nos-ostabs-selected").length){d.selected=u.lis.index(u.lis.filter(".nos-ostabs-selected"))}d.selected=d.selected||(u.lis.length?0:-1)}d.selected=((d.selected>=0&&u.anchors[d.selected])||d.selected<0)?d.selected:0;u.panels.addClass("nos-ostabs-hide");u.lis.removeClass("nos-ostabs-selected ui-state-active");if(d.selected>=0&&u.anchors.length){u.element.find(u._sanitizeSelector(u.anchors[d.selected].hash)).removeClass("nos-ostabs-hide");u.lis.eq(d.selected).addClass("nos-ostabs-selected ui-state-active ui-state-open");u.element.queue("tabs",function(){u._trigger("show",null,u._ui(u.lis[d.selected]))});u.title(d.selected,u.title(d.selected));u._load(d.selected)}g(window).bind("unload",function(){u.lis.add(u.anchors).unbind(".tabs");u.lis=u.anchors=u.panels=null})}else{d.selected=u.lis.index(u.lis.filter(".nos-ostabs-selected"))}u.anchors.removeData("cache.tabs");u.lis.add(u.anchors).unbind(".tabs");var m=function(v,o){o.addClass("ui-state-"+v)};var q=function(v,o){o.removeClass("ui-state-"+v)};u.lis.bind("mouseover.tabs",function(){m("hover",g(this))});u.lis.bind("mouseout.tabs",function(){q("hover",g(this))});u.anchors.bind("focus.tabs",function(){m("focus",g(this).closest("li"))});u.anchors.bind("blur.tabs",function(){q("focus",g(this).closest("li"))});var a,n;if(d.fx){if(g.isArray(d.fx)){a=d.fx[0];n=d.fx[1]}else{a=n=d.fx}}function l(o,v){o.css("display","");if(!g.support.opacity&&v.opacity){o[0].style.removeAttribute("filter")}}function p(w){var v=w.data("callbacks.ostabs"),o=w.find(".nos-dispatcher");if(g.isPlainObject(v)){g.each(v,function(x,y){u._firePanelEvent(o,y)});v={}}}var r=n?function(o,v){var w=g(o).closest("li").addClass("nos-ostabs-selected ui-state-active");v.hide().removeClass("nos-ostabs-hide").animate(n,n.duration||"normal",function(){if(w.hasClass("nos-ostabs-newtab")){u._tabsWidth()}u.uiOstabsSuperPanel.wijsuperpanel("scrollChildIntoView",w.find("a"));l(v,n);p(v);u._firePanelEvent(v,{event:"showPanel"})})}:function(o,v){var w=g(o).closest("li");if(w.hasClass("nos-ostabs-newtab")){u._tabsWidth()}u.uiOstabsSuperPanel.wijsuperpanel("scrollChildIntoView",w.find("a"));w.addClass("nos-ostabs-selected ui-state-active");v.removeClass("nos-ostabs-hide");p(v);u._firePanelEvent(v,{event:"showPanel"})};var s=a?function(v,o){o.animate(a,a.duration||"normal",function(){if(u.uiOstabsNewTab.hasClass("ui-state-active")){u._tabsWidth()}u.lis.removeClass("nos-ostabs-selected ui-state-active");o.addClass("nos-ostabs-hide");l(o,a);u.element.dequeue("tabs");o.trigger("hidePanel.ostabs")})}:function(v,o){if(u.uiOstabsNewTab.hasClass("ui-state-active")){u._tabsWidth()}u.lis.removeClass("nos-ostabs-selected ui-state-active");o.addClass("nos-ostabs-hide");u.element.dequeue("tabs");o.trigger("hidePanel.ostabs")};u.anchors.bind("click.tabs",function(){var v=this,x=g(v).closest("li"),o=u.panels.filter(":not(.nos-ostabs-hide)"),w=u.element.find(u._sanitizeSelector(v.hash));x.addClass("ui-state-open");u.uiOstabsNewTab.removeClass("ui-state-open");d.selected=u.anchors.index(this);if(x.hasClass("nos-ostabs-selected")||x.hasClass("ui-state-processing")||u.panels.filter(":animated").length||u._trigger("select",null,u._ui(x[0],w[0]))===false){this.blur();return false}u._abort();if(w.length){if(o.length){u.element.queue("tabs",function(){s(v,o)})}u.element.queue("tabs",function(){u.stackOpening.push(v);r(v,w)});g("title").text(x.find(".nos-ostabs-label").text());u._load(u.anchors.index(this))}else{throw"jQuery UI Tabs: Mismatching fragment identifier."}this.blur()});u.anchors.bind("click.tabs",function(){return false});u._tabsWidth()},_getIndex:function(b){var a=this;if(typeof b=="string"){b=a.anchors.index(a.anchors.filter("[href$="+b+"]"))}return b},_actions:function(v,n){var u=this,d=u.options;var q=u.lis.eq(n),p=u.anchors.eq(n);var l=g("<div></div>").addClass("nos-ostabs-actions ui-state-active").prependTo(v);var s=g("<div></div>").addClass("nos-ostabs-actions-links").prependTo(l);var c=q.not(".nos-ostabs-tray").not(".nos-ostabs-appstab").not(".nos-ostabs-newtab").length;var r=q.not(".nos-ostabs-appstab").length;var m=p.data("iframe.tabs");if(r){var t=g('<a href="#"></a>').addClass("nos-ostabs-close").click(function(){u.remove(u.lis.index(q));return false}).appendTo(s);g("<span></span>").addClass("ui-icon ui-icon-closethick").text(c?d.texts.removeTab:d.texts.closeTab).appendTo(t);g("<span></span>").text(c?d.texts.removeTab:d.texts.closeTab).appendTo(t)}if(m){var b=g('<a href="#"></a>').addClass("nos-ostabs-reload").click(function(){var a=v.find("iframe.nos-ostabs-panel-content");if(a!==h){a.attr("src",a.attr("src"))}return false}).text(d.texts.reloadTab).appendTo(s);g("<span></span>").addClass("ui-icon ui-icon-refresh").text(d.texts.reloadTab).appendTo(b)}},_tabsWidth:function(){var a=this,l=a.options,c=0;a.uiOstabsTabs.width(10000000);a.uiOstabsTabs.find("li").each(function(){c+=g(this).outerWidth(true)});a.uiOstabsTabs.width(c);var b=a.uiOstabsTabs.find(".nos-ostabs-label:visible").length,d;if(a.tabsWidth<a.uiOstabsTabs.width()){while(a.tabsWidth<a.uiOstabsTabs.width()&&a.labelWidth>l.labelMinWidth){d=a.labelWidth-l.labelMinWidth;d=d>10?10:d;c=c-b*d;a.uiOstabsTabs.width(c);a.labelWidth=a.labelWidth-d;g("head .tabswidth").remove();g('<style type="text/css" class="tabswidth">.nos-ostabs .ui-widget-header .nos-ostabs-label {width : '+a.labelWidth+"px !important;}</style>").appendTo("head")}}else{do{d=l.labelMaxWidth-a.labelWidth;d=d>10?10:d;if(a.tabsWidth>(c+b*10)){c=c+b*d;a.uiOstabsTabs.width(c);a.labelWidth=a.labelWidth+d;g("head .tabswidth").remove();g('<style type="text/css" class="tabswidth">.nos-ostabs .ui-widget-header .nos-ostabs-label {width : '+a.labelWidth+"px !important;}</style>").appendTo("head")}}while(a.tabsWidth>(c+b*10)&&a.labelWidth<l.labelMaxWidth)}if(a.tabsWidth<a.uiOstabsTabs.width()){a.uiOstabsSuperPanel.find(".wijmo-wijsuperpanel-buttonleft, .wijmo-wijsuperpanel-buttonright").show()}else{a.uiOstabsSuperPanel.find(".wijmo-wijsuperpanel-buttonleft, .wijmo-wijsuperpanel-buttonright").hide()}},add:function(c,b){var a=this;if(!g.isPlainObject(c)||c.url===h){return false}if(b===h){b=a.anchors.length-1}var d=a._add(c);if(b<a.lis.length){d.insertBefore(a.lis[b])}else{b=a.lis.eq(d)}a.uiOstabsTabs.sortable("refresh");a._tabify();if(a.anchors.length==1){a.select(0)}a._trigger("add",c,a._ui(d[0]));return b},_add:function(n,o){var d=this;if(!g.isPlainObject(n)||n.url===h){return false}o=o||d.uiOstabsTabs;n=g.extend({url:"",iframe:false,label:"",labelDisplay:true,iconClasses:"ui-icon ui-icon-document",iconUrl:"",iconSize:16,panelId:false},n);var c=g('<a href="'+n.url+'"></a>');if(n.iframe){c.data("iframe.tabs",true)}if(n.panelId){c.data("panelid.tabs",n.panelId)}var m=d._icon(n).appendTo(c);var l=g("<span></span>").addClass("nos-ostabs-label").text(n.label?n.label:"New tab").appendTo(c);if(!n.labelDisplay){l.hide()}var b=g("<li></li>").append(c).attr("title",n.label).addClass("ui-corner-top ui-state-default").data("ui-ostab",n).appendTo(o);if(!isNaN(n.iconSize)&&n.iconSize!==16&&o!==d.uiOstabsTabs){b.css({height:(n.iconSize+4)+"px",bottom:(n.iconSize-35)+"px"});m.css("top","2px")}return b},remove:function(b){var a=this;b=a._getIndex(b);var n=a.lis.eq(b),l=a.anchors.eq(b),m=a.element.find(a._sanitizeSelector(a.anchors[b].hash));if(b==0&&!n.hasClass("nos-ostabs-selected")){var d=a.lis.filter(".nos-ostabs-newtab");if(d.hasClass("nos-ostabs-selected")){n=d}}if(n.not(".nos-ostabs-tray").not(".nos-ostabs-appstab").not(".nos-ostabs-newtab").length){n.remove();m.remove()}n.removeClass("ui-state-active ui-state-open");for(var c=0;c<a.stackOpening.length;c++){if(a.stackOpening[c]===l.get(0)){a.stackOpening.splice(c,1)}}if(a.stackOpening.length){a.select(a.anchors.index(a.stackOpening[a.stackOpening.length-1]))}else{a.select(0)}if(n.not(".nos-ostabs-appstab").not(".nos-ostabs-newtab").length){g("> *",m).not(".nos-ostabs-actions").remove()}m.addClass("nos-ostabs-hide").removeData("callbacks.ostabs");n.removeClass("nos-ostabs-selected");a._tabify();a._trigger("remove",null,a._ui(n[0],m[0]));return a},title:function(b,d){var a=this,c=a.options;b=a._getIndex(b);var l=a.lis.eq(b);if(d===h){return l.find(".nos-ostabs-label").text()}else{l.find(".nos-ostabs-label").text(d);if(c.selected==b){g("title").text(d)}a._trigger("title",null,a._ui(l[0]));return a}},update:function(d,l){var c=this;d=c._getIndex(d);if(!g.isPlainObject(l)){return false}var a=!!l.url,n=c.lis.eq(d);l=g.extend({},n.data("ui-ostab"),l);if(a){this.remove(d);this.add(l,d);this.select(d)}else{if(c.options.selected==d){g("title").text(l.label)}var b=c._add(l),m=b.find("a");n.data("ui-ostab",l).attr("title",l.label||"").addClass(b.attr("class")).css({height:b.css("height"),bottom:b.css("bottom")}).find("a").empty().append(m.children());b.remove()}return c},_icon:function(b){var a=g("<span></span>").addClass("nos-ostabs-icon");if(b.iconUrl){a.css("background-image",'url("'+b.iconUrl+'")')}else{a.addClass(b.iconClasses)}if(!isNaN(b.iconSize)&&b.iconSize!==16){a.css({width:b.iconSize+"px",height:b.iconSize+"px",lineHeight:b.iconSize+"px",top:(b.iconSize>22?22-b.iconSize:10-b.iconSize/2)+"px"})}return a},select:function(b){var a=this;b=a._getIndex(b);if(b==-1){return a}a.anchors.eq(b).trigger("click.tabs");return a},_load:function(m){var d=this;m=d._getIndex(m);var q=d.options,c=d.anchors.eq(m)[0],l=g.data(c,"load.tabs"),n=g.data(c,"iframe.tabs");d._abort();if((!l&&n)||d.element.queue("tabs").length!==0&&g.data(c,"cache.tabs")){d.element.dequeue("tabs");return}var b=d.element.find(d._sanitizeSelector(c.hash)),p=g("> *",b).not(".nos-ostabs-actions").length;if(p!==0){d.element.dequeue("tabs");return}d.lis.eq(m).addClass("ui-state-processing");g("span.nos-ostabs-label",c).each(function(){var a=g(this);a.data("label.tabs",a.html()).html(a.data("label.tabs")?q.texts.spinner:"")});if(g.isFunction(g.fn.loadspinner)){g("span.nos-ostabs-icon",c).each(function(){var a=g(this);a.addClass("ui-state-processing").loadspinner({diameter:a.width(),scaling:true})})}if(!n){d.xhr=g.ajax({url:l,success:function(a){g("<div></div>").addClass("nos-ostabs-panel-content nos-dispatcher").data("nos-ostabs-index",m).prependTo(b.data("callbacks.ostabs",{})).html(a);g.data(c,"cache.tabs",true)},complete:function(){d._cleanup();d._trigger("load",null,d._ui(d.lis[m]))}})}else{g("<iframe "+(g.browser.msie?'allowTransparency="true" ':"")+'src="'+l+'" frameborder="0"></iframe>').data("nos-ostabs-index",m).addClass("nos-ostabs-panel-content nos-dispatcher").bind("load",function(){d._cleanup();d._trigger("load",null,d._ui(d.lis[m]))}).prependTo(b.data("callbacks.ostabs",{}));g.data(c,"cache.tabs",true)}d.element.dequeue("tabs");return d},_abort:function(){var a=this;a.element.queue([]);a.panels.stop(false,true);a.element.queue("tabs",a.element.queue("tabs").splice(-2,2));a._cleanup();return a},tabs:function(){var a=this,b=[];a.uiOstabsTabs.find("li:not(.nos-ostabs-newtab)").each(function(){b.push(g(this).data("ui-ostab"))});return b},dispatchEvent:function(b){var a=this,c=a.options;if(!g.isPlainObject(b)){b={event:b}}g.each(a.panels,function(d){var m=g(this);if(d===c.selected){a._firePanelEvent(m,b)}else{var l=m.data("callbacks.ostabs");if(g.isPlainObject(l)){l[b.event+(b.type?"."+b.type:"")]=b}}});return a},_firePanelEvent:function(a,b){a=a.is(".nos-dispatcher")?a:a.find(".nos-dispatcher");var c=g.Event(b.event,{namespace:b.type||null,data:b.data||null});if(a.is("iframe")){if(a[0].contentDocument.$){a[0].contentDocument.$("body").trigger(c)}}else{try{a.trigger(c)}catch(c){log(c)}}},current:function(){var a=this,b=a.options;return{tab:g(a.lis.get(b.selected)),panel:g(a.panels.get(b.selected)),index:b.selected}}});return i});
define("jquery-nos-preview",["jquery","log","order!jquery-ui","order!wijmo-open","order!wijmo-complete","order!jquery-nos"],function(g,f,e,k,j,i){var h=void (0);g.widget("nos.preview",{options:{meta:{},actions:[],data:null,dataParser:null,texts:{headerDefault:"Preview",selectItem:"No item selected"}},data:null,_create:function(){var a=this,b=a.options;a.element.addClass("nos-preview ui-widget ui-widget-content wijmo-wijgrid").parents(".nos-appdesk").bind("selectionChanged.appdesk",function(d,c){if(g.isPlainObject(c)){a.select(c)}else{a.unselect()}})},_init:function(){var a=this,b=a.options;a.data=a.data||b.data;if(g.isPlainObject(a.data)){a.select(a.data)}else{a.unselect()}},_uiHeader:function(l){var a=this,d=a.options;var b=g('<table cellspacing="0" cellpadding="0" border="0"><thead></thead></table>').addClass("nos-preview-header wijmo-wijsuperpanel-header wijmo-wijgrid-root wijmo-wijgrid-table").css({borderCollapse:"separate","-moz-user-select":"-moz-none"}).appendTo(a.element);var c=g("<tr></tr>").addClass("wijmo-wijgrid-headerrow").appendTo(b);g("<th><div><span></span></div></th>").addClass("wijgridth ui-widget wijmo-c1basefield ui-state-default wijmo-c1field").appendTo(c).find("div").addClass("wijmo-wijgrid-innercell").find("span").addClass("wijmo-wijgrid-headertext").text(l);return a},_uiFooter:function(){var a=this,b=a.options;if(b.actions.length>0){a.uiFooter=g("<div></div>").addClass("nos-preview-footer").appendTo(a.uiContainer);g.each(b.actions,function(){var d=this;var c=false;if(d.iconClasses){c=d.iconClasses}else{if(d.icon){c="nos-icon16 ui-icon ui-icon-"+d.icon}}var l;if(d.primary){l=(c?'<span class="ui-button-icon-primary '+c+' wijmo-wijmenu-icon-left"></span>':"");l+='<span class="ui-button-text">'+d.label+"</span>";g("<button></button>").addClass("ui-button ui-button-text"+(d.icon?"-icon-primary":"")+" ui-widget ui-state-default ui-corner-all").css({marginBottom:"5px"}).appendTo(a.uiFooter).html(l).hover(function(){g(this).addClass("ui-state-hover")},function(){g(this).removeClass("ui-state-hover")}).click(function(m){m.preventDefault();m.stopImmediatePropagation();d.action.apply(this,[a.data,g(this)])})}else{l=(c?'<span class="'+c+'"></span> ':"");l+='<span class="ui-button-text">'+d.label+"</span>";g('<a href="#"></a>').css({display:"inline-block",marginBottom:"5px"}).appendTo(a.uiFooter).html(l).click(function(m){m.preventDefault();m.stopImmediatePropagation();d.action.apply(this,[a.data,g(this)])})}})}return a},_uiThumbnail:function(b){var a=this,c=a.options,d=b.thumbnail.replace(/64-64/g,"256-256")||b.thumbnailAlternate;if(d){a._loadImg(b,d)}return a},_loadImg:function(b,d){var a=this,c=a.options;g("<img />").error(function(){g(this).remove();if(d===b.thumbnail&&b.thumbnailAlternate){a._loadImg(b,b.thumbnailAlternate)}}).load(function(){var m=g(this),l=m.height();var o=g("<div></div>").addClass("nos-preview-thumb").css({backgroundImage:'url("'+m.attr("src")+'")',height:(l<=100?l:100)+"px"}).prependTo(a.uiContainer);var n=null;g.each(c.actions,function(){if(this.name==c.actionThumbnail){n=this}});if(n!==null){o.attr({title:n.label}).css({cursor:"pointer"}).click(function(p){p.preventDefault();p.stopImmediatePropagation();n.action.apply(this,[a.data])})}m.remove()}).css({position:"absolute",visibility:"hidden"}).attr("src",d).appendTo("body");return a},_uiMetaData:function(d){var a=this,l=a.options,b=0;var c=g('<table cellspacing="0" cellpadding="0" border="0"><tbody></tbody></table>').addClass("nos-preview-metadata wijmo-wijgrid-root wijmo-wijgrid-table").css({borderCollapse:"separate","-moz-user-select":"-moz-none"}).appendTo(a.uiContainer).find("tbody").addClass("ui-widget-content wijmo-wijgrid-data");g.each(l.meta,function(m,o){var n=g("<tr></tr>").addClass("wijmo-wijgrid-row ui-widget-content wijmo-wijgrid-datarow"+(b%2?" wijmo-wijgrid-alternatingrow":"")).appendTo(c);g("<th><div></div></th>").addClass("wijgridtd wijdata-type-string").appendTo(n).find("div").addClass("wijmo-wijgrid-innercell").text(o.label||"");g("<td><div></div></td>").addClass("wijgridtd wijdata-type-string").appendTo(n).find("div").addClass("wijmo-wijgrid-innercell").text(d[m]||"");b++});return a},unselect:function(){var a=this,b=a.options;a.element.wijsuperpanel("destroy").empty();a._uiHeader(b.texts.headerDefault);a.uiContainer=g("<div></div>").addClass("nos-preview-noitem").text(b.texts.selectItem).appendTo(a.element);a.element.wijsuperpanel({showRounder:false});return a},select:function(b){var a=this,c=a.options;if(b===h){return a.data}else{a.data=b;if(g.isFunction(c.dataParser)){b=c.dataParser(b)}a.element.wijsuperpanel("destroy").empty().css("height","100%");a._uiHeader(b.title);a.uiContainer=g("<div></div>").addClass("nos-preview-container").appendTo(a.element);a._uiThumbnail(b)._uiMetaData(b.meta)._uiFooter();a.element.wijsuperpanel({showRounder:false,autoRefresh:true})}return a},resize:function(){var a=this;a._init();return a}});return i});
define("jquery-nos-listgrid",["jquery","log","order!jquery-ui","order!wijmo-open","order!wijmo-complete","order!jquery-nos"],function(g,f,e,j,i,h){g.widget("nos.noslistgrid",g.wijmo.wijgrid,{options:{texts:{loading:"Loading..."}},_create:function(){var a=this;g.wijmo.wijgrid.prototype._create.call(a)},_init:function(){var d=this,l=d.options;if(g.isFunction(l.dataLoading)){var k=l.dataLoading}l.dataLoading=function(){d._overlayShow();if(g.isFunction(k)){k.apply(this,arguments)}};if(g.isFunction(l.dataLoaded)){var b=l.dataLoaded}l.dataLoaded=function(){d._overlayHide();if(g.isFunction(b)){b.apply(this,arguments)}};if(g.isFunction(l.columnResized)){var a=l.columnResized}l.columnResized=function(o,m){var n=d.option("columns");g.extend(n[m.column.thX],{ensurePxWidth:true,width:m.column.width});d.setSize(d.outerDiv.parent().width());if(g.isFunction(a)){a.apply(this,arguments)}};if(g.isFunction(l.dataLoaded)){var c=l.ajaxError}l.ajaxError=function(q,m){var p=m.XMLHttpRequest;if(p.status==403){var o={title:"You've been inactive for too long",text:"Please log-in again.",type:"error"};try{var n=g.parseJSON(p.responseText);if(n.login_page){o.text=o.text.replace("log-in again",'<a href="'+n.login_page+'">log-in again</a>')}}catch(q){}h.notify(o)}d._overlayHide();if(g.isFunction(c)){c.apply(this,arguments)}};g.wijmo.wijgrid.prototype._init.call(d)},_overlayShow:function(){var a=this,b=a.options;a.uiOverlay=g("<div></div>").addClass("wijmo-wijgrid-overlay ui-widget-overlay").appendTo(a.outerDiv);a.uiOverlayText=g("<span><span></span>"+b.texts.loading+"</span>").addClass("wijmo-wijgrid-loadingtext ui-widget-content ui-corner-all").find("span").addClass("ui-icon ui-icon-clock").end().appendTo(a.outerDiv);a.uiOverlayText.css({marginLeft:(a.uiOverlayText.width()*-1/2)+"px",marginTop:(a.uiOverlayText.height()*-1/2)+"px"});return a},_overlayHide:function(){var a=this;a.uiOverlay.remove();a.uiOverlayText.remove();return a}});return h});
define("jquery-nos-treegrid",["jquery","log","order!jquery-ui","order!wijmo-open","order!wijmo-complete","order!jquery-nos","order!jquery-nos-listgrid"],function(g,f,e,k,j,i){var h=void (0);g.widget("nos.nostreegrid",g.nos.noslistgrid,{options:{treeUrl:"",treeOptions:null,treeColumnIndex:0,sortable:true,movable:true,data:[],preOpen:null},oldFirstColumn:null,treeData:{},treeDataSource:null,dragged:false,dropTarget:false,dragHelper:false,mousePressed:false,mouseMoved:false,timer:false,_create:function(){var b=this,d=b.options;if(g.isFunction(d.rendered)){var c=d.rendered}d.rendered=function(){if(g.isFunction(c)){c.apply(this,arguments)}b._dragInit()};if(g.isFunction(d.rowStyleFormatter)){var a=d.rowStyleFormatter}d.rowStyleFormatter=function(l){if(g.isFunction(a)){a.apply(this,arguments)}if(b.draggedIndex&&l.state&g.wijmo.wijgrid.renderState.hovered){l.$rows.removeClass("ui-state-hover")}};d.allowPaging=false;g.nos.noslistgrid.prototype._create.call(b)},_init:function(){var a=this,b=a.options;a.oldFirstColumn=g.extend(true,{},b.columns[b.treeColumnIndex]);b.columns[b.treeColumnIndex].cellFormatter=function(c){if(g.isPlainObject(c.row.data)){var l=c.$container.closest("tr"),d=c.row.data;if(c.column.dataKey){g("<span></span>").text(c.row.data[c.column.dataKey]).appendTo(c.$container)}else{if(g.isFunction(a.oldFirstColumn.cellFormatter)){a.oldFirstColumn.cellFormatter(c)}}if(d.treeChilds){g('<div class="nostreegrid-toggle"></div>').css({marginLeft:(d.treeLevel*20)+"px",cursor:"pointer"}).addClass("ui-icon").addClass(g.isPlainObject(d.treeChilds)?"ui-icon-triangle-1-se":"ui-icon-triangle-1-e").click(function(m){m.stopImmediatePropagation();if(g.isPlainObject(d.treeChilds)){a._toggle(l,false)}else{a._toggle(l,true)}}).prependTo(c.$container)}else{g('<div class="nostreegrid-toggle"></div>').css({marginLeft:(d.treeLevel*20)+"px"}).addClass("nos-icon16 nos-icon16-empty").prependTo(c.$container)}l.data("treeNode",d);return true}};if(b.movable){b.columns.unshift({allowSort:false,allowMoving:false,allowSizing:false,width:25,ensurePxWidth:true,cellFormatter:function(c){if(g.isPlainObject(c.row.data)){c.$container.append('<div class="ui-icon ui-icon-grip-dotted-vertical nostreegrid-move-handle"></div>');return true}}})}g.each(b.columns,function(){this.sortDirection="none"});g.nos.noslistgrid.prototype._init.call(a);a._datasource();a.treeDataSource.proxy.options.data.deep=2;if(g.isPlainObject(b.preOpen)){a.treeDataSource.proxy.options.data.preOpen=b.preOpen}a.treeDataSource.load();b.preOpen=null;delete a.treeDataSource.proxy.options.data.preOpen},_setOption:function(b,c){var a=this;g.nos.noslistgrid.prototype._setOption.apply(a,arguments);if(b==="treeOptions"){a._datasource().reload()}},_datasource:function(){var a=this,b=a.options;a.treeDataSource=new wijdatasource({dynamic:true,proxy:new wijhttpproxy({url:b.treeUrl,dataType:"json",error:function(c,l,d){log(c,l,d)},data:b.treeOptions||{}}),loaded:function(o,l){var n=a.data(),d=function(p){return g.map(p,function(s,q){if(q==="length"){return null}var t=s;if(g.isPlainObject(s.treeChilds)){t=[s].concat(d(s.treeChilds))}return t})};if(!g.isPlainObject(l)){a.treeData=a._completeChilds(null,o.items);Array.prototype.splice.apply(n,[0,n.length].concat(d(a.treeData)))}else{var c=g.inArray(l.node,n);a._removeNode(l.node);if(l.close){l.node.treeChilds=o.data.total;Array.prototype.splice.apply(n,[c,0,l.node])}else{l.node.treeChilds=a._completeChilds(l.node,o.items);Array.prototype.splice.apply(n,[c,0,l.node].concat(d(l.node.treeChilds)))}}try{a.ensureControl(true)}catch(m){}},reader:{read:function(c){c.items=c.data.items}}});return a},_dragInit:function(){var a=this,c=a.options;if(!c.movable){return a}a.element.find("tr.wijmo-wijgrid-row").each(function(){var m=g(this),l=m.data("treeNode"),n=m.find(".nostreegrid-move-handle");if(!a._trigger("movabled",null,{node:l,$tr:m})){return false}n.mousedown(function(p){if(p.which!=1){return true}p.stopImmediatePropagation();a.mousePressed=new Date().getTime();var o=m.clone();a.dragHelper=g('<div class="nostreegrid-drag-helper ui-state-highlight"></div>').hide().css("opacity","0.8").append(o.find("td:eq(1)").find(">div")).appendTo("body");a.helperInsert=g('<div class="nostreegrid-drag-inserthelper ui-state-highlight"></div>');g(document).on("mousemove",{treeGrid:a,node:l,$tr:m},a._dragStart).on("mouseup",{treeGrid:a},a._dragDestroy)});m.mouseup(function(){if(a.mousePressed&&a.mouseMoved&&a.dragged&&a.dropTarget){if(a._trigger("dropped",null,{dragged:a.dragged,dropped:m,notification:true})){a._move(m)}}a._dragDestroy()})});if(a.draggedIndex){var d=a.mousePressed,b=a.element.find("tr.wijmo-wijgrid-row").eq(a.draggedIndex);a._dragDestroy();b.find(".nostreegrid-move-handle").trigger(jQuery.Event("mousedown",{which:1}));a.mousePressed=d;a.dragOpen.event.target=a.element.find("tr.wijmo-wijgrid-row")[a.dragOpen.index];a.dragOpen.event.data.$tr=b;b.trigger(a.dragOpen.event)}return a},_dragStart:function(a){var v=a.data.treeGrid,c=v.options,d=a.data.node,q=a.data.$tr;if(!c.movable){return v}if(v.mousePressed&&(new Date().getTime()-v.mousePressed)>500){if(!v._scroller){v._scroller={superpanel:v._view()._scroller.data("wijsuperpanel")};var u=v._scroller.superpanel.getContentElement(),n=u.parent(),l=n.offset();v._scroller.contentElement=v._scroller.superpanel.getContentElement();v._scroller.contentWrapper=v._scroller.contentElement.parent();g.extend(v._scroller,v._scroller.contentElement.offset(),{bottom:l.top+n.height()})}if(a.pageY<v._scroller.top){v._scroller.superpanel._doScrolling("top",v._scroller.superpanel,true)}else{if(a.pageY<(v._scroller.top+20)){v._scroller.superpanel._doScrolling("top",v._scroller.superpanel)}else{if(a.pageY>v._scroller.bottom){v._scroller.superpanel._doScrolling("bottom",v._scroller.superpanel,true)}else{if(a.pageY>(v._scroller.bottom-20)){v._scroller.superpanel._doScrolling("bottom",v._scroller.superpanel)}}}}if(!v.mouseMoved){var p=g("body");if(p.css("cursor")){v._cursor=p.css("cursor")}p.css("cursor","move");v.mouseMoved=true}if(v.timer){clearTimeout(v.timer)}if(!v.dragHelper.is(":visible")){v.dragHelper.show();v.dragged=q;v.draggedIndex=q.data("wijgriddataItemIndex")}v.dragHelper.css({left:(a.pageX+5),top:(a.pageY+15)});q.css("visibility","hidden");v.dropTarget=false;var b=g(a.target).parents("tr:first");if(g(a.target).closest(v.element).size()&&(g(a.target).is("tr.wijmo-wijgrid-row")||g(a.target).parents("tr.wijmo-wijgrid-row").size())){var r=b.data("treeNode"),m=g.extend({width:b.width(),height:b.height()},b.offset()),s=b.find(".nostreegrid-toggle"),t=g.inArray(d.treeHash,r.treePath)!==-1;if(!t&&c.sortable&&a.pageY<(m.top+5)){v.dropTarget="before";b.removeClass("ui-state-hover");v.helperInsert.css({marginLeft:(parseInt(s.css("margin-left").replace("px",""))+s.width())+"px",marginBottom:""}).insertBefore(s)}else{if(!t&&c.sortable&&a.pageY>(m.top+m.height-5)){v.dropTarget="after";b.removeClass("ui-state-hover");v.helperInsert.css({marginLeft:(parseInt(s.css("margin-left").replace("px",""))+s.width())+"px",marginTop:""}).appendTo(b.find("td:eq(1)").find(">div"))}else{v.helperInsert.detach();if(t||!v._trigger("dropped",null,{dragged:q,dropped:b,notification:false})){b.removeClass("ui-state-hover")}else{v.dropTarget="in";if(g(a.target).hasClass("nostreegrid-toggle")&&g(a.target).hasClass("ui-icon-triangle-1-e")){v.timer=setTimeout(function(){v.dragOpen={event:a,index:b.data("wijgriddataItemIndex")};g(a.target).click()},700)}b.addClass("ui-state-hover")}}}}else{b.removeClass("ui-state-hover");v.dragHelper.hide();v.helperInsert.detach()}}return v},_dragDestroy:function(b){var a=b?b.data.treeGrid:this,c=a.options;if(!c.movable){return a}if(a.timer){clearTimeout(a.timer)}if(a.dragHelper){g(document).off("mousemove",a._dragStart).off("mouseup").off("mousedown");g("body").css("cursor",a._cursor||"auto");a.dragHelper.remove();a.helperInsert.remove();if(a.dragged){a.dragged.css("visibility","visible")}a.dragged=a.mousePressed=a.mouseMoved=a.dragHelper=a.timer=a._scroller=false}return a},_completeChilds:function(c,d){var b=this,a=0,l={};g.each(d,function(n,m){g.extend(m,{treeHash:m._model+"|"+m._id,treeLevel:!c?0:c.treeLevel+1,treePath:!c?[]:c.treePath.concat([c.treeHash])});if(g.isArray(m.treeChilds)||g.isPlainObject(m.treeChilds)){m.treeChilds=b._completeChilds(m,m.treeChilds)}a++;l[m.treeHash]=m});return g.extend({length:a},l)},_getTreeNode:function(c){var a=this,b=null;g.each(c,function(d,l){b=!b?a.treeData[l]:b.treeChilds[l]});return b},_move:function(l){var a=this,d=a.options,c=a.dragged.data("treeNode"),b=l.data("treeNode");g.ajax({async:true,url:d.treeUrl,data:{move:true,itemModel:c._model,itemId:c._id,targetModel:b._model,targetId:b._id,targetType:a.dropTarget},dataType:"json",success:function(q,r){a.draggedIndex=false;if(a.dropTarget==="in"){a._removeNode(c);a._toggle(l,true)}else{var n=a._getTreeNode(c.treePath),p=a._getTreeNode(b.treePath),m=g.inArray(p,a.data()),o=a.element.find("tr.wijmo-wijgrid-row").eq(m);a._removeNode(c);delete n.treeChilds[c.treeHash];delete n.treeChilds.length;n.treeChilds=a._completeChilds(n,n.treeChilds);a._toggle(o,true)}},error:function(m,o,n){log("error",o,n)}});return a},_toggle:function(d,b){var a=this,l=a.options,c=d.data("treeNode");b=b===h?d.hasClass("ui-icon-triangle-1-e"):b;d.find(".nostreegrid-toggle").addClass(b?"ui-icon-clock":"ui-icon-triangle-1-e").removeClass(b?"ui-icon-triangle-1-e":"ui-icon-triangle-1-se");a.treeDataSource.proxy.options.data.deep=b?1:-1;a.treeDataSource.proxy.options.data.id=c._id;a.treeDataSource.proxy.options.data.model=c._model;a.treeDataSource.load({close:b?false:true,node:c});return a},_removeNode:function(c){var a=this,b=false,l=0,d=a.data();g.each(d,function(n,o){var m=c.treeHash===o.treeHash||g.inArray(c.treeHash,o.treePath)!==-1;if(m){if(b===false){b=n}l++}if(!m&&b){return false}});if(b!==false){Array.prototype.splice.apply(d,[b,l])}return l},reload:function(){var a=this;a.treeDataSource.proxy.options.data.deep=2;delete a.treeDataSource.proxy.options.data.id;delete a.treeDataSource.proxy.options.data.model;a.treeDataSource.load();return a}});return i});
define("jquery-nos-thumbnailsgrid",["jquery","log","order!jquery-ui","order!wijmo-open","order!wijmo-complete","order!jquery-nos"],function(g,f,e,k,j,i){var h=void (0);g.widget("nos.thumbnailsgrid",{options:{thumbnailSize:128,pageIndex:0,pageSize:null,url:"",texts:{loading:"Loading..."},actions:[],loading:null,loaded:null,reader:null,dataParser:null,thumbFormatter:null},_data:null,_create:function(){var a=this;a.uiPager=g("<div></div>").addClass("wijmo-wijsuperpanel-footer  ui-state-default").appendTo(a.element)},destroy:function(){var a=this,b=a.options;a.uiPager.wijpager("destroy");a.uiPager.remove();a.element.removeClass("nos-thumbnailsgrid nos-thumbnailsgrid-size-"+b.thumbnailSize).wijsuperpanel("destroy");g.Widget.prototype.destroy.apply(this,arguments)},_init:function(){var b=this,d=b.options;if(g.inArray(d.thumbnailSize,[64,128])===-1){d.thumbnailSize=128}b.uiPager.wijpager({pageIndexChanging:function(m,l){b._trigger("pageIndexChanging",null,l);d.pageIndex=l.newPageIndex;b._load()},pageIndexChanged:function(m,l){b._trigger("pageIndexChanged");d.pageIndex=l.newPageIndex;b._load()}});b.element.addClass("nos-thumbnailsgrid nos-thumbnailsgrid-size-"+d.thumbnailSize).wijsuperpanel({showRounder:false,autoRefresh:true});b.uiContainer=g(b.element.wijsuperpanel("getContentElement"));b.uiOverlay=g("<div></div>").addClass("nos-thumbnailsgrid-overlay ui-widget-overlay").appendTo(b.element);b.uiOverlayText=g("<span><span></span>"+d.texts.loading+"</span>").addClass("nos-thumbnailsgrid-loadingtext ui-widget-content ui-corner-all").find("span").addClass("ui-icon ui-icon-clock").end().appendTo(b.element);b.uiOverlayText.css({marginLeft:(b.uiOverlayText.width()*-1/2)+"px",marginTop:(b.uiOverlayText.height()*-1/2)+"px"});if(d.pageSize===null){b._displayItem({title:"Test"});var c=b.uiContainer.find(".nos-thumbnailsgrid-thumb"),a=b.uiContainer.parent();b.itemDimension={width:c.outerWidth(true),height:c.outerHeight(true)};b.uiContainer.empty();d.pageSize=Math.floor(a.width()/b.itemDimension.width)*Math.max(1,Math.floor(a.height()/b.itemDimension.height))}b.dataSource=new wijdatasource({dynamic:true,proxy:new wijhttpproxy({url:d.url,dataType:"json",error:function(n,q,p){if(n.status==403){var m={title:"You've been inactive for too long",text:"Please log-in again.",type:"error"};try{var l=g.parseJSON(n.responseText);if(l.login_page){m.text=m.text.replace("log-in again",'<a href="'+l.login_page+'">log-in again</a>')}}catch(o){}i.notify(m)}b.uiOverlay.hide();log(n,q,p)},data:{}}),loading:function(m,l){m.proxy.options.data=g.extend(m.proxy.options.data,l.data);b.uiOverlay.add(b.uiOverlayText).show();if(g.isFunction(d.loading)){d.loading(m,l)}},loaded:function(m,l){if(g.isFunction(d.loaded)){d.loaded(m,l)}b.uiPager.wijpager("option",{pageCount:Math.ceil(m.data.totalRows/l.data.paging.pageSize),pageIndex:l.data.paging.pageIndex});b._data=m.data;b._display(m.data);b.uiOverlay.add(b.uiOverlayText).hide()},reader:d.reader});b._load()},_load:function(){var a=this,b=a.options;a.dataSource.load({data:{paging:{pageIndex:b.pageIndex,pageSize:b.pageSize}},afterRefresh:null,beforeRefresh:null});return a},_display:function(b){var a=this,d=a.options,c=a.uiContainer.empty().parent();a.uiContainer.detach();g.each(b,function(l){var m=this;if(g.isFunction(d.dataParser)){m={item:d.dataParser(d.thumbnailSize,m,l),noParseData:m}}else{m={item:m,noParseData:m}}a._displayItem(m,l)});a.uiContainer.appendTo(c);a._trigger("rendered");return a},_displayItem:function(m,n){var s=this,d=s.options,r=m.item,a=m.noParseData;r=g.extend({title:"",thumbnail:null,thumbnailAlternate:null},r);var c=g("<div></div>").addClass("nos-thumbnailsgrid-thumb wijmo-wijgrid ui-widget-content").data("thumbnail",{data:m,index:n}).appendTo(s.uiContainer),l=g('<table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td></td></tr></tbody></table>').addClass("nos-thumbnailsgrid-thumb-grid wijmo-wijgrid-root wijmo-wijgrid-table").attr("title",r.title).css({borderCollapse:"separate","-moz-user-select":"-moz-none"}).hover(function(){l.parent().addClass("ui-state-hover")},function(){l.parent().removeClass("ui-state-hover")}).click(function(){s.select(n)}).appendTo(c).find("tbody").addClass("ui-widget-content wijmo-wijgrid-data").find("tr").addClass("wijmo-wijgrid-row ui-widget-content wijmo-wijgrid-datarow").find("td").addClass("wijgridtd"),b=g("<div></div>").addClass("nos-thumbnailsgrid-thumb-container-img wijmo-wijgrid-innercell").appendTo(l),q=g("<div></div>").addClass("nos-thumbnailsgrid-thumb-title wijmo-wijgrid-innercell").text(r.title).appendTo(l);s._itemThumbnail(b,r,n);var p=i.appdeskActions(d.actions,a);p.appendTo(c);if(g.isFunction(d.thumbFormatter)){d.thumbFormatter({"$container":c,item:{data:r,index:n}})}return s},_itemThumbnail:function(a,d,c){var b=this,l=b.options,m=d.thumbnail||d.thumbnailAlternate;if(m){b._loadImg(a,d,m)}else{b._loadImgDefault(a)}return b},_loadImg:function(a,c,l){var b=this,d=b.options;g("<img />").error(function(){if(l===c.thumbnail&&c.thumbnailAlternate){b._loadImg(a,c,c.thumbnailAlternate)}else{b._loadImgDefault(a)}}).load(function(){var m=g(this);m.prependTo(a).css({marginTop:"-"+(m.height()/2)+"px",marginLeft:"-"+(m.width()/2)+"px"})}).addClass("nos-thumbnailsgrid-thumb-img").attr("src",l);return b},_loadImgDefault:function(a){var b=this,c=b.options;g("<div></div>").addClass("nos-thumbnailsgrid-thumb-img-default").prependTo(a);return b},select:function(b){var a=this,l=a.options;if(b===h){var d=a.uiContainer.find(".nos-thumbnailsgrid-thumb:has(wijmo-wijgrid-current-cell)");if(d.length){var c=d.data("thumbnail");return c.index}return null}else{a.uiContainer.find("td").removeClass("wijmo-wijgrid-current-cell ui-state-highlight");var d=a.uiContainer.find(".nos-thumbnailsgrid-thumb").eq(b);if(d.length){var c=d.data("thumbnail");d.find(".wijgridtd").eq(0).addClass("wijmo-wijgrid-current-cell ui-state-highlight");a._trigger("selectionChanged",null,{item:c})}else{a._trigger("selectionChanged");return false}}return a},unselect:function(){this._trigger("selectionChanged")},setSize:function(c,a){var b=this;if(c!==null){b.element.width(c)}if(a!==null){b.element.height(a)}return b},data:function(){return this._data}});return i});
define("jquery-nos-appdesk",["jquery","log","order!jquery-ui","order!wijmo-open","order!wijmo-complete","order!jquery-nos","order!jquery-nos-thumbnailsgrid","order!jquery-nos-listgrid","order!jquery-nos-treegrid","order!jquery-nos-preview"],function(g,f,e,k,j,i){var h=void (0);g.widget("nos.appdesk",{options:{adds:[],inspectors:[],thumbnails:false,defaultView:"grid",locales:{},texts:{allLanguages:"All languages",addDropDown:"Select an action",columns:"Columns",showFiltersColumns:"Filters column header",visibility:"Visibility",settings:"Settings",vertical:"Vertical",horizontal:"Horizontal",hidden:"Hidden",save:"Save",cancel:"Cancel",mainView:"Main view",item:"item",items:"items",showNbItems:"Showing {{x}} items out of {{y}}",showOneItem:"Show 1 item",showNoItem:"No item",showAll:"Show all items",views:"Views",viewGrid:"Grid",viewTreeGrid:"Tree grid",viewThumbnails:"Thumbnails",loading:"Loading..."},values:{},columnVisibilityChange:null,slidersChange:null,splitters:{vertical:null,horizontal:null},views:{},selectedView:null,selectedLang:null,fromView:null,name:null,grid:{}},pageIndex:0,showFilter:false,gridRendered:false,resizing:true,init:false,itemSelected:null,variantColumnsProperties:{visible:true,width:true,showFilter:true},variantInspectorsProperties:{hide:true,vertical:true},_create:function(){var a=this,b=a.options;a.element.addClass("nos-appdesk");a.dispatcher=a.element.closest(".nos-dispatcher");if(!a.dispatcher.size()){a.dispatcher=a.element}a.uiHeaderBar=g("<div></div>").addClass("nos-appdesk-headerbar").appendTo(a.element);a.uiAdds=g("<div></div>").addClass("nos-appdesk-adds").appendTo(a.uiHeaderBar);a.uiAddsButton=g('<button type="button"></button>').addClass("primary").appendTo(a.uiAdds);a.uiViewsDropDownContainer=g("<div></div>").addClass("nos-appdesk-dropdownviews").appendTo(a.uiHeaderBar);a.uiLangsDropDownContainer=g("<div></div>").addClass("nos-appdesk-dropdownlang").appendTo(a.uiHeaderBar);a.uiSplitterVertical=g("<div></div>").addClass("nos-appdesk-splitter-v").appendTo(a.element);a.uiSplitterVerticalRight=g("<div></div>").appendTo(a.uiSplitterVertical);a.uiInspectorsVertical=g("<ul></ul>").addClass("nos-appdesk-inspectors nos-appdesk-inspectors-v").appendTo(a.uiSplitterVerticalRight);a.uiSplitterVerticalLeft=g("<div></div>").appendTo(a.uiSplitterVertical);a.uiSplitterHorizontal=g("<div></div>").appendTo(a.uiSplitterVerticalLeft);a.uiSplitterHorizontalTop=g("<div></div>").appendTo(a.uiSplitterHorizontal);a.uiInspectorsHorizontal=g("<ul></ul>").addClass("nos-appdesk-inspectors nos-appdesk-inspectors-h").appendTo(a.uiSplitterHorizontalTop);a.uiSplitterHorizontalBottom=g("<div></div>").appendTo(a.uiSplitterHorizontal);a.uiSearchBar=g("<div><form><div></div></form></div>").addClass("nos-appdesk-searchbar-container wijmo-wijgrid ui-widget ui-widget-header ui-state-default").appendTo(a.uiSplitterHorizontalBottom).find("form").addClass("wijmo-wijgrid-headerrow wijmo-wijgrid-innercell").find("div").addClass("nos-appdesk-searchbar wijmo-wijgrid-headertext");a.uiNbResult=g("<div></div>").addClass("nos-appdesk-nbresult").appendTo(a.uiSearchBar);a.uiInputContainer=g("<div></div>").addClass("nos-appdesk-input-container ui-widget-content ui-corner-all").appendTo(a.uiSearchBar);a.uiViewsButtons=g("<div></div>").addClass("nos-appdesk-views-button").appendTo(a.uiSearchBar);a.uiSearchIcon=g("<div></div>").addClass("nos-appdesk-search-icon ui-icon ui-icon-search").appendTo(a.uiInputContainer);a.uiSearchInput=g('<input type="search" name="search" placeholder="Search" value="" />').addClass("nos-appdesk-search-input ui-helper-reset").appendTo(a.uiInputContainer);a.uiInspectorsTags=g("<div></div>").addClass("nos-appdesk-inspectorstags").appendTo(a.uiInputContainer);a.uiResetSearch=g('<a href="#"></a>').text(b.texts.showAll).addClass("nos-appdesk-reset-search").appendTo(a.uiInputContainer);a.uiuiResetSearchIcon=g("<span></span>").text(b.texts.showAll).addClass("ui-icon").appendTo(a.uiResetSearch);a.uiGridTitle=g("<div></div>").addClass("nos-appdesk-title").appendTo(a.uiSearchBar);a.uiPaginationLabel=g("<span></span>").addClass("nos-appdesk-pagination");a.uiGrid=g("<table></table>").appendTo(a.uiSplitterHorizontalBottom);a.uiTreeGrid=g("<table></table>").appendTo(a.uiSplitterHorizontalBottom);a.uiThumbnail=g("<div></div>").appendTo(a.uiSplitterHorizontalBottom)},_init:function(){var a=this,b=a.options;if(!g.isPlainObject(b.thumbnails)){b.thumbnails=false}else{b.thumbnails=g.extend({thumbnailSize:128},b.thumbnails)}a._css()._uiAdds()._uiSplitters()._uiInspectors()._uiSearchBar()._uiList()._uiLangsDropDown()._uiViewsDropDown();a.init=true},_css:function(){var q=this,b=q.options;if(!g("style#inspectorsGrid").length){var d="";for(var n=0,c=document.styleSheets.length;n<c;n++){var l=document.styleSheets[n];if(l.href&&/wijmo/.test(l.href)){var m=l.rules?l.rules:l.cssRules;for(var a=0,p=m.length;a<p;a++){if(m[a].selectorText===".ui-widget-content"){d+=".nos-appdesk .nos-appdesk-splitter-v .wijmo-wijsplitter-v-panel2 .wijmo-wijsplitter-h-panel1 .wijmo-wijgrid-alternatingrow {background:"+m[a].style.background+";}";d+=".nos-appdesk .nos-appdesk-splitter-v .wijmo-wijsplitter-v-panel1 .wijmo-wijgrid-alternatingrow {background:"+m[a].style.background+";}"}if(m[a].selectorText===".wijmo-wijgrid tr.wijmo-wijgrid-row.ui-state-hover, .wijmo-wijgrid .wijmo-wijgrid-current-cell, .wijmo-wijgrid td.wijmo-wijgrid-rowheader.ui-state-active"){d+=".nos-appdesk .nos-appdesk-splitter-v .wijmo-wijsplitter-v-panel2 .wijmo-wijsplitter-h-panel1 .wijmo-wijgrid-alternatingrow.ui-state-hover {background:"+m[a].style.background+";}";d+=".nos-appdesk .nos-appdesk-splitter-v .wijmo-wijsplitter-v-panel1 .wijmo-wijgrid-alternatingrow.ui-state-hover {background:"+m[a].style.background+";}"}}}}g('<style type="text/css" id="inspectorsGrid">'+d+"</style>").appendTo("head")}return q},_uiAdds:function(){var a=this,c=a.options;if(!g.isArray(c.adds)||!c.adds.length){a.uiAdds.hide();return a}var b=c.adds.shift();a.uiAddsButton.button({label:b.label,icons:{primary:"ui-icon ui-icon-plus",secondary:null}}).click(function(d){d.preventDefault();d.stopImmediatePropagation();if(g.isFunction(b.action)){b.action(g(this))}else{i(this).tab("add",{iframe:true,url:b.url,label:b.label})}});g.each(c.adds,function(d,l){g('<a href="#"></a>').addClass("nos-appdesk-action-secondary").text(this.label).appendTo(a.uiAdds).click(function(m){m.preventDefault();m.stopImmediatePropagation();if(g.isFunction(l.action)){l.action(g(this))}else{i(this).tab("add",{iframe:true,url:l.url,label:l.label})}})});return a},_uiLangsDropDown:function(){var a=this,b=a.options;if(g.isEmptyObject(b.locales)){return a}a.uiLangsDropDown=g("<select></select>").appendTo(a.uiLangsDropDownContainer);a.uiLangsDropDown.append(g("<option></option>").attr({value:"",selected:(!b.selectedLang)}).append(b.texts.allLanguages));g.each(b.locales,function(d,c){a.uiLangsDropDown.append(g("<option></option>").attr({value:d,selected:(b.selectedLang==d)}).append(c))});a.uiLangsDropDown.wijdropdown();a.uiLangsDropDown.change(function(){var c=i(this);b.selectedLang=c.val();c.xhr("saveUserConfig",b.name+".selectedLang",b.selectedLang);a.gridReload();a.dispatcher.data("nosLang",b.selectedLang).trigger("langChange")});return a},_uiViewsDropDown:function(){var a=this,b=a.options;if(b.views[b.selectedView]&&b.views[b.selectedView].virtual){return a}a.uiViewsDropDown=g("<select></select>").appendTo(a.uiViewsDropDownContainer);g.each(b.views,function(d,c){if(c.virtual){return}a.uiViewsDropDown.append(g("<option></option>").attr({value:d,selected:(b.selectedView==d)}).append(c.name))});a.uiViewsDropDown.append(g("<option></option>").attr({value:"custom",selected:(b.selectedView=="custom")}).append("Custom view"));a.uiViewsDropDown.append(g("<option></option>").attr("value","edit_custom").append("Edit custom view"));a.uiViewsDropDown.wijdropdown();a.uiViewsDropDown.change(function(){var d=i(this);if(d.val()=="edit_custom"){var c=a._uiCustomViewDialog();a.uiCustomViewDialog=i(a.uiViewsDropDown).dialog({title:b.texts.settings,contentUrl:null,content:c,onLoad:function(){c.css({height:"90%"});c.wijtabs({alignment:"left",scrollable:true,show:function(m,l){g(l.panel).find(".superpanel").wijsuperpanel({autoRefresh:true,hScroller:{scrollMode:"buttons"}});var n=g(l.panel).find("#layout_settings");a._uiCustomViewDialogRefreshLayout(n);n.find(".panels").sortable({connectWith:".panels",update:function(){a._uiCustomViewDialogRefreshLayout(n)},change:function(){a._uiCustomViewDialogRefreshLayout(n)},start:function(o,p){g(p.item).addClass("moving");a._uiCustomViewDialogRefreshLayout(n)},stop:function(o,p){g(p.item).removeClass("moving");a._uiCustomViewDialogRefreshLayout(n)},placeholder:"droping"});a._uiCustomViewDialogRefreshColumns(g(l.panel).find(".columns-settings"))}});c.after(g("<div></div>").css({textAlign:"right"}).append(g("<button />").button({label:b.texts.cancel,icons:{primary:"ui-icon-gear"}}).click(function(){a.uiCustomViewDialog.dialog("close")})).append(g("<button />").button({label:b.texts.save,icons:{primary:"ui-icon-gear"}}).click(function(){a._uiCustomViewDialogSave();a.uiCustomViewDialog.dialog("close")})))}});d.find("option").attr("selected","");d.find("option[value=custom]").attr("selected","selected");d.wijdropdown("refresh");d.xhr("saveUserConfig",b.name+".selectedView",g(this).val())}else{d.xhr("saveUserConfig",b.name+".selectedView",g(this).val());a.element.trigger("reloadView",{selectedView:g(this).val()})}});return a},_uiCustomViewDialog:function(){var a=this,c=a.options,b=g("<div><ul></ul></div>");a._uiCustomViewDialogAddLayoutTab(b);a._uiCustomViewDialogAddMainViewTab(b);a._uiCustomViewDialogAddInspectorsTab(b);return b},_uiCustomViewDialogAddMainViewTab:function(b){var a=this,c=a.options;a._uiCustomViewDialogAddItem(b,c.texts.mainView,a._uiCustomViewDialogGetWidgetContentSettings("settings-main-view",c.texts.mainView,a.options));b.find(" > ul > li:last").addClass("separator")},_uiCustomViewDialogAddInspectorsTab:function(c){var a=this,d=a.options;for(var b=0;b<d.inspectors.length;b++){a._uiCustomViewDialogAddItem(c,d.inspectors[b].label,a._uiCustomViewDialogGetWidgetContentSettings("settings-inspector-"+b,d.inspectors[b].label,d.inspectors[b]))}},_uiCustomViewDialogGetWidgetContentSettings:function(a,n,c){var r=this,b=r.options;var l=g('<div class="content-settings columns-settings"></div>').attr({id:a});l.append(g("<h1></h1>").append(n));if(c.grid){l.append(g("<h2></h2>").append("Columns"));var p=g('<ul class="widget-columns"></ul>');var d=c.grid.columns;var m;for(m=0;m<d.length;m++){if(d[m].visible!==false){p.append(g('<li style="float: left;"></li>').data("column-id",m).append(g('<div class="title-zone"></div>').append(d[m].headerText)))}}l.append(p);l.append(g("<h2></h2>").append("Invisible columns"));var q=g('<ul class="not-columns widget-columns"></ul>');for(m=0;m<d.length;m++){if(d[m].visible===false){q.append(g('<li style="float: left;"></li>').data("column-id",m).append(g('<div class="title-zone"></div>').append(d[m].headerText)))}}l.append(q);l.find(".widget-columns").sortable({placeholder:"placeholder",connectWith:".widget-columns",update:function(){r._uiCustomViewDialogRefreshColumns(g(this).parent())},change:function(){r._uiCustomViewDialogRefreshColumns(g(this).parent())},start:function(o,s){g(s.item).addClass("moving");r._uiCustomViewDialogRefreshColumns(g(this).parent())},stop:function(o,s){g(s.item).removeClass("moving");r._uiCustomViewDialogRefreshColumns(g(this).parent())}})}return l},_uiCustomViewDialogRefreshColumns:function(a){var b=a.find("ul");b.each(function(){var c=g(this).find("li").not(".moving");c.removeClass("last");c.last().addClass("last");c.css({width:(g(this).width()/c.length)-1})})},_uiCustomViewDialogAddLayoutTab:function(t){var s=this,d=s.options;var a=g('<form id="layout_settings"></form>');a.append(g("<h1></h1>").append("Layout"));a.append(g('<div class="layout"></div>').append(g('<ul class="left-panel panels"></ul>')).append(g('<div class="right-side"></div>').append(g('<div class="inside"></div>').append(g('<ul class="top-panel panels"></ul>')).append(g('<div class="content"></div>')))));var b=g('<div class="not-layout superpanel"></div>').append('<ul class="invisible-panel panels"></ul>');s._uiCustomViewDialogAddItem(t,"Layout",a);var c=a.find(".left-panel");var l=a.find(".top-panel");var r=b.find(".invisible-panel");a.find(".not-layout").wijsuperpanel({hScroller:{scrollMode:"buttons"}});for(var q=0;q<d.inspectors.length;q++){var m=!d.inspectors[q].hide;var n=d.inspectors[q].vertical;var p=g('<li class="layout-inspector"></li>').data("inspector-id",q).append(g("<div></div>").append(d.inspectors[q].label));if(m){if(n){c.append(p)}else{l.append(p)}}else{r.append(p)}}a.append(b);s._uiCustomViewDialogRefreshLayout(a)},_uiCustomViewDialogRefreshLayout:function(n){var c=n.find(".left-panel"),b=n.find(".top-panel"),a=n.find(".invisible-panel"),l=c.find("li").not(".moving");l.css({height:(c.height()-l.length)/l.length,width:""});l.removeClass("last");g(l[l.length-1]).addClass("last");var m=b.find("li").not(".moving");m.css({width:(b.width()-m.length)/m.length,height:""});m.removeClass("last");g(m[m.length-1]).addClass("last");var d=a.find("li").not(".moving");d.css({width:"",height:""});d.removeClass("last");g(d[d.length-1]).addClass("last");a.css({width:Math.max((d.length+1)*(d.width()+1),100)})},_uiCustomViewDialogSave:function(){var a=this,n=a.options;for(var b=0;b<n.inspectors.length;b++){if(n.inspectors[b].grid){var m=n.inspectors[b].grid.columns;var p=[];n.inspectors[b].grid.columnsOrder=[];a.uiCustomViewDialog.find("#settings-inspector-"+b+" > ul li").each(function(o,q){var s=g(this);var r=m[s.data("column-id")];r.visible=!s.closest("ul").hasClass("not-columns");p.push(r);n.inspectors[b].grid.columnsOrder.push(r.setupkey)});n.inspectors[b].grid.columns=p}}n.inspectorsOrder=[];var l=[];var d=a.uiCustomViewDialog.find("#layout_settings");d.find(".layout-inspector").each(function(){var o=a.options.inspectors[g(this).data("inspector-id")];var q=g(this).closest(".panels");o.hide=q.hasClass("invisible-panel");o.vertical=q.hasClass("left-panel");l.push(o);n.inspectorsOrder.push(o.setupkey)});a.options.inspectors=l;p=[];n.grid.columnsOrder=[];a.uiCustomViewDialog.find("#settings-main-view > ul li").each(function(o,q){var s=g(this),r=n.grid.columns[s.data("column-id")];n.grid.columnsOrder.push(r.setupkey);r.visible=!s.closest("ul").hasClass("not-columns");p.push(r)});a.options.grid.columns=p;a.element.find(".nos-appdesk-inspector").remove();var c=a._saveUserConfiguration();a.element.trigger("reloadView",{selectedView:"custom",custom:c})},_uiCustomViewDialogAddItem:function(a,c,b){if(typeof this.idMenu=="undefined"){this.idMenu=0}a.find("> ul").append('<li><a href="#settings_menu_popup_item_'+this.idMenu+'">'+c+"</a></li>");a.append(g('<div id="settings_menu_popup_item_'+this.idMenu+'"></div>').append(b));this.idMenu++},_saveUserConfiguration:function(){var a=this,c=a.options,b={from:c.selectedView!="custom"?c.selectedView:c.fromView,appdesk:a._getInspectorsConfiguration(c)};b.appdesk.grid=a._getGridConfiguration(c.grid);a.element.nos().xhr("saveUserConfig",c.name,{selectedView:"custom",custom:b});return b},_getGridConfiguration:function(c){var b={columns:{},columnsOrder:c.columnsOrder.join(",")};var d=this._getParameters(c.columns,this.variantColumnsProperties);for(var a=0;a<c.columns.length;a++){b.columns[c.columns[a].setupkey]=d[a]}return b},_getInspectorsConfiguration:function(a){var d={inspectors:{},inspectorsOrder:a.inspectorsOrder.join(",")};var c=this._getParameters(a.inspectors,this.variantInspectorsProperties);for(var b=0;b<this.options.inspectors.length;b++){if(!c[b]["vertical"]){c[b]["vertical"]=false}d.inspectors[a.inspectors[b].setupkey]=c[b];if(this.options.inspectors[b]["grid"]){d.inspectors[a.inspectors[b].setupkey]["grid"]=this._getGridConfiguration(this.options.inspectors[b]["grid"])}}return d},_getParameters:function(m,l){var a=[];for(var d=0;d<m.length;d++){var c={};for(var b in m[d]){if(l[b]){c[b]=m[d][b]}}a.push(c)}return a},_uiSplitters:function(){var c=this,l=function(){c.uiSplitterHorizontal.wijsplitter("refresh");c._resizeInspectorsV(true)._resizeInspectorsH(true)._resizeList(true)},a=function(){c._resizeInspectorsH(true)._resizeList(true)},d=g.extend(true,{orientation:"vertical",splitterDistance:200,showExpander:false,fullSplit:false,panel1:{minSize:150,scrollBars:"none"},panel2:{minSize:200,scrollBars:"none"},expanded:function(){l()},collapsed:function(){l()},sized:function(){c.resizing=true;l()}},c.options.splitters.vertical),b=g.extend(true,{orientation:"horizontal",fullSplit:true,splitterDistance:200,showExpander:false,panel1:{minSize:200,scrollBars:"none"},panel2:{minSize:200,scrollBars:"none"},expanded:function(){a()},collapsed:function(){a()},sized:function(){c.resizing=true;a()}},c.options.splitters.horizontal);c.uiSplitterVertical.wijsplitter(d).find(".ui-resizable-handle").mousedown(function(){c.resizing=false});c.uiSplitterHorizontal.wijsplitter(b).find(".ui-resizable-handle").mousedown(function(){c.resizing=false});return c},_uiInspectors:function(){var a=this,b=a.options;g.each(b.inspectors,function(){if(!this.hide){g("<li></li>").addClass("nos-appdesk-inspector ui-widget-content").data("inspector",this).appendTo(this.vertical?a.uiInspectorsVertical:a.uiInspectorsHorizontal)}});a._resizeInspectorsV(true)._resizeInspectorsH(true);a.uiInspectorsVertical.find("> li").add(a.uiInspectorsHorizontal.find("> li")).each(function(){a._loadInspector(g(this))});return a},_loadInspector:function(d){var a=this,c=d.data("inspector"),b=a.options;c.selectionChanged=function(p,n){var l=false,m=c.inputName;if(c.inputName.substr(-2,2)==="[]"){m=c.inputName.substr(0,c.inputName.length-2);l=true}if(!l){a.uiInspectorsTags.find("span."+m).remove()}else{var q=false;a.uiInspectorsTags.find("span."+m).each(function(){if(g(this).find("input").val()===p){q=true;return false}});if(q){return true}}a.pageIndex=0;a.uiInspectorsTags.wijsuperpanel("destroy");var o=g("<span></span>").addClass("nos-appdesk-inspectorstag ui-state-default ui-corner-all "+m).text(n).appendTo(a.uiInspectorsTags);g('<input type="hidden" name="'+c.inputName+'" />').val(p).appendTo(o);g('<a href="#"></a>').addClass("ui-icon ui-icon-close").click(function(r){r.preventDefault();g(this).parent().remove();a.gridReload()}).appendTo(o);a.uiInspectorsTags.wijsuperpanel({showRounder:false,hScroller:{scrollMode:"buttons"}});if(b.defaultView==="treeGrid"){a.uiViewsButtons.find("#view_grid").click().blur()}else{a.gridReload()}};d.data("inspector",c);if(g.isFunction(c.url)){c.url.call(a,d)}else{g.ajax({url:c.url,dataType:"html"}).done(function(l){g(l).appendTo(d)}).fail(function(l,n,m){log("error");log(n);log(m)})}return a},_uiSearchBar:function(){var b=this,c=b.options;b.uiResetSearch.hide();b.uiSearchInput.on("keypress",function(d){var l=g.ui.keyCode;b.pageIndex=0;if(b.timeoutSearchInput){clearTimeout(b.timeoutSearchInput)}if(g.inArray(d.keyCode,[l.ENTER,l.NUMPAD_ENTER])!=-1){if(c.defaultView==="treeGrid"){b.uiViewsButtons.find("#view_grid").click().blur()}else{b.gridReload()}return false}b.timeoutSearchInput=setTimeout(function(){if(c.defaultView==="treeGrid"){b.uiViewsButtons.find("#view_grid").click().blur()}else{b.gridReload()}},500)});b.uiResetSearch.click(function(d){d.preventDefault();b.uiSearchInput.val("");b.uiInspectorsTags.wijsuperpanel("destroy");b.uiInspectorsTags.empty();b.gridReload()});b.uiInspectorsTags.height(b.uiInputContainer.height()).width(parseInt(b.uiSearchBar.width()*0.3)).wijsuperpanel({showRounder:false,hScroller:{scrollMode:"buttons"}});var a=[{id:"treeGrid",text:c.texts.viewTreeGrid,icon:"view-tree"},{id:"grid",text:c.texts.viewGrid,icon:"view-list"},{id:"thumbnails",size:64,text:c.texts.viewThumbnails,icon:"view-thumbs-small"},{id:"thumbnails",size:128,text:c.texts.viewThumbnails,icon:"view-thumbs-big"}];g.each(a,function(){var d=this;if(c[d.id]){g('<label for="view_'+d.id.toLowerCase()+(d.size?"_"+d.size:"")+'"></label>').text(d.text+(d.size?" "+d.size+"px":"")).appendTo(b.uiViewsButtons);g('<input type="radio" id="view_'+d.id.toLowerCase()+(d.size?"_"+d.size:"")+'" name="view" '+(c.defaultView===d.id&&(!d.size||d.size===c.thumbnails.thumbnailSize)?'checked="checked"':"")+'" />').appendTo(b.uiViewsButtons).button({text:false,label:d.text+(d.size?" "+d.size+"px":""),icons:{primary:"ui-icon "+d.icon,secondary:null}}).click(function(){if(c.defaultView!==d.id||(d.id==="thumbnails"&&c.thumbnails.thumbnailSize!==d.size)){b.uiViewsButtons.find("button").removeClass("ui-state-active");g(this).addClass("ui-state-active");c.defaultView=d.id;if(d.size){c.thumbnails.thumbnailSize=d.size}b._uiList()}})}});if(b.uiViewsButtons.find("input").length>1){b.uiViewsButtons.buttonset()}else{b.uiViewsButtons.hide()}return b},_uiList:function(){var a=this,b=a.options;a.gridRendered=false;a.uiGridTitle.text(b.texts.item);a.uiThumbnail.thumbnailsgrid("destroy").empty().hide();a.uiGrid.noslistgrid("destroy").empty().hide();a.uiTreeGrid.nostreegrid("destroy").empty().hide();if(b.defaultView==="thumbnails"){a.uiThumbnail.show();a._uiThumbnail()}else{if(b.defaultView==="treeGrid"){a.uiTreeGrid.show();a._uiTreeGrid()}else{a.uiGrid.show();a._uiGrid()}}return a},_uiGrid:function(){var c=this,m=c.options,b=c.uiGrid.offset(),d=c.element.offset(),a=c.element.height()-b.top+d.top,l=i.grid.getHeights();c.uiGrid.css({height:a,width:"100%"}).noslistgrid(g.extend({columnsAutogenerationMode:"none",selectionMode:"singleRow",showFilter:c.showFilter,allowSorting:true,scrollMode:"auto",allowPaging:true,pageIndex:c.pageIndex,pageSize:Math.floor((a-l.footer-l.header-(c.showFilter?l.filter:0))/l.row),allowColSizing:true,allowColMoving:true,data:new wijdatasource({dynamic:true,proxy:new wijhttpproxy({url:m.grid.proxyUrl,dataType:"json",error:function(n,p,o){log(n,p,o)},data:{}}),loading:function(p,n){var o=n.data.paging;c.pageIndex=o.pageIndex;if(c.gridRendered){c.uiGrid.noslistgrid("currentCell",-1,-1)}p.proxy.options.data.lang=m.selectedLang||"";p.proxy.options.data.inspectors=c._jsonInspectors();p.proxy.options.data.offset=o.pageIndex*o.pageSize;p.proxy.options.data.limit=o.pageSize},loaded:function(o,n){if(o.data.totalRows===0){c.uiPaginationLabel.text(m.texts.showNoItem);c.uiNbResult.text(m.texts.showNoItem)}else{if(o.data.totalRows===1){c.uiPaginationLabel.text(m.texts.showOneItem);c.uiNbResult.text("1 "+m.texts.item)}else{c.uiPaginationLabel.text(m.texts.showNbItems.replace("{{x}}",o.data.length).replace("{{y}}",o.data.totalRows));c.uiNbResult.text(o.data.totalRows+" "+m.texts.items)}}c.uiNbResult.show();c.uiResetSearch[c.uiInspectorsTags.find(".nos-appdesk-inspectorstag").length||c.uiSearchInput.val()?"show":"hide"]()},reader:{read:function(o){var n=parseInt(o.data.total,10);o.data=o.data.items;o.data.totalRows=n}}}),pageIndexChanging:function(){c.element.trigger("selectionChanged.appdesk",false)},cellStyleFormatter:function(n){if(n.$cell.is("th")){n.$cell.removeClass("ui-state-active")}if(n.state&g.wijmo.wijgrid.renderState.selected&&n.$cell.hasClass("ui-state-default")){n.$cell.removeClass("ui-state-highlight")}if(n.state&g.wijmo.wijgrid.renderState.selected){n.$cell.removeClass("wijmo-wijgrid-current-cell")}},currentCellChanging:function(){return c.gridRendered},currentCellChanged:function(o){if(o){var p=g(o.target).noslistgrid("currentCell").row(),n=p?p.data:false;if(n){c.itemSelected=g.extend({},n);c.element.trigger("selectionChanged.appdesk",n)}}return true},rendering:function(){c.gridRendered=false},rendered:function(){c.gridRendered=true;c.uiGrid.css("height","auto");var n=c.uiGrid.noslistgrid("selection");n&&n.clear();if(c.itemSelected!==null){g.each(c.uiGrid.noslistgrid("data")||[],function(o,p){if(p._model==c.itemSelected._model&&p._id==c.itemSelected._id){n.addRows(o)}})}},dataLoading:function(n){c.uiPaginationLabel.detach()},loaded:function(){c.uiSplitterHorizontalBottom.find(".wijmo-wijgrid-footer").prepend(c.uiPaginationLabel)}},m.grid));return c},_uiTreeGrid:function(){var c=this,l=c.options,b=c.uiTreeGrid.offset(),d=c.element.offset(),a=c.element.height()-b.top+d.top;c.uiTreeGrid.css({height:a,width:"100%"}).nostreegrid(g.extend(true,{treeUrl:l.treeGrid.proxyUrl,treeOptions:{lang:l.selectedLang||""},columnsAutogenerationMode:"none",selectionMode:"singleRow",allowSorting:true,scrollMode:"auto",allowColSizing:true,allowColMoving:true,sorting:function(n,m){g.each(l.grid.columns,function(){var o=this;if(o.headerText===m.column.headerText){o.sortDirection=m.sortDirection}else{o.sortDirection="none"}});c.uiViewsButtons.find("#view_grid").click().blur();return false},cellStyleFormatter:function(m){if(m.$cell.is("th")){m.$cell.removeClass("ui-state-active")}if(m.state&g.wijmo.wijgrid.renderState.selected&&m.$cell.hasClass("ui-state-default")){m.$cell.removeClass("ui-state-highlight")}if(m.state&g.wijmo.wijgrid.renderState.selected){m.$cell.removeClass("wijmo-wijgrid-current-cell")}},currentCellChanging:function(){return c.gridRendered},currentCellChanged:function(n){if(n){var o=g(n.target).nostreegrid("currentCell").row(),m=o?o.data:false;if(m){c.itemSelected=g.extend({},m);c.element.trigger("selectionChanged.appdesk",m)}}return true},rendering:function(){c.gridRendered=false},rendered:function(){c.gridRendered=true;c.uiTreeGrid.css("height","auto");var m=c.uiTreeGrid.nostreegrid("selection");m&&m.clear();if(c.itemSelected!==null){g.each(c.uiTreeGrid.nostreegrid("data")||[],function(n,o){if(o._model==c.itemSelected._model&&o._id==c.itemSelected._id){m.addRows(n)}})}},dataLoading:function(m){c.uiPaginationLabel.detach()},loaded:function(){c.uiSplitterHorizontalBottom.find(".wijmo-wijgrid-footer").prepend(c.uiPaginationLabel)}},l.grid));return c},_uiThumbnail:function(){var c=this,l=c.options,b=c.uiThumbnail.offset(),d=c.element.offset(),a=c.element.height()-b.top+d.top;c.uiThumbnail.css("height",a).thumbnailsgrid(g.extend({pageIndex:0,url:l.grid.proxyUrl,loading:function(o,m){var n=m.data.paging;c.pageIndex=n.pageIndex;o.proxy.options.data.lang=l.selectedLang||"";o.proxy.options.data.inspectors=c._jsonInspectors();o.proxy.options.data.offset=n.pageIndex*n.pageSize;o.proxy.options.data.limit=n.pageSize},loaded:function(n,m){if(n.data.totalRows===0){c.uiPaginationLabel.text(l.texts.showNoItem);c.uiNbResult.text(l.texts.showNoItem)}else{if(n.data.totalRows===1){c.uiPaginationLabel.text(l.texts.showOneItem);c.uiNbResult.text("1 "+l.texts.item)}else{c.uiPaginationLabel.text(l.texts.showNbItems.replace("{{x}}",n.data.length).replace("{{y}}",n.data.totalRows));c.uiNbResult.text(n.data.totalRows+" "+l.texts.items)}}c.uiNbResult.show();c.uiResetSearch[c.uiInspectorsTags.find(".nos-appdesk-inspectorstag").length||c.uiSearchInput.val()?"show":"hide"]()},rendered:function(){c.uiSplitterHorizontalBottom.find(".wijmo-wijpager").prepend(c.uiPaginationLabel);if(c.itemSelected!==null){var m=false;g.each(c.uiThumbnail.thumbnailsgrid("data")||[],function(n,o){if(o._model==c.itemSelected._model&&o._id==c.itemSelected._id){m=true;if(!c.uiThumbnail.thumbnailsgrid("select",n)){c.itemSelected=null}}});if(!m){c.uiThumbnail.thumbnailsgrid("unselect")}}},reader:{read:function(n){var m=parseInt(n.data.total,10);n.data=n.data.items;n.data.totalRows=m}},pageIndexChanging:function(){c.itemSelected=null;c.element.trigger("selectionChanged.appdesk",false)},selectionChanged:function(n,m){if(!m||g.isEmptyObject(m)){c.itemSelected=null;c.element.trigger("selectionChanged.appdesk",false)}else{c.itemSelected=g.extend({},m.item.data.noParseData);c.element.trigger("selectionChanged.appdesk",m.item.data.noParseData)}}},l.thumbnails));return c},_jsonInspectors:function(){var a=this,b=g.extend({},this.options.values||{});a.uiInspectorsTags.find("input").add(a.uiSearchInput).each(function(){var d=g(this),l=d.attr("name"),c=false;if(l.substr(-2,2)==="[]"){l=l.substr(0,l.length-2);c=true}if(!c){b[l]=d.val()}else{if(!g.isArray(b[l])){b[l]=[];b[l].push(d.val())}else{if(-1==g.inArray(d.val(),b[l])){b[l].push(d.val())}}}});return b},_resizeInspectorsV:function(b){var a=this;if(a.resizing){var c=a.uiInspectorsVertical.find(".wijmo-wijsplitter-v-bar").css({width:null,borderRightWidth:null}).end().find("> li").css({width:"100%",height:"auto"});if(c.length){c.css("height",(a.uiInspectorsVertical.height()/c.length)+"px").trigger(b?"widgetReload":"widgetResize")}else{a._hideSplitterV()}}return a},_resizeInspectorsH:function(b){var a=this;if(a.resizing){var c=a.uiInspectorsHorizontal.find(".wijmo-wijsplitter-h-bar").css({height:null,borderTopWidth:null}).end().find("> li").css({width:"auto",height:"100%"});if(c.length){c.css("width",(a.uiInspectorsHorizontal.width()/c.length)+"px").trigger(b?"widgetReload":"widgetResize")}else{a._hideSplitterH()}}a.uiSplitterVertical.wijsplitter("option","splitterDistance");a._trigger("slidersChange",null,a.slidersSettings());return a},_resizeList:function(c){var b=this,l=b.options;if(b.init){var a=b.uiSplitterHorizontalBottom.height()-b.uiSearchBar.outerHeight(true);if(l.defaultView==="thumbnails"){if(c){b._uiList()}else{b.uiThumbnail.thumbnailsgrid("setSize",b.uiSplitterHorizontalBottom.width(),a)}}else{if(l.defaultView==="treeGrid"){if(c){b._uiList()}else{b.uiTreeGrid.nostreegrid("setSize",null,a)}}else{b.uiGrid.noslistgrid("setSize",null,a);if(c){var d=i.grid.getHeights();b.uiGrid.noslistgrid("option","pageSize",Math.floor((a-d.footer-d.header-(b.showFilter?d.filter:0))/d.row))}}}}return b},_hideSplitterV:function(){var a=this;a.uiSplitterVertical.find(".wijmo-wijsplitter-v-bar").css({width:"0px",borderRightWidth:"0px"}).end().wijsplitter("option","panel1",{collapsed:true}).wijsplitter("refresh",true,false);return a},_hideSplitterH:function(){var a=this;a.uiSplitterHorizontal.find(".wijmo-wijsplitter-h-bar").css({height:"0px",borderTopWidth:"0px"}).end().wijsplitter("option","panel1",{collapsed:true}).wijsplitter("refresh",true,false);return a},gridReload:function(){var a=this,b=a.options;if(a.init){if(b.defaultView==="thumbnails"){a._uiList()}else{if(b.defaultView==="treeGrid"){a._uiList()}else{a.uiGrid.noslistgrid("ensureControl",true)}}}return a},resize:function(){var a=this,b=a.options;a.uiSplitterVertical.wijsplitter("refresh",true,false);a.uiSplitterHorizontal.wijsplitter("refresh",true,false);a._resizeInspectorsV()._resizeInspectorsH()._resizeList();return a},slidersSettings:function(){return{vertical:{splitterDistance:this.uiSplitterVertical.wijsplitter("option","splitterDistance")/g(window).width()},horizontal:{splitterDistance:this.uiSplitterHorizontal.wijsplitter("option","splitterDistance")/g(window).height()}}}});i.extend({appdeskAdd:function(l,c){var b=this;var d=false;var a="";if(c.selectedView=="custom"){if(c.custom){a=c.views[c.custom.from].json;d=true}else{c.selectedView="default"}}if(c.selectedView!="custom"){a=c.views[c.selectedView].json}require(a,function(){var m=i.appdeskSetup();g.extend(true,m.i18nMessages,c.i18n);for(var n=0;n<arguments.length;n++){g.extend(true,m,arguments[n](m))}g.extend(true,m.appdesk,{locales:c.locales,views:c.views,name:c.configuration_id,selectedView:c.selectedView,selectedLang:c.selectedLang});if(d){g.extend(true,m.appdesk,{fromView:c.custom.from},c.custom.appdesk)}var p,s=g("div#"+l),o=s.closest(".nos-dispatcher"),r=m.build();if(g.isPlainObject(r.tab)&&!g.isEmptyObject(r.tab)){try{i(s).tab("update",r.tab)}catch(q){log("Could not update current tab. Maybe your config file should not try to update it.")}}s.removeAttr("id").appdesk(r.appdesk);o.on({resizePanel:function(){if(p){window.clearTimeout(p)}p=window.setTimeout(function(){s.appdesk("resize")},200)},showPanel:function(){s.appdesk("resize")}});if(r.reloadEvent){o.on("reload."+r.reloadEvent,function(){s.appdesk("gridReload")})}s.bind("reloadView",function(v,u){g.extend(c,u);var t=g('<div id="'+l+'"></div>');t.insertAfter(s);s.remove();b.appdeskAdd(l,c)})})},appdeskSetup:function(){var c={},b=function(m,l){m.setupkey=l;return m},a=function(m,o){if(m[o+"Order"]){var p=m[o+"Order"].split(",");var l=[];for(var n=0;n<p.length;n++){if(m[o][p[n]]!=null){m[o][p[n]]["setupkey"]=p[n];l.push(m[o][p[n]])}}return l}else{return g.map(m[o],b)}},d=function(l){g.each(l,function(o,r){if(g.isPlainObject(r)){if(g.isFunction(r._)){l[o]=r._()}else{d(r)}}else{if(g.isArray(r)){d(r)}}if(o==="columns"){l[o]=a(l,o);for(var n=0;n<l[o].length;n++){if(l[o][n].lang){l[o][n]={headerText:"Languages",dataKey:"lang",setupkey:"lang",showFilter:false,cellFormatter:function(s){if(s.row.type&g.wijmo.wijgrid.rowType.data){s.$container.css("text-align","center").html(s.row.data.lang);return true}},width:1}}if(l[o][n].actions){var q=l[o][n].actions;var p;var m=l[o][n].showOnlyArrow?true:false;if(m){p=20}else{p=i.grid.getActionWidth(q);if(q.length>1){}}l[o][n]={headerText:m?"":"",cellFormatter:function(s){if(g.isPlainObject(s.row.data)){var t=i.appdeskActions(q,s.row.data,{showOnlyArrow:m});t.appendTo(s.$container);s.$container.parent().addClass("buttontd").css({width:p+1});return true}},allowSizing:false,allowSort:false,width:p,ensurePxWidth:true,showFilter:false,setupkey:"actions"}}}}})},c={tab:null,appdesk:{adds:{},grid:{proxyUrl:"",columns:{}},thumbnails:null,defaultView:"grid",inspectors:{},splittersVertical:null,splittersHorizontal:null},i18nMessages:{},i18n:function(m){var n={};var l=this;g.extend(n,{label:m,_:function(){return l.i18nMessages[n.label]||n.label}});return n},build:function(){var n=g.extend(true,{appdesk:{texts:this.i18nMessages,splitters:{},slidersChange:function(o,p){}}},this);if(n.appdesk.splittersVertical){n.appdesk.splitters.vertical={splitterDistance:n.appdesk.splittersVertical}}if(n.appdesk.splittersHorizontal){n.appdesk.splitters.horizontal={splitterDistance:n.appdesk.splittersHorizontal}}n.appdesk.adds=g.map(n.appdesk.adds,b);n.appdesk.inspectors=a(n.appdesk,"inspectors");if(n.actions){var l=n.actions;if(n.appdesk.grid.columns.actions&&n.appdesk.grid.columns.actions.actions){g.each(n.appdesk.grid.columns.actions.actions,function(o,p){if(g.type(p)=="string"){n.appdesk.grid.columns.actions.actions[o]=l[p]}})}if(n.appdesk.thumbnails&&n.appdesk.thumbnails.actions){g.each(n.appdesk.thumbnails.actions,function(o,p){if(g.type(p)=="string"){n.appdesk.thumbnails.actions[o]=l[p]}})}g.each(n.appdesk.inspectors,function(o,p){if(p.preview&&p.options.actions){g.each(p.options.actions,function(q,r){if(g.type(r)=="string"){p.options.actions[q]=l[r]}})}})}d(n);for(var m=0;m<n.appdesk.inspectors.length;m++){if(n.appdesk.inspectors[m].preview){n.appdesk.inspectors[m].url=function(q){var o=q.data("inspector"),p=g("<div></div>").appendTo(q).preview(o.options).parent().on({widgetResize:function(){p.preview("resize")}}).end()}}}return n}};return c},appdeskActionsList:[],appdeskActions:function(n,m,d){d=d||{};var a=g("<table><tr></tr></table>").addClass("buttontd wijgridtd");var c=[];var b=[];if(!d.showOnlyArrow){g.each(n,function(){if(this.primary){c.push(this)}else{b.push(this)}});if(b.length==1&&(b[0].icon||b[0].iconClasses)){c.push(b[0])}g.each(c,function(p,r){var o=false;if(r.iconClasses){o=r.iconClasses}else{if(r.icon){o="ui-icon ui-icon-"+r.icon}}var q=g("<th></th>").css("white-space","nowrap").addClass("ui-state-default").attr("title",r.label).html((o?'<span class="'+o+'"></span>':"")+(r.text||!o?"&nbsp;"+r.label+"&nbsp;":""));if(r.name&&m&&m.actions&&m.actions[r.name]==false){q.addClass("ui-state-disabled").click(function(s){s.stopImmediatePropagation();s.preventDefault()})}else{q.click(function(s){s.stopImmediatePropagation();s.preventDefault();r.action.apply(this,[m,q])}).hover(function(){g(this).addClass("ui-state-hover")},function(){g(this).removeClass("ui-state-hover")})}if(o&&!r.text){q.css({width:20,textAlign:"center"}).children().css({margin:"auto"})}else{if(o&&r.text){q.find("span").css("float","left")}}q.appendTo(a.find("tr"))})}if(d.showOnlyArrow||b.length>=2||(b.length==1&&!(b[0].icon||b[0].iconClasses))){var l=g("<th></th>").addClass("ui-state-default").css({width:"20px"}).hover(function(){g(this).addClass("ui-state-hover")},function(){g(this).removeClass("ui-state-hover")});g("<span></span>").addClass("ui-icon ui-icon-triangle-1-s").appendTo(l);l.appendTo(a.find("tr")).click(function(q){g.each(i.appdeskActionsList,function(){g(this).wijmenu("hideAllMenus")});if(!this.created){var p=g("<ul></ul>");g.each(n,function(t,u){var s;if(u.iconClasses){s=u.iconClasses}else{if(u.icon){s="ui-icon ui-icon-"+u.icon}}var v='<span class="'+(s?s:"nos-icon16 nos-icon16-empty")+' wijmo-wijmenu-icon-left"></span><span class="wijmo-wijmenu-text">'+u.label+"</span>";var r=g('<li><a href="#"></a></li>').appendTo(p).find("a").html(v);if(u.name&&m.actions&&m.actions[u.name]==false){r.addClass("ui-state-disabled").click(function(w){w.stopImmediatePropagation();w.preventDefault()})}else{r.click(function(w){w.stopImmediatePropagation();w.preventDefault();p.wijmenu("hideAllMenus");u.action.apply(this,[m,r])})}});var o=l.closest(".ui-dialog-content, .nos-dispatcher, body");p.appendTo(o);p.wijmenu({trigger:l,triggerEvent:"click",orientation:"vertical",showAnimation:{Animated:"slide",duration:50,easing:null},hideAnimation:{Animated:"hide",duration:0,easing:null},position:{my:"right top",at:"right bottom",collision:"flip",offset:"0 0"}});i.appdeskActionsList.push(p);this.created=true;l.triggerHandler("click")}});l.click(false)}return a},grid:{getHeights:function(){if(this.heights===h){var a=g("<div></div>").appendTo("body");var b=g("<table></table>").addClass("nos-appdesk").appendTo(a).noslistgrid({scrollMode:"auto",showFilter:true,allowPaging:true,data:[["test"]]});this.heights={row:b.height(),footer:a.find(".wijmo-wijgrid-footer").outerHeight(),header:a.find(".wijmo-wijgrid-headerrow").outerHeight(),filter:a.find(".wijmo-wijgrid-filterrow").outerHeight()};b.noslistgrid("destroy");a.remove()}return this.heights},getActionWidth:function(d){var a=g("<div></div>").appendTo("body");var c=g("<table></table>").addClass("nos-appdesk").appendTo(a).noslistgrid({scrollMode:"none",showFilter:true,allowPaging:true,columns:[{headerText:"Actions",cellFormatter:function(l){if(g.isPlainObject(l.row.data)){var m=i.appdeskActions(d,[]);m.appendTo(l.$container);l.$container.parent().addClass("buttontd");return true}},allowSizing:true,showFilter:false,ensurePxWidth:true}],data:[{key:"value"}]});a.find("table.buttontd.wijgridtd").css({"font-size":"1.05em",width:"auto"});var b=a.find(".buttontd .buttontd:first").outerWidth();c.noslistgrid("destroy");a.remove();return b}}});return i});
