/**
 * NOVIUS OS - Web OS for digital communication
 *
 * @copyright  2011 Novius
 * @license    GNU Affero General Public License v3 or (at your option) any later version
 *             http://www.gnu.org/licenses/agpl-3.0.html
 * @link http://www.novius-os.org
 */
define("jquery-nos",["jquery","log","order!jquery-ui","order!wijmo-open","order!wijmo-complete"],function(a){var b=void (0);a.nos={fireEvent:function(c){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos.nos.fireEvent(c)}if(a.nos.$noviusos){a.nos.$noviusos.ostabs("triggerPanels",c)}},dataStore:{},data:function(d,c){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos.nos.data(d,c)}if(d){if(c){this.dataStore[d]=c}return this.dataStore[d]}},dialog:function(d){if(d.destroyOnClose){var e=d.close;d.close=function(){if(a.isFunction(e)){e.apply(this,arguments)}a(this).wijdialog("destroy").remove()}}d=a.extend(true,{},{width:window.innerWidth-200,height:window.innerHeight-100,modal:true,captionButtons:{pin:{visible:false},refresh:{visible:d.contentUrl!=null&&!d.ajax},toggle:{visible:false},minimize:{visible:false},maximize:{visible:false}}},d);var c=a.nos.$noviusos.ostabs?a.nos.$noviusos.ostabs("current").panel:a("body");var g=a(document.createElement("div")).appendTo(c);a.nos.data("dialog",g);if(typeof d.content!="undefined"){g.append(d.content)}var f=true;if(d.ajax){var h=d.contentUrl;delete d.contentUrl;d.autoOpen=false;g.wijdialog(d);a.ajax({url:h,type:"GET",dataType:"html",complete:function(k,i,l){l=k.responseText;if(k.isResolved()){k.done(function(n){l=n});try{var j=a.parseJSON(l);f=false}catch(m){}if(f){g.wijdialog("open")}else{g.empty();g.wijdialog("destroy");g.remove();a.nos.ajax.success(j)}g.html(l)}}})}else{g.wijdialog(d)}if(f){if(a.isFunction(d.onLoad)){d.onLoad()}g.bind("wijdialogclose",function(i,j){g.closest(".ui-dialog").hide().appendTo(c)})}return g},notify:function(c,d){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos.nos.notify(c,d)}if(!a.isPlainObject(c)){c={title:c}}if(d!==b){a.extend(c,a.isPlainObject(d)?d:{type:d})}if(a.isPlainObject(c)){require(["link!static/cms/admin/vendor/jquery/pnotify/jquery.pnotify.default.css","static/cms/admin/vendor/jquery/pnotify/jquery.pnotify.min"],function(){var e={pnotify_history:false,pnotify_addclass:"nos-notification"};a.each(c,function(f,g){if(f.substr(0,8)!=="pnotify_"){f="pnotify_"+f}e[f]=g});return a.pnotify(e)})}return false},ajax:{request:function(c){c=a.extend({dataType:"json",type:"POST",data:{}},c);if(c.dataType=="json"){if(a.isFunction(c.success)){var e=c.success;c.success=function(f){f.user_success=e;a.nos.ajax.success(f)}}else{c.success=a.nos.ajax.success}if(a.isFunction(c.error)){var d=c.error;c.error=function(f){a.nos.ajax.error(f);d.apply(this,arguments)}}else{c.error=a.nos.ajax.error}}a.ajax(c)},success:function(c){if(c.error){if(a.isArray(c.error)){a.each(c.error,function(){a.nos.notify(this,"error")})}else{a.nos.notify(c.error,"error")}}if(c.notify){if(a.isArray(c.notify)){a.each(c.notify,function(){a.nos.notify(this)})}else{a.nos.notify(c.notify)}}if(c.fireEvent){if(a.isArray(c.fireEvent)){a.each(c.fireEvent,function(d,e){a.nos.fireEvent(e)})}else{a.nos.fireEvent(c.fireEvent)}}if(a.isFunction(c.user_success)){c.user_success.apply(this,arguments)}if(c.redirect){document.location=c.redirect}if(c.closeTab){a.nos.tabs.close()}if(c.replaceTab){a.nos.tabs.replace(c.replaceTab)}},error:function(c,d){if(c.status!=0){a.nos.notify("Connection error!","error")}else{if(d=="parsererror"){a.nos.notify("Request seemed a success, but we could not read the answer.")}else{if(d=="timeout"){a.nos.notify("Time out (server is busy?). Please try again.")}}}}},media:function(d,g){var c={all:"/admin/cms/media/list",image:"/admin/cms/media/list?view=image_pick"};var f=null;var e=a.extend({title:d.attr("title")||"File",allowDelete:true,choose:function(h){if(f==null){f=a.nos.dialog({contentUrl:c[g.mode],ajax:true,title:"Choose a media file"});f.bind("select.media",function(j,i){d.inputFileThumb({file:i.thumbnail});d.val(i.id);f.wijdialog("close")})}else{f.wijdialog("open")}}},g.inputFileThumb);require(["static/cms/admin/vendor/jquery/jquery-ui-input-file-thumb/js/jquery.input-file-thumb","link!static/cms/admin/vendor/jquery/jquery-ui-input-file-thumb/css/jquery.input-file-thumb.css"],function(){a(function(){d.inputFileThumb(e)})})},ui:{form:function(c){c=c||"body";a(function(){var d=a(c);d.find(":input[type='text'],:input[type='password'],:input[type='email'],textarea").wijtextbox();d.find(":input[type='submit'],button").each(function(){var e={};var f=a(this).data("icon");if(f){e.icons={primary:"ui-icon-"+f}}a(this).button(e)});d.find("select").wijdropdown();d.find(":input[type=checkbox]").wijcheckbox();d.find(".expander").each(function(){var e=a(this);e.wijexpander(a.extend({expanded:true},e.data("wijexpander-options")))});d.find(".accordion").wijaccordion({header:"h3"})})}},saveUserConfiguration:function(c,d){this.ajax.request({url:"/admin/cms/noviusos/save_user_configuration",data:{key:c,configuration:d}})}};window.$nos=a;return a});
define("jquery-nos-loadspinner",["jquery","log","order!jquery-ui","order!wijmo-open","order!wijmo-complete","order!jquery-nos"],function(a){a.widget("nos.loadspinner",{options:{diameter:40,color:null,density:40,range:1.3,scaling:false,fading:true,shape:"circle",speed:2,fps:24},shapes:["circle","square","rectangle","roundedRectangle"],colorReg:/^\#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,colorRgb:/^rgb\((\d+)[ \,]+(\d+)[ \,]+(\d+)\)$/,UISpinnerCanvas:null,UISpinnerContext:null,UISpinnerCacheCanvas:null,UISpinnerCacheContext:null,running:false,ready:false,timer:null,activeId:0,colorRGB:null,_create:function(){this.UISpinnerCanvas=a("<canvas></canvas>").attr("id","CanvasLoader").get(0);this.UISpinnerContext=this.UISpinnerCanvas.getContext("2d");this.element.append(this.UISpinnerCanvas);this.UISpinnerCanvas.width=this.UISpinnerCanvas.height=this.options.diameter;this.UISpinnerCacheCanvas=a("<canvas></canvas>").get(0);a("body").append(this.UISpinnerCacheCanvas);this.UISpinnerCacheContext=this.UISpinnerCacheCanvas.getContext("2d");this.UISpinnerCacheCanvas.width=this.UISpinnerCacheCanvas.height=this.options.diameter;a(this.UISpinnerCacheCanvas).hide()},_init:function(){if(!this.options.color){this.options.color=this.element.css("color")}this._setOption("color",this.options.color);this.ready=true;this._draw();this.start()},_setOption:function(c,d){var b=this;switch(c){case"diameter":if(isNaN(d)){return}d=Math.round(Math.abs(d));break;case"color":this.colorRGB=this._RGB(d);break;case"shape":if(a.inArray(d,this.shapes)==-1){return}break;case"density":if(isNaN(d)){return}d=Math.round(Math.abs(d));break;case"range":if(isNaN(d)){return}d=Math.abs(d);break;case"speed":if(isNaN(d)&&Math.abs(d)>0){return}d=Math.round(Math.abs(d));break;case"fps":if(isNaN(d)){return}d=Math.round(Math.abs(d));break}a.Widget.prototype._setOption.apply(b,arguments);if(a.inArray(c,["diameter","color","shape","density","range","scaling","fading"])!=-1){this._redraw()}else{if(a.inArray(c,["speed","fps"])!=-1){this._reset()}}},_RGB:function(c){var b={};if(this.colorReg.test(c)){c=c.charAt(0)==="#"?c.substring(1,7):c;if(c.length==3){c=c+c}b.r=parseInt(c.substring(0,2),16);b.g=parseInt(c.substring(2,4),16);b.b=parseInt(c.substring(4,6),16)}else{if(this.colorRgb.exec(c)){b.r=parseInt(RegExp.$1);b.g=parseInt(RegExp.$2);b.b=parseInt(RegExp.$3)}else{b.r=0;b.g=0;b.b=0}}return b},_draw:function(){var e=0,o=this.options.diameter*0.07,d,k,n,j,m,l,c,g=0.1,b=Math.round(this.options.density*this.options.range),f;this.UISpinnerCacheContext.clearRect(0,0,this.UISpinnerCacheCanvas.width,this.UISpinnerCacheCanvas.height);this.UISpinnerCanvas.width=this.UISpinnerCanvas.height=this.UISpinnerCacheCanvas.width=this.UISpinnerCacheCanvas.height=this.options.diameter;switch(this.options.shape){case this.shapes[0]:while(e<this.options.density){if(e<=b){f=1-((1-g)/b*e)}else{f=g}d=(this.options.density-e)*((Math.PI*2)/this.options.density);m=this.UISpinnerCanvas.width*0.5+Math.cos(d)*(this.options.diameter*0.45-o)-this.UISpinnerCanvas.width*0.5;l=this.UISpinnerCanvas.height*0.5+Math.sin(d)*(this.options.diameter*0.45-o)-this.UISpinnerCanvas.height*0.5;this.UISpinnerCacheContext.beginPath();if(this.options.fading){this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+f.toString()+")"}else{this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}if(this.options.scaling){this.UISpinnerCacheContext.arc(this.options.diameter*0.5+m,this.options.diameter*0.5+l,o*f,0,Math.PI*2,false)}else{this.UISpinnerCacheContext.arc(this.options.diameter*0.5+m,this.options.diameter*0.5+l,o,0,Math.PI*2,false)}this.UISpinnerCacheContext.closePath();this.UISpinnerCacheContext.fill();e+=1}break;case this.shapes[1]:o=this.UISpinnerCanvas.width*0.12;while(e<this.options.density){if(e<=b){f=1-((1-g)/b*e)}else{f=g}c=360-360/this.options.density*e;d=c/180*Math.PI;m=Math.cos(d)*o*3+this.UISpinnerCacheCanvas.width*0.5;l=Math.sin(d)*o*3+this.UISpinnerCacheCanvas.height*0.5;this.UISpinnerCacheContext.save();this.UISpinnerCacheContext.translate(m,l);this.UISpinnerCacheContext.rotate(d);this.UISpinnerCacheContext.translate(-m,-l);this.UISpinnerCacheContext.beginPath();if(this.options.fading){this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+f.toString()+")"}else{this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}this.UISpinnerCacheContext.fillRect(m,l-o*0.5,o,o);this.UISpinnerCacheContext.closePath();this.UISpinnerCacheContext.fill();this.UISpinnerCacheContext.restore();e+=1}break;case this.shapes[2]:n=this.UISpinnerCacheCanvas.width*0.24;j=n*0.35;while(e<this.options.density){if(e<=b){f=1-((1-g)/b*e)}else{f=g}c=360-360/this.options.density*e;d=c/180*Math.PI;m=Math.cos(d)*(j+(this.UISpinnerCacheCanvas.height-j)*0.13)+this.UISpinnerCacheCanvas.width*0.5;l=Math.sin(d)*(j+(this.UISpinnerCacheCanvas.height-j)*0.13)+this.UISpinnerCacheCanvas.height*0.5;this.UISpinnerCacheContext.save();this.UISpinnerCacheContext.translate(m,l);this.UISpinnerCacheContext.rotate(d);this.UISpinnerCacheContext.translate(-m,-l);this.UISpinnerCacheContext.beginPath();if(this.options.fading){this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+f.toString()+")"}else{this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}this.UISpinnerCacheContext.fillRect(m,l-j*0.5,n,j);this.UISpinnerCacheContext.closePath();this.UISpinnerCacheContext.fill();this.UISpinnerCacheContext.restore();e+=1}break;case this.shapes[3]:n=this.UISpinnerCacheCanvas.width*0.24;j=n*0.35;k=j*0.65;while(e<this.options.density){if(e<=b){f=1-((1-g)/b*e)}else{f=g}c=360-360/this.options.density*e;d=c/180*Math.PI;m=Math.cos(d)*(j+(this.UISpinnerCacheCanvas.height-j)*0.13)+this.UISpinnerCacheCanvas.width*0.5;l=Math.sin(d)*(j+(this.UISpinnerCacheCanvas.height-j)*0.13)+this.UISpinnerCacheCanvas.height*0.5;this.UISpinnerCacheContext.save();this.UISpinnerCacheContext.translate(m,l);this.UISpinnerCacheContext.rotate(d);this.UISpinnerCacheContext.translate(-m,-l);if(this.options.fading){this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+f.toString()+")"}else{this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}this.UISpinnerCacheContext.beginPath();this.UISpinnerCacheContext.moveTo(m+k,l-j*0.5);this.UISpinnerCacheContext.lineTo(m+n-k,l-j*0.5);this.UISpinnerCacheContext.quadraticCurveTo(m+n,l-j*0.5,m+n,l-j*0.5+k);this.UISpinnerCacheContext.lineTo(m+n,l-j*0.5+j-k);this.UISpinnerCacheContext.quadraticCurveTo(m+n,l-j*0.5+j,m+n-k,l-j*0.5+j);this.UISpinnerCacheContext.lineTo(m+k,l-j*0.5+j);this.UISpinnerCacheContext.quadraticCurveTo(m,l-j*0.5+j,m,l-j*0.5+j-k);this.UISpinnerCacheContext.lineTo(m,l-j*0.5+k);this.UISpinnerCacheContext.quadraticCurveTo(m,l-j*0.5,m+k,l-j*0.5);this.UISpinnerCacheContext.closePath();this.UISpinnerCacheContext.fill();this.UISpinnerCacheContext.restore();e+=1}break}this._tick(true);return this},_clean:function(){this.UISpinnerContext.clearRect(0,0,this.UISpinnerCanvas.width,this.UISpinnerCanvas.height);return this},_redraw:function(){if(this.ready){this._clean();this._draw()}return this},_reset:function(){if(this.running){this.stop();this.start()}return this},_tick:function(b){var c=this.options.density>360?this.options.density/360:360/this.options.density;c*=this.options.speed;if(!b){this.activeId+=c}if(this.activeId>360){this.activeId-=360}this.UISpinnerContext.clearRect(0,0,this.options.diameter,this.options.diameter);this.UISpinnerContext.save();this.UISpinnerContext.translate(this.options.diameter*0.5,this.options.diameter*0.5);this.UISpinnerContext.rotate(Math.PI/180*this.activeId);this.UISpinnerContext.translate(-this.options.diameter*0.5,-this.options.diameter*0.5);this.UISpinnerContext.drawImage(this.UISpinnerCacheCanvas,0,0,this.options.diameter,this.options.diameter);this.UISpinnerContext.restore();return this},start:function(){if(!this.running){this.running=true;var b=this;this.timer=window.setInterval(function(){b._tick()},Math.round(1000/this.options.fps))}return this},stop:function(){if(this.running){this.running=false;clearInterval(this.timer);this.timer=null;delete this.timer}return this},destroy:function(){if(this.running){this.stop()}a(this.UISpinnerCanvas).remove();a(this.UISpinnerCacheCanvas).remove();a.Widget.prototype.destroy.apply(this);return this}});return a});
define("jquery-nos-ostabs",["jquery","log","order!jquery-ui","order!wijmo-open","order!wijmo-complete","order!jquery-nos","order!jquery-nos-loadspinner"],function(a){var b=void (0);a.widget("nos.ostabs",{options:{initTabs:[],newTab:"appsTab",trayTabs:[],appsTab:{},fx:null,labelMinWidth:100,labelMaxWidth:200,selected:null,texts:{scrollLeft:"Scroll left",scrollRight:"Scroll right",newTab:"New tab",removeTab:"Remove tab",closeTab:"Close tab",pinTab:"Pin tab",unpinTab:"Unpin tab",reloadTab:"Reload tab",spinner:"Loading..."},add:null,pin:null,unpin:null,remove:null,select:null,show:null,drag:null},tabId:0,pined:[],stackOpening:[],_create:function(){var c=this,d=c.options;c._tabify(true);a(window).resize(function(){if(d.selected){c._firePanelEvent(c.panels.eq(d.selected),{event:"resizePanel"})}})},_setOption:function(c,d){if(c=="selected"){this.select(d)}else{this.options[c]=d;this._tabify()}},_getNextTabId:function(){return ++this.tabId},_tabId:function(c){return a(c).data("panelid.tabs")||"nos-ostabs-"+this._getNextTabId()},_sanitizeSelector:function(c){return c.replace(/:/g,"\\:")},_ui:function(c,d){var e=this,f=this.lis.index(c);if(d===b){d=e.element.find(e._sanitizeSelector(e.anchors[f].hash))[0]}return{tab:c,panel:d,index:f}},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span.nos-ostabs-icon").removeClass("nos-ostabs-loader").each(function(){if(a.isFunction(a.fn.loadspinner)){a(this).loadspinner("destroy")}}).html(" ").parent().find("span.nos-ostabs-label").each(function(){var d=a(this),c=d.data("label.tabs");if(c){d.html(c).removeData("label.tabs")}})},_tabify:function(n){var p=this,f=this.options,d=/^#.+/;if(n){this.element.addClass("nos-ostabs ui-widget ui-widget-content");this.uiOstabsHeader=a("<div></div>").addClass("ui-widget-header").appendTo(this.element);this.uiOstabsTabsContainer=a("<div></div>").addClass("nos-ostabs-tabs").appendTo(this.uiOstabsHeader);this.uiOstabsScrollLeft=a('<a href="#"></a>').addClass("nos-ostabs-scroll-left");a("<span></span>").addClass("ui-icon ui-icon-triangle-1-w").text(this.options.texts.scrollLeft).appendTo(this.uiOstabsScrollLeft);this.uiOstabsScrollRight=a('<a href="#"></a>').addClass("nos-ostabs-scroll-right");a("<span></span>").addClass("ui-icon ui-icon-triangle-1-e").text(this.options.texts.scrollRight).appendTo(this.uiOstabsScrollRight);this.uiOstabsScrollRight.add(this.uiOstabsScrollLeft).addClass("ui-state-default ui-corner-all").attr("role","button").mouseenter(function(){var q=this;a(q).data("nos-ostabs-hover",true);var o=setInterval(function(){if(p.sorting&&a(q).data("nos-ostabs-hover")){p._scroll(q!==p.uiOstabsScrollRight.get(0))}else{clearInterval(o)}},200);p.uiOstabsScrollRight.addClass("ui-state-hover")}).mouseleave(function(){a(this).data("nos-ostabs-hover",false);p.uiOstabsScrollRight.removeClass("ui-state-hover")}).focus(function(){p.uiOstabsScrollRight.addClass("ui-state-focus")}).blur(function(){p.uiOstabsScrollRight.removeClass("ui-state-focus")}).click(function(){p._scroll(this!==p.uiOstabsScrollRight.get(0));return false}).appendTo(this.uiOstabsTabsContainer);this.uiOstabsTabsWrap=a("<div></div>").appendTo(this.uiOstabsTabsContainer);this.uiOstabsTabs=a("<ul></ul>").appendTo(this.uiOstabsTabsWrap);if(a.isArray(this.options.initTabs)){a.each(this.options.initTabs,function(o,q){p._add(q)})}var e=this.options.newTab;if(a.isPlainObject(e)){e=a.extend({label:this.options.texts.newTab,iconClasses:"ui-icon ui-icon-circle-plus"},e,{pined:true})}else{if(e&&a.isPlainObject(this.options.appsTab)){e=a.extend({},this.options.appsTab,{label:this.options.texts.newTab,iconClasses:"ui-icon ui-icon-circle-plus",iconUrl:"",iconSize:16,pined:true})}else{e=false}}if(e){this.uiOstabsNewTab=p._add(e).addClass("nos-ostabs-newtab")}else{this.uiOstabsNewTab=a("<li>/<li>")}this.uiOstabsTabs.sortable({items:"li:not(.nos-ostabs-newtab)",appendTo:this.uiOstabsTabsContainer,containment:this.uiOstabsTabsContainer,cursor:"move",delay:250,scroll:false,helper:"clone",tolerance:"pointer",axis:"x",zIndex:100000,placeholder:"ui-state-highlight",forcePlaceholderSize:true,start:function(){p.sorting=true},stop:function(){p.sorting=false},update:function(){p._trigger("drag",null);p.lis=p.uiOstabsAppsTab.add(p.uiOstabsTray).add(p.uiOstabsTabs).find("li:has(a[href])");p.anchors=p.lis.map(function(q){var o=a("a",this)[0];p.element.find(p._sanitizeSelector(o.hash)).find(".nos-ostabs-panel-content").data("nos-ostabs-index",q);return o});p._tabsWidth()}});this.uiOstabsTray=a("<ul></ul>").addClass("nos-ostabs-tray nos-ostabs-nav");if(a.isArray(this.options.trayTabs)){a.each(this.options.trayTabs,function(o,q){if(a.isPlainObject(q)){a.extend(q,{pined:true});p._add(q,p.uiOstabsTray).addClass("nos-ostabs-tray")}})}this.uiOstabsTray.prependTo(this.uiOstabsHeader);if(a.isPlainObject(this.options.appsTab)){this.uiOstabsAppsTab=a("<ul></ul>").addClass("nos-ostabs-appstab  nos-ostabs-nav").prependTo(this.uiOstabsHeader);p._add(this.options.appsTab,this.uiOstabsAppsTab).addClass("nos-ostabs-appstab").removeClass("ui-state-default")}else{this.uiOstabsAppsTab=a("<ul></ul>")}this.uiOstabsTabsContainer.css("left",this.uiOstabsAppsTab.outerWidth(true));this.uiOstabsTabsContainer.css("right",this.uiOstabsTray.outerWidth(true));this.tabsWidth=this.uiOstabsTabsContainer.width();this.labelWidth=this.options.labelMaxWidth;this.uiOstabsTabs.width(this.tabsWidth);a('<style type="text/css" class="statepined">.nos-ostabs .ui-widget-header li.ui-state-pined {color : '+this.uiOstabsHeader.css("color")+";background:transparent;}</style>").appendTo("head")}this.lis=this.uiOstabsAppsTab.add(this.uiOstabsTray).add(this.uiOstabsTabs).find("li:has(a[href])");this.anchors=this.lis.map(function(){return a("a",this)[0]});this.panels=a([]);this.anchors.each(function(r,o){var q=a(o).attr("href");var s=q.split("#")[0],t;if(s&&(s===location.toString().split("#")[0]||(t=a("base")[0])&&s===t.href)){q=o.hash;o.href=q}if(d.test(q)){p.panels=p.panels.add(p.element.find(p._sanitizeSelector(q)))}else{if(q&&q!=="#"){a.data(o,"href.tabs",q);a.data(o,"load.tabs",q.replace(/#.*$/,""));var w=p._tabId(o);o.href="#"+w;var u=p.element.find("#"+w);if(!u.length){var v=p.lis.eq(r);u=a("<div></div>").attr("id",w).addClass("nos-ostabs-panel ui-widget-content ui-corner-bottom nos-ostabs-hide"+(v.hasClass("ui-state-pined")?" ui-state-pined":"")).appendTo(p.element);p._actions(u,r)}p.panels=p.panels.add(u)}}});if(n){this.uiOstabsTabs.add(this.uiOstabsTray).add(this.uiOstabsAppsTab).addClass("nos-ostabs-nav ui-helper-reset ui-helper-clearfix");this.lis.addClass("ui-corner-top");this.panels.addClass("nos-ostabs-panel ui-widget-content");if(f.selected===b){if(location.hash){this.anchors.each(function(q,o){if(o.hash==location.hash){f.selected=q;return false}})}if(typeof f.selected!=="number"&&this.lis.filter(".nos-ostabs-selected").length){f.selected=this.lis.index(this.lis.filter(".nos-ostabs-selected"))}f.selected=f.selected||(this.lis.length?0:-1)}f.selected=((f.selected>=0&&this.anchors[f.selected])||f.selected<0)?f.selected:0;p.pined=a.map(this.lis.filter(".ui-state-pined"),function(q,o){return p.lis.index(q)}).sort();this.panels.addClass("nos-ostabs-hide");this.lis.removeClass("nos-ostabs-selected ui-state-active");if(f.selected>=0&&this.anchors.length){p.element.find(p._sanitizeSelector(p.anchors[f.selected].hash)).removeClass("nos-ostabs-hide");this.lis.eq(f.selected).addClass("nos-ostabs-selected ui-state-active");p.element.queue("tabs",function(){p._trigger("show",null,p._ui(p.lis[f.selected]))});this.title(f.selected,this.title(f.selected));this._load(f.selected)}a(window).bind("unload",function(){p.lis.add(p.anchors).unbind(".tabs");p.lis=p.anchors=p.panels=null})}else{f.selected=this.lis.index(this.lis.filter(".nos-ostabs-selected"))}this.anchors.removeData("cache.tabs");this.lis.add(this.anchors).unbind(".tabs");var h=function(q,o){o.removeClass("ui-state-pined").addClass("ui-state-"+q)};var k=function(q,o){o.removeClass("ui-state-"+q);if(a.inArray(p.lis.index(o),p.pined)!==-1&&!o.is(".ui-state-active")){o.addClass("ui-state-pined")}};this.lis.bind("mouseover.tabs",function(){h("hover",a(this))});this.lis.bind("mouseout.tabs",function(){k("hover",a(this))});this.anchors.bind("focus.tabs",function(){h("focus",a(this).closest("li"))});this.anchors.bind("blur.tabs",function(){k("focus",a(this).closest("li"))});var c,i;if(f.fx){if(a.isArray(f.fx)){c=f.fx[0];i=f.fx[1]}else{c=i=f.fx}}function g(o,q){o.css("display","");if(!a.support.opacity&&q.opacity){o[0].style.removeAttribute("filter")}}function j(r){var q=r.data("callbacks.ostabs"),o=r.find(".nos-connector");if(a.isPlainObject(q)){a.each(q,function(s,t){p._firePanelEvent(o,t)});q={}}}var l=i?function(o,q){var r=a(o).closest("li").addClass("nos-ostabs-selected ui-state-active").removeClass("ui-state-pined");q.hide().removeClass("nos-ostabs-hide").animate(i,i.duration||"normal",function(){if(r.hasClass("nos-ostabs-newtab")){p._tabsWidth()}p._scrollTo(r);g(q,i);j(q);p._firePanelEvent(q,{event:"showPanel"})})}:function(o,q){var r=a(o).closest("li");if(r.hasClass("nos-ostabs-newtab")){p._tabsWidth()}p._scrollTo(r);r.addClass("nos-ostabs-selected ui-state-active").removeClass("ui-state-pined");q.removeClass("nos-ostabs-hide");j(q);p._firePanelEvent(q,{event:"showPanel"})};var m=c?function(q,o){o.animate(c,c.duration||"normal",function(){if(p.uiOstabsNewTab.hasClass("ui-state-active")){p._tabsWidth()}p.lis.removeClass("nos-ostabs-selected ui-state-active");o.addClass("nos-ostabs-hide");g(o,c);p.element.dequeue("tabs");o.trigger("hidePanel.ostabs")})}:function(q,o){if(p.uiOstabsNewTab.hasClass("ui-state-active")){p._tabsWidth()}p.lis.removeClass("nos-ostabs-selected ui-state-active");o.addClass("nos-ostabs-hide");p.element.dequeue("tabs");o.trigger("hidePanel.ostabs")};this.anchors.bind("click.tabs",function(){var q=this,s=a(q).closest("li"),o=p.panels.filter(":not(.nos-ostabs-hide)"),r=p.element.find(p._sanitizeSelector(q.hash));s.addClass("ui-state-open").removeClass("ui-state-pined");p.uiOstabsNewTab.removeClass("ui-state-open ui-state-default");f.selected=p.anchors.index(this);if(s.hasClass("nos-ostabs-selected")||s.hasClass("ui-state-processing")||p.panels.filter(":animated").length||p._trigger("select",null,p._ui(s[0],r[0]))===false){this.blur();return false}p._abort();if(r.length){if(o.length){p.element.queue("tabs",function(){m(q,o)})}p.element.queue("tabs",function(){p.stackOpening.push(q);l(q,r)});a("title").text(s.find(".nos-ostabs-label").text());p._load(p.anchors.index(this))}else{throw"jQuery UI Tabs: Mismatching fragment identifier."}this.blur()});this.anchors.bind("click.tabs",function(){return false});this._tabsWidth()},_getIndex:function(c){if(typeof c=="string"){c=this.anchors.index(this.anchors.filter("[href$="+c+"]"))}return c},_actions:function(r,j){var q=this,g=this.options;var l=q.lis.eq(j),k=q.anchors.eq(j);var h=a("<div></div>").addClass("nos-ostabs-actions ui-state-active").prependTo(r);var n=a("<div></div>").addClass("nos-ostabs-actions-links").prependTo(h);var e=l.not(".nos-ostabs-tray").not(".nos-ostabs-appstab").not(".nos-ostabs-newtab").length;var m=l.not(".nos-ostabs-appstab").length;var i=k.data("iframe.tabs");if(m){var p=a('<a href="#"></a>').addClass("nos-ostabs-close").click(function(){q.remove(q.lis.index(l));return false}).appendTo(n);a("<span></span>").addClass("ui-icon ui-icon-closethick").text(e&&!a.inArray(j,q.pined)?g.texts.removeTab:g.texts.closeTab).appendTo(p);a("<span></span>").text(e&&!a.inArray(j,q.pined)?g.texts.removeTab:g.texts.closeTab).appendTo(p)}if(e){var d=a('<a href="#"></a>').addClass("nos-ostabs-pin").click(function(){q._pin(q.lis.index(l));return false}).text(g.texts.pinTab).appendTo(n);a("<span></span>").addClass("ui-icon ui-icon-pin-s").text(g.texts.pinTab).appendTo(d);var f=a('<a href="#"></a>').addClass("nos-ostabs-unpin").click(function(){q._unpin(q.lis.index(l));return false}).text(g.texts.unpinTab).appendTo(n);a("<span></span>").addClass("ui-icon ui-icon-pin-w").text(g.texts.unpinTab).appendTo(f)}if(i){var c=a('<a href="#"></a>').addClass("nos-ostabs-reload").click(function(){var o=r.find("iframe.nos-ostabs-panel-content");if(o!==b){o.attr("src",o.attr("src"))}return false}).text(g.texts.reloadTab).appendTo(n);a("<span></span>").addClass("ui-icon ui-icon-refresh").text(g.texts.pinTab).appendTo(c)}},_tabsWidth:function(){var d=0;this.uiOstabsTabs.width(10000000);this.uiOstabsTabs.find("li").each(function(){d+=a(this).outerWidth(true)});this.uiOstabsTabs.width(d);var c=this.uiOstabsTabs.find(".nos-ostabs-label:visible").length,e;if(this.tabsWidth<this.uiOstabsTabs.width()){while(this.tabsWidth<this.uiOstabsTabs.width()&&this.labelWidth>this.options.labelMinWidth){e=this.labelWidth-this.options.labelMinWidth;e=e>10?10:e;d=d-c*e;this.uiOstabsTabs.width(d);this.labelWidth=this.labelWidth-e;a("head .tabswidth").remove();a('<style type="text/css" class="tabswidth">.nos-ostabs .ui-widget-header .nos-ostabs-label {width : '+this.labelWidth+"px !important;}</style>").appendTo("head")}}else{do{e=this.options.labelMaxWidth-this.labelWidth;e=e>10?10:e;if(this.tabsWidth>(d+c*10)){d=d+c*e;this.uiOstabsTabs.width(d);this.labelWidth=this.labelWidth+e;a("head .tabswidth").remove();a('<style type="text/css" class="tabswidth">.nos-ostabs .ui-widget-header .nos-ostabs-label {width : '+this.labelWidth+"px !important;}</style>").appendTo("head")}}while(this.tabsWidth>(d+c*10)&&this.labelWidth<this.options.labelMaxWidth)}this._scrollState()},_scroll:function(d){var c=this,f=parseInt(c.uiOstabsTabs.css("left").replace("px",""));if((d&&f>=0)||(!d&&(f+c.uiOstabsTabs.width())<=c.uiOstabsTabsWrap.width())){return false}var e=this.uiOstabsTabs.find("li");e.each(function(g,h){var j=a(this).position();if((f+j.left)>=0){if((!d&&g<(e.length-1))||(d&&g>0)){j=e.eq(d?g-1:g+1).position();f=j.left*-1;c.uiOstabsTabs.animate({left:f+"px"},200,function(){c._scrollState()})}return false}})},_scrollTo:function(c){var d=this;var g=c.position();var f=parseInt(d.uiOstabsTabs.css("left").replace("px",""));if((g.left+c.outerWidth(true)-f)<d.uiOstabsTabsWrap.width()){return true}var e=this.uiOstabsTabs.find("li");e.each(function(){var h=a(this).position();if((g.left+c.outerWidth(true)-h.left)<d.uiOstabsTabsWrap.width()){f=h.left*-1;d.uiOstabsTabs.animate({left:f+"px"},200,function(){d._scrollState()});return false}})},_scrollState:function(){if(this.tabsWidth<this.uiOstabsTabs.width()){this.uiOstabsScrollRight.add(this.uiOstabsScrollLeft).removeClass("ui-state-disabled").show();var c=parseInt(this.uiOstabsTabs.css("left").replace("px",""));if(c>=0){this.uiOstabsScrollLeft.addClass("ui-state-disabled")}if(c+this.uiOstabsTabs.width()<this.tabsWidth){this.uiOstabsScrollRight.addClass("ui-state-disabled")}}else{this.uiOstabsScrollRight.add(this.uiOstabsScrollLeft).removeClass("ui-state-disabled").hide()}},add:function(e,d){if(!a.isPlainObject(e)||e.url===b){return false}if(d===b){d=this.anchors.length-1}var c=this,f=c._add(e);if(d<this.lis.length){f.insertBefore(this.lis[d])}else{d=this.lis.eq(f)}this.uiOstabsTabs.sortable("refresh");c.pined=a.map(c.pined,function(h,g){return h>=d?++h:h});this._tabify();if(this.anchors.length==1){c.select(0)}this._trigger("add",e,this._ui(f[0]));return d},_add:function(g,h){if(!a.isPlainObject(g)||g.url===b){return false}h=h||this.uiOstabsTabs;g=a.extend({url:"",iframe:false,label:"",labelDisplay:true,iconClasses:"ui-icon ui-icon-document",iconUrl:"",iconSize:16,pined:false,panelId:false},g);var d=a('<a href="'+g.url+'"></a>');if(g.iframe){d.data("iframe.tabs",true)}if(g.panelId){d.data("panelid.tabs",g.panelId)}var f=this._icon(g).appendTo(d);var e=a("<span></span>").addClass("nos-ostabs-label").text(g.label).appendTo(d);if(!g.labelDisplay){e.hide()}var c=a("<li></li>").append(d).attr("title",g.label).addClass("ui-corner-top ui-state-default"+(g.pined?" ui-state-pined":"")).data("ui-ostab",g).appendTo(h);if(!isNaN(g.iconSize)&&g.iconSize!==16&&h!==this.uiOstabsTabs){c.css({height:(g.iconSize+4)+"px",bottom:(g.iconSize-35)+"px"});f.css("top","2px")}return c},remove:function(d){d=this._getIndex(d);var c=this,j=this.options,k=this.lis.eq(d),g=this.anchors.eq(d),h=c.element.find(c._sanitizeSelector(c.anchors[d].hash));if(d==0&&!k.hasClass("nos-ostabs-selected")){var f=this.lis.filter(".nos-ostabs-newtab");if(f.hasClass("nos-ostabs-selected")){k=f}}if(a.inArray(d,this.pined)===-1&&k.not(".nos-ostabs-tray").not(".nos-ostabs-appstab").not(".nos-ostabs-newtab").length){k.remove();h.remove()}k.removeClass("ui-state-active ui-state-open");for(var e=0;e<c.stackOpening.length;e++){if(c.stackOpening[e]===g.get(0)){c.stackOpening.splice(e,1)}}if(c.stackOpening.length){this.select(this.anchors.index(c.stackOpening[c.stackOpening.length-1]))}else{this.select(0)}if(k.not(".nos-ostabs-appstab").not(".nos-ostabs-newtab").length){a("> *",h).not(".nos-ostabs-actions").remove()}h.addClass("nos-ostabs-hide").removeData("callbacks.ostabs");k.removeClass("nos-ostabs-selected");if(a.inArray(d,this.pined)){k.addClass("ui-state-pined")}if(a.inArray(d,this.pined)===-1&&k.not(".nos-ostabs-tray").not(".nos-ostabs-appstab").not(".nos-ostabs-newtab").length){c.pined=a.map(c.pined,function(m,l){return m>=d?--m:m})}this._tabify();this._trigger("remove",null,this._ui(k[0],h[0]));return this},title:function(d,f){d=this._getIndex(d);var c=this,e=this.options;var g=this.lis.eq(d);if(f===b){return g.find(".nos-ostabs-label").text()}else{g.find(".nos-ostabs-label").text(f);if(this.options.selected==d){a("title").text(f)}this._trigger("title",null,this._ui(g[0]));return c}},update:function(e,f){var d=this;e=d._getIndex(e);if(!a.isPlainObject(f)){return false}var h=d.lis.eq(e);f=a.extend({},h.data("ui-ostab"),f);if(d.options.selected==e){a("title").text(f.label)}var c=d._add(f),g=c.find("a");h.data("ui-ostab",f).attr("title",f.label||"").addClass(c.attr("class")).css({height:c.css("height"),bottom:c.css("bottom")}).find("a").empty().append(g.children());c.remove();return d},_icon:function(d){var c=a("<span></span>").addClass("nos-ostabs-icon");if(d.iconUrl){c.css("background-image",'url("'+d.iconUrl+'")')}else{c.addClass(d.iconClasses)}if(!isNaN(d.iconSize)&&d.iconSize!==16){c.css({width:d.iconSize+"px",height:d.iconSize+"px",lineHeight:d.iconSize+"px",top:(d.iconSize>22?22-d.iconSize:10-d.iconSize/2)+"px"})}return c},_unpin:function(d){var c=this,e=this.options;d=c._getIndex(d);if(a.inArray(d,c.pined)==-1){return}c.element.find(c._sanitizeSelector(c.anchors[d].hash)).find(".nos-ostabs-actions .nos-ostabs-close span").text(e.texts.removeTab);c.lis.eq(d).add(c.element.find(c._sanitizeSelector(c.anchors[d].hash))).removeClass("ui-state-pined");c.pined=a.grep(c.pined,function(g,f){return g!=d});c._trigger("unpin",null,c._ui(c.lis[d]));return this},_pin:function(d){var c=this,f=this.options;d=this._getIndex(d);if(a.inArray(d,c.pined)==-1){var e=c.element.find(c._sanitizeSelector(c.anchors[d].hash));e.find(".nos-ostabs-actions .nos-ostabs-close span").text(f.texts.closeTab);var g=this.lis.eq(d);g.add(e).addClass("ui-state-pined");if(g.hasClass("nos-ostabs-selected")){g.removeClass("ui-state-pined")}c.pined.push(d);c.pined.sort();this._trigger("pin",null,this._ui(this.lis[d]))}return this},select:function(c){c=this._getIndex(c);if(c==-1){return this}this.anchors.eq(c).trigger("click.tabs");return this},_load:function(g){g=this._getIndex(g);var e=this,j=this.options,d=this.anchors.eq(g)[0],f=a.data(d,"load.tabs"),h=a.data(d,"iframe.tabs");this._abort();if((!f&&h)||this.element.queue("tabs").length!==0&&a.data(d,"cache.tabs")){this.element.dequeue("tabs");return}var c=e.element.find(e._sanitizeSelector(d.hash)),i=a("> *",c).not(".nos-ostabs-actions").length;if(i!==0){this.element.dequeue("tabs");return}this.lis.eq(g).addClass("ui-state-processing");a("span.nos-ostabs-label",d).each(function(){a(this).data("label.tabs",a(this).html()).html(a(this).data("label.tabs")?j.texts.spinner:"")});if(a.isFunction(a.fn.loadspinner)){a("span.nos-ostabs-icon",d).each(function(){a(this).addClass("ui-state-processing").loadspinner({diameter:a(this).width(),scaling:true})})}if(!h){this.xhr=a.ajax({url:f,success:function(k){a("<div></div>").addClass("nos-ostabs-panel-content nos-connector").data("nos-ostabs-index",g).prependTo(c.data("callbacks.ostabs",{})).html(k);a.data(d,"cache.tabs",true)},complete:function(){e._cleanup();e._trigger("load",null,e._ui(e.lis[g]))}})}else{a("<iframe "+(a.browser.msie?'allowTransparency="true" ':"")+'src="'+f+'" frameborder="0"></iframe>').data("nos-ostabs-index",g).addClass("nos-ostabs-panel-content nos-connector").bind("load",function(){e._cleanup();e._trigger("load",null,e._ui(e.lis[g]))}).prependTo(c.data("callbacks.ostabs",{}));a.data(d,"cache.tabs",true)}e.element.dequeue("tabs");return this},_abort:function(){this.element.queue([]);this.panels.stop(false,true);this.element.queue("tabs",this.element.queue("tabs").splice(-2,2));this._cleanup();return this},tabs:function(){var c=[];this.uiOstabsTabs.find("li:not(.nos-ostabs-newtab)").each(function(){c.push(a(this).data("ui-ostab"))});return c},triggerPanels:function(d){var c=this,e=this.options;if(!a.isPlainObject(d)){d={event:d}}a.each(c.panels,function(f){var h=a(this);if(f===e.selected){c._firePanelEvent(h,d)}else{var g=h.data("callbacks.ostabs");if(a.isPlainObject(g)){g[d.event+(d.type?"."+d.type:"")]=d}}});return c},_firePanelEvent:function(f,c){f=f.is(".nos-connector")?f:f.find(".nos-connector");var d=a.Event(c.event,{namespace:c.type||null,data:c.data||null});if(f.is("iframe")){if(f[0].contentDocument.$){f[0].contentDocument.$("body").trigger(d)}}else{try{f.trigger(d)}catch(d){log(d)}}},current:function(){var c=this,d=this.options;return{tab:a(c.lis.get(d.selected)),panel:a(c.panels.get(d.selected)),index:d.selected}}});a(function(){var c=a("#noviusos");a.extend(a.nos,{$noviusos:c,initialize:function(f){var d=this;var e=function(g){d.tabs.save()};a.extend(f,{add:e,pin:e,unpin:e,remove:e,select:e,show:e,drag:e});if(f.user_configuration["tabs"]){if(!f.options){f.options={}}f.initTabs=f.user_configuration["tabs"]["tabs"];f.selected=f.user_configuration["tabs"]["selected"]}c.ostabs(f)},tabs:{current:function(d){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos(window.frameElement).data("nos-ostabs-index")}if(a.isNumeric(d)){return d}if(a.type(d)==="object"&&a.isFunction(d.parents)){return d.parents(".nos-ostabs-panel-content").data("nos-ostabs-index")}if(c.length){return c.ostabs("current").index}return false},add:function(f,d){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos.nos.tabs.add(f,d)}var e;if(d!==b&&d!==true){e=this.current(d)+1}if(c.length){e=c.ostabs("add",f,e);return c.ostabs("select",e)}else{if(f.url){window.open(f.url)}}return false},update:function(d,e){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos.nos.tabs.update(this.current(),d,e)}if(e==null){e=d}d=this.current(d);if(c.length){c.ostabs("update",d,e)}return true},close:function(d){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos.nos.tabs.close(this.current())}d=this.current(d);if(c.length){c.ostabs("remove",d)}return true},replace:function(e){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos.nos.tabs.replace(e)}var d=this.current();this.add({url:e},false);this.close(d);return true},save:function(){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos.nos.tabs.save()}if(c.length){$nos.nos.saveUserConfiguration("tabs",{selected:c.ostabs("option","selected"),tabs:c.ostabs("tabs")})}}}})});return a});
define("jquery-nos-preview",["jquery","log","order!jquery-ui","order!wijmo-open","order!wijmo-complete","order!jquery-nos"],function(a){var b=void (0);a.widget("nos.preview",{options:{meta:{},actions:[],data:null,dataParser:null,texts:{headerDefault:"Preview",selectItem:"No item selected"}},data:null,_create:function(){var c=this,d=c.options;c.element.addClass("nos-preview ui-widget ui-widget-content wijmo-wijgrid").parents(".nos-appdesk").bind("selectionChanged.appdesk",function(g,f){if(a.isPlainObject(f)){c.select(f)}else{c.unselect()}})},_init:function(){var c=this,d=c.options;c.data=c.data||d.data;if(a.isPlainObject(c.data)){c.select(c.data)}else{c.unselect()}},_uiHeader:function(g){var c=this,f=c.options;var d=a('<table cellspacing="0" cellpadding="0" border="0"><thead></thead></table>').addClass("nos-preview-header wijmo-wijsuperpanel-header wijmo-wijgrid-root wijmo-wijgrid-table").css({borderCollapse:"separate","-moz-user-select":"-moz-none"}).appendTo(c.element);var e=a("<tr></tr>").addClass("wijmo-wijgrid-headerrow").appendTo(d);a("<th><div><span></span></div></th>").addClass("wijgridth ui-widget wijmo-c1basefield ui-state-default wijmo-c1field").appendTo(e).find("div").addClass("wijmo-wijgrid-innercell").find("span").addClass("wijmo-wijgrid-headertext").text(g);return c},_uiFooter:function(){var c=this,d=c.options;if(d.actions.length>0){c.uiFooter=a("<div></div>").addClass("nos-preview-footer").appendTo(c.uiContainer);a.each(d.actions,function(){var f=this;var e=false;if(f.iconClasses){e=f.iconClasses}else{if(f.icon){e="nos-icon16 ui-icon ui-icon-"+f.icon}}var g;if(f.primary){g=(e?'<span class="ui-button-icon-primary '+e+' wijmo-wijmenu-icon-left"></span>':"");g+='<span class="ui-button-text">'+f.label+"</span>";a("<button></button>").addClass("ui-button ui-button-text"+(f.icon?"-icon-primary":"")+" ui-widget ui-state-default ui-corner-all").css({marginBottom:"5px"}).appendTo(c.uiFooter).html(g).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}).click(function(h){h.preventDefault();h.stopImmediatePropagation();f.action.apply(this,[c.data,a(this)])})}else{g=(e?'<span class="'+e+'"></span> ':"");g+='<span class="ui-button-text">'+f.label+"</span>";a('<a href="#"></a>').css({display:"inline-block",marginBottom:"5px"}).appendTo(c.uiFooter).html(g).click(function(h){h.preventDefault();h.stopImmediatePropagation();f.action.apply(this,[c.data,a(this)])})}})}return c},_uiThumbnail:function(d){var c=this,e=c.options,f=d.thumbnail.replace(/64-64/g,"256-256")||d.thumbnailAlternate;if(f){c._loadImg(d,f)}return c},_loadImg:function(d,f){var c=this,e=c.options;a("<img />").error(function(){a(this).remove();if(f===d.thumbnail&&d.thumbnailAlternate){c._loadImg(d,d.thumbnailAlternate)}}).load(function(){var h=a(this),g=h.height();var j=a("<div></div>").addClass("nos-preview-thumb").css({backgroundImage:'url("'+h.attr("src")+'")',height:(g<=100?g:100)+"px"}).prependTo(c.uiContainer);var i=null;a.each(e.actions,function(){if(this.name==e.actionThumbnail){i=this}});if(i!==null){j.attr({title:i.label}).css({cursor:"pointer"}).click(function(k){k.preventDefault();k.stopImmediatePropagation();i.action.apply(this,[c.data])})}h.remove()}).css({position:"absolute",visibility:"hidden"}).attr("src",f).appendTo("body");return c},_uiMetaData:function(f){var c=this,g=c.options,d=0;var e=a('<table cellspacing="0" cellpadding="0" border="0"><tbody></tbody></table>').addClass("nos-preview-metadata wijmo-wijgrid-root wijmo-wijgrid-table").css({borderCollapse:"separate","-moz-user-select":"-moz-none"}).appendTo(c.uiContainer).find("tbody").addClass("ui-widget-content wijmo-wijgrid-data");a.each(g.meta,function(h,j){var i=a("<tr></tr>").addClass("wijmo-wijgrid-row ui-widget-content wijmo-wijgrid-datarow"+(d%2?" wijmo-wijgrid-alternatingrow":"")).appendTo(e);a("<th><div></div></th>").addClass("wijgridtd wijdata-type-string").appendTo(i).find("div").addClass("wijmo-wijgrid-innercell").text(j.label||"");a("<td><div></div></td>").addClass("wijgridtd wijdata-type-string").appendTo(i).find("div").addClass("wijmo-wijgrid-innercell").text(f[h]||"");d++});return c},unselect:function(){var c=this,d=c.options;c.element.wijsuperpanel("destroy").empty();c._uiHeader(d.texts.headerDefault);c.uiContainer=a("<div></div>").addClass("nos-preview-noitem").text(d.texts.selectItem).appendTo(c.element);c.element.wijsuperpanel({showRounder:false});return c},select:function(d){var c=this,e=c.options;if(d===b){return c.data}else{c.data=d;if(a.isFunction(e.dataParser)){d=e.dataParser(d)}c.element.wijsuperpanel("destroy").empty().css("height","100%");c._uiHeader(d.title);c.uiContainer=a("<div></div>").addClass("nos-preview-container").appendTo(c.element);c._uiThumbnail(d)._uiMetaData(d.meta)._uiFooter();c.element.wijsuperpanel({showRounder:false,autoRefresh:true})}return c},resize:function(){var c=this;c._init();return c}});return a});
define("jquery-nos-listgrid",["jquery","log","order!jquery-ui","order!wijmo-open","order!wijmo-complete","order!jquery-nos"],function(a){a.widget("nos.noslistgrid",a.wijmo.wijgrid,{options:{texts:{loading:"Loading..."}},_create:function(){var b=this;a.wijmo.wijgrid.prototype._create.call(b)},_init:function(){var e=this,g=e.options;if(a.isFunction(g.dataLoading)){var f=g.dataLoading}g.dataLoading=function(){e._overlayShow();if(a.isFunction(f)){f.apply(this,arguments)}};if(a.isFunction(g.dataLoaded)){var c=g.dataLoaded}g.dataLoaded=function(){e._overlayHide();if(a.isFunction(c)){c.apply(this,arguments)}};if(a.isFunction(g.columnResized)){var b=g.columnResized}g.columnResized=function(j,h){var i=e.option("columns");a.extend(i[h.column.thX],{ensurePxWidth:true,width:h.column.width});e.setSize(e.outerDiv.parent().width());if(a.isFunction(b)){b.apply(this,arguments)}};if(a.isFunction(g.dataLoaded)){var d=g.ajaxError}g.ajaxError=function(l,h){var k=h.XMLHttpRequest;if(k.status==403){var j={title:"You've been inactive for too long",text:"Please log-in again.",type:"error"};try{var i=a.parseJSON(k.responseText);if(i.login_page){j.text=j.text.replace("log-in again",'<a href="'+i.login_page+'">log-in again</a>')}}catch(l){}a.nos.notify(j)}e._overlayHide();if(a.isFunction(d)){d.apply(this,arguments)}};a.wijmo.wijgrid.prototype._init.call(e)},_overlayShow:function(){var b=this,c=b.options;b.uiOverlay=a("<div></div>").addClass("wijmo-wijgrid-overlay ui-widget-overlay").appendTo(b.outerDiv);b.uiOverlayText=a("<span><span></span>"+c.texts.loading+"</span>").addClass("wijmo-wijgrid-loadingtext ui-widget-content ui-corner-all").find("span").addClass("ui-icon ui-icon-clock").end().appendTo(b.outerDiv);b.uiOverlayText.css({marginLeft:(b.uiOverlayText.width()*-1/2)+"px",marginTop:(b.uiOverlayText.height()*-1/2)+"px"});return b},_overlayHide:function(){var b=this;b.uiOverlay.remove();b.uiOverlayText.remove();return b}});return a});
define("jquery-nos-treegrid",["jquery","log","order!jquery-ui","order!wijmo-open","order!wijmo-complete","order!jquery-nos","order!jquery-nos-listgrid"],function(a){var b=void (0);a.widget("nos.nostreegrid",a.nos.noslistgrid,{options:{treeUrl:"",treeOptions:null,treeColumnIndex:0,sortable:true,movable:true,data:[],preOpen:null},oldFirstColumn:null,treeData:{},treeDataSource:null,dragged:false,dropTarget:false,dragHelper:false,mousePressed:false,mouseMoved:false,timer:false,_create:function(){var d=this,f=d.options;if(a.isFunction(f.rendered)){var e=f.rendered}f.rendered=function(){if(a.isFunction(e)){e.apply(this,arguments)}d._dragInit()};if(a.isFunction(f.rowStyleFormatter)){var c=f.rowStyleFormatter}f.rowStyleFormatter=function(g){if(a.isFunction(c)){c.apply(this,arguments)}if(d.draggedIndex&&g.state&a.wijmo.wijgrid.renderState.hovered){g.$rows.removeClass("ui-state-hover")}};f.allowPaging=false;a.nos.noslistgrid.prototype._create.call(d)},_init:function(){var c=this,d=c.options;c.oldFirstColumn=a.extend(true,{},d.columns[d.treeColumnIndex]);d.columns[d.treeColumnIndex].cellFormatter=function(e){if(a.isPlainObject(e.row.data)){var g=e.$container.closest("tr"),f=e.row.data;if(e.column.dataKey){a("<span></span>").text(e.row.data[e.column.dataKey]).appendTo(e.$container)}else{if(a.isFunction(c.oldFirstColumn.cellFormatter)){c.oldFirstColumn.cellFormatter(e)}}if(f.treeChilds){a('<div class="nostreegrid-toggle"></div>').css({marginLeft:(f.treeLevel*20)+"px",cursor:"pointer"}).addClass("ui-icon").addClass(a.isPlainObject(f.treeChilds)?"ui-icon-triangle-1-se":"ui-icon-triangle-1-e").click(function(h){h.stopImmediatePropagation();if(a.isPlainObject(f.treeChilds)){c._toggle(g,false)}else{c._toggle(g,true)}}).prependTo(e.$container)}else{a('<div class="nostreegrid-toggle"></div>').css({marginLeft:(f.treeLevel*20)+"px"}).addClass("nos-icon16 nos-icon16-empty").prependTo(e.$container)}g.data("treeNode",f);return true}};if(d.movable){d.columns.unshift({allowSort:false,allowMoving:false,allowSizing:false,width:25,ensurePxWidth:true,cellFormatter:function(e){if(a.isPlainObject(e.row.data)){e.$container.append('<div class="ui-icon ui-icon-grip-dotted-vertical nostreegrid-move-handle"></div>');return true}}})}a.each(d.columns,function(){this.sortDirection="none"});a.nos.noslistgrid.prototype._init.call(c);c._datasource();c.treeDataSource.proxy.options.data.deep=2;if(a.isPlainObject(d.preOpen)){c.treeDataSource.proxy.options.data.preOpen=d.preOpen}c.treeDataSource.load();d.preOpen=null;delete c.treeDataSource.proxy.options.data.preOpen},_setOption:function(d,e){var c=this;a.nos.noslistgrid.prototype._setOption.apply(c,arguments);if(d==="treeOptions"){c._datasource().reload()}},_datasource:function(){var c=this,d=c.options;c.treeDataSource=new wijdatasource({dynamic:true,proxy:new wijhttpproxy({url:d.treeUrl,dataType:"json",error:function(e,g,f){log(e,g,f)},data:d.treeOptions||{}}),loaded:function(k,h){var j=c.data(),g=function(e){return a.map(e,function(m,l){if(l==="length"){return null}var n=m;if(a.isPlainObject(m.treeChilds)){n=[m].concat(g(m.treeChilds))}return n})};if(!a.isPlainObject(h)){c.treeData=c._completeChilds(null,k.items);Array.prototype.splice.apply(j,[0,j.length].concat(g(c.treeData)))}else{var f=a.inArray(h.node,j);c._removeNode(h.node);if(h.close){h.node.treeChilds=k.data.total;Array.prototype.splice.apply(j,[f,0,h.node])}else{h.node.treeChilds=c._completeChilds(h.node,k.items);Array.prototype.splice.apply(j,[f,0,h.node].concat(g(h.node.treeChilds)))}}try{c.ensureControl(true)}catch(i){}},reader:{read:function(e){e.items=e.data.items}}});return c},_dragInit:function(){var c=this,e=c.options;if(!e.movable){return c}c.element.find("tr.wijmo-wijgrid-row").each(function(){var h=a(this),g=h.data("treeNode"),i=h.find(".nostreegrid-move-handle");if(!c._trigger("movabled",null,{node:g,$tr:h})){return false}i.mousedown(function(k){if(k.which!=1){return true}k.stopImmediatePropagation();c.mousePressed=new Date().getTime();var j=h.clone();c.dragHelper=a('<div class="nostreegrid-drag-helper ui-state-highlight"></div>').hide().css("opacity","0.8").append(j.find("td:eq(1)").find(">div")).appendTo("body");c.helperInsert=a('<div class="nostreegrid-drag-inserthelper ui-state-highlight"></div>');a(document).on("mousemove",{treeGrid:c,node:g,$tr:h},c._dragStart).on("mouseup",{treeGrid:c},c._dragDestroy)});h.mouseup(function(){if(c.mousePressed&&c.mouseMoved&&c.dragged&&c.dropTarget){if(c._trigger("dropped",null,{dragged:c.dragged,dropped:h,notification:true})){c._move(h)}}c._dragDestroy()})});if(c.draggedIndex){var f=c.mousePressed,d=c.element.find("tr.wijmo-wijgrid-row").eq(c.draggedIndex);c._dragDestroy();d.find(".nostreegrid-move-handle").trigger(jQuery.Event("mousedown",{which:1}));c.mousePressed=f;c.dragOpen.event.target=c.element.find("tr.wijmo-wijgrid-row")[c.dragOpen.index];c.dragOpen.event.data.$tr=d;d.trigger(c.dragOpen.event)}return c},_dragStart:function(c){var q=c.data.treeGrid,e=q.options,f=c.data.node,k=c.data.$tr;if(!e.movable){return q}if(q.mousePressed&&(new Date().getTime()-q.mousePressed)>500){if(!q._scroller){q._scroller={superpanel:q._view()._scroller.data("wijsuperpanel")};var p=q._scroller.superpanel.getContentElement(),i=p.parent(),g=i.offset();q._scroller.contentElement=q._scroller.superpanel.getContentElement();q._scroller.contentWrapper=q._scroller.contentElement.parent();a.extend(q._scroller,q._scroller.contentElement.offset(),{bottom:g.top+i.height()})}if(c.pageY<q._scroller.top){q._scroller.superpanel._doScrolling("top",q._scroller.superpanel,true)}else{if(c.pageY<(q._scroller.top+20)){q._scroller.superpanel._doScrolling("top",q._scroller.superpanel)}else{if(c.pageY>q._scroller.bottom){q._scroller.superpanel._doScrolling("bottom",q._scroller.superpanel,true)}else{if(c.pageY>(q._scroller.bottom-20)){q._scroller.superpanel._doScrolling("bottom",q._scroller.superpanel)}}}}if(!q.mouseMoved){var j=a("body");if(j.css("cursor")){q._cursor=j.css("cursor")}j.css("cursor","move");q.mouseMoved=true}if(q.timer){clearTimeout(q.timer)}if(!q.dragHelper.is(":visible")){q.dragHelper.show();q.dragged=k;q.draggedIndex=k.data("wijgriddataItemIndex")}q.dragHelper.css({left:(c.pageX+5),top:(c.pageY+15)});k.css("visibility","hidden");q.dropTarget=false;var d=a(c.target).parents("tr:first");if(a(c.target).closest(q.element).size()&&(a(c.target).is("tr.wijmo-wijgrid-row")||a(c.target).parents("tr.wijmo-wijgrid-row").size())){var l=d.data("treeNode"),h=a.extend({width:d.width(),height:d.height()},d.offset()),m=d.find(".nostreegrid-toggle"),n=a.inArray(f.treeHash,l.treePath)!==-1;if(!n&&e.sortable&&c.pageY<(h.top+5)){q.dropTarget="before";d.removeClass("ui-state-hover");q.helperInsert.css({marginLeft:(parseInt(m.css("margin-left").replace("px",""))+m.width())+"px",marginBottom:""}).insertBefore(m)}else{if(!n&&e.sortable&&c.pageY>(h.top+h.height-5)){q.dropTarget="after";d.removeClass("ui-state-hover");q.helperInsert.css({marginLeft:(parseInt(m.css("margin-left").replace("px",""))+m.width())+"px",marginTop:""}).appendTo(d.find("td:eq(1)").find(">div"))}else{q.helperInsert.detach();if(n||!q._trigger("dropped",null,{dragged:k,dropped:d,notification:false})){d.removeClass("ui-state-hover")}else{q.dropTarget="in";if(a(c.target).hasClass("nostreegrid-toggle")&&a(c.target).hasClass("ui-icon-triangle-1-e")){q.timer=setTimeout(function(){q.dragOpen={event:c,index:d.data("wijgriddataItemIndex")};a(c.target).click()},700)}d.addClass("ui-state-hover")}}}}else{d.removeClass("ui-state-hover");q.dragHelper.hide();q.helperInsert.detach()}}return q},_dragDestroy:function(d){var c=d?d.data.treeGrid:this,e=c.options;if(!e.movable){return c}if(c.timer){clearTimeout(c.timer)}if(c.dragHelper){a(document).off("mousemove",c._dragStart).off("mouseup").off("mousedown");a("body").css("cursor",c._cursor||"auto");c.dragHelper.remove();c.helperInsert.remove();if(c.dragged){c.dragged.css("visibility","visible")}c.dragged=c.mousePressed=c.mouseMoved=c.dragHelper=c.timer=c._scroller=false}return c},_completeChilds:function(e,f){var d=this,c=0,g={};a.each(f,function(i,h){a.extend(h,{treeHash:h._model+"|"+h._id,treeLevel:!e?0:e.treeLevel+1,treePath:!e?[]:e.treePath.concat([e.treeHash])});if(a.isArray(h.treeChilds)||a.isPlainObject(h.treeChilds)){h.treeChilds=d._completeChilds(h,h.treeChilds)}c++;g[h.treeHash]=h});return a.extend({length:c},g)},_getTreeNode:function(e){var c=this,d=null;a.each(e,function(f,g){d=!d?c.treeData[g]:d.treeChilds[g]});return d},_move:function(g){var c=this,f=c.options,e=c.dragged.data("treeNode"),d=g.data("treeNode");a.ajax({async:true,url:f.treeUrl,data:{move:true,itemModel:e._model,itemId:e._id,targetModel:d._model,targetId:d._id,targetType:c.dropTarget},dataType:"json",success:function(l,m){c.draggedIndex=false;if(c.dropTarget==="in"){c._removeNode(e);c._toggle(g,true)}else{var i=c._getTreeNode(e.treePath),k=c._getTreeNode(d.treePath),h=a.inArray(k,c.data()),j=c.element.find("tr.wijmo-wijgrid-row").eq(h);c._removeNode(e);delete i.treeChilds[e.treeHash];delete i.treeChilds.length;i.treeChilds=c._completeChilds(i,i.treeChilds);c._toggle(j,true)}},error:function(h,j,i){log("error",j,i)}});return c},_toggle:function(f,d){var c=this,g=c.options,e=f.data("treeNode");d=d===b?f.hasClass("ui-icon-triangle-1-e"):d;f.find(".nostreegrid-toggle").addClass(d?"ui-icon-clock":"ui-icon-triangle-1-e").removeClass(d?"ui-icon-triangle-1-e":"ui-icon-triangle-1-se");c.treeDataSource.proxy.options.data.deep=d?1:-1;c.treeDataSource.proxy.options.data.id=e._id;c.treeDataSource.proxy.options.data.model=e._model;c.treeDataSource.load({close:d?false:true,node:e});return c},_removeNode:function(e){var c=this,d=false,g=0,f=c.data();a.each(f,function(j,k){var h=e.treeHash===k.treeHash||a.inArray(e.treeHash,k.treePath)!==-1;if(h){if(d===false){d=j}g++}if(!h&&d){return false}});if(d!==false){Array.prototype.splice.apply(f,[d,g])}return g},reload:function(){var c=this;c.treeDataSource.proxy.options.data.deep=2;delete c.treeDataSource.proxy.options.data.id;delete c.treeDataSource.proxy.options.data.model;c.treeDataSource.load();return c}});return a});
define("jquery-nos-thumbnailsgrid",["jquery","log","order!jquery-ui","order!wijmo-open","order!wijmo-complete","order!jquery-nos"],function(a){var b=void (0);a.widget("nos.thumbnailsgrid",{options:{thumbnailSize:128,pageIndex:0,pageSize:null,url:"",texts:{loading:"Loading..."},actions:[],loading:null,loaded:null,reader:null,dataParser:null,thumbFormatter:null},_data:null,_create:function(){var c=this;c.uiPager=a("<div></div>").addClass("wijmo-wijsuperpanel-footer  ui-state-default").appendTo(c.element)},destroy:function(){var c=this,d=c.options;c.uiPager.wijpager("destroy");c.uiPager.remove();c.element.removeClass("nos-thumbnailsgrid nos-thumbnailsgrid-size-"+d.thumbnailSize).wijsuperpanel("destroy");a.Widget.prototype.destroy.apply(this,arguments)},_init:function(){var d=this,f=d.options;if(a.inArray(f.thumbnailSize,[64,128])===-1){f.thumbnailSize=128}d.uiPager.wijpager({pageIndexChanging:function(h,g){d._trigger("pageIndexChanging",null,g);f.pageIndex=g.newPageIndex;d._load()},pageIndexChanged:function(h,g){d._trigger("pageIndexChanged");f.pageIndex=g.newPageIndex;d._load()}});d.element.addClass("nos-thumbnailsgrid nos-thumbnailsgrid-size-"+f.thumbnailSize).wijsuperpanel({showRounder:false,autoRefresh:true});d.uiContainer=a(d.element.wijsuperpanel("getContentElement"));d.uiOverlay=a("<div></div>").addClass("nos-thumbnailsgrid-overlay ui-widget-overlay").appendTo(d.element);d.uiOverlayText=a("<span><span></span>"+f.texts.loading+"</span>").addClass("nos-thumbnailsgrid-loadingtext ui-widget-content ui-corner-all").find("span").addClass("ui-icon ui-icon-clock").end().appendTo(d.element);d.uiOverlayText.css({marginLeft:(d.uiOverlayText.width()*-1/2)+"px",marginTop:(d.uiOverlayText.height()*-1/2)+"px"});if(f.pageSize===null){d._displayItem({title:"Test"});var e=d.uiContainer.find(".nos-thumbnailsgrid-thumb"),c=d.uiContainer.parent();d.itemDimension={width:e.outerWidth(true),height:e.outerHeight(true)};d.uiContainer.empty();f.pageSize=Math.floor(c.width()/d.itemDimension.width)*Math.max(1,Math.floor(c.height()/d.itemDimension.height))}d.dataSource=new wijdatasource({dynamic:true,proxy:new wijhttpproxy({url:f.url,dataType:"json",error:function(i,l,k){if(i.status==403){var h={title:"You've been inactive for too long",text:"Please log-in again.",type:"error"};try{var g=a.parseJSON(i.responseText);if(g.login_page){h.text=h.text.replace("log-in again",'<a href="'+g.login_page+'">log-in again</a>')}}catch(j){}a.nos.notify(h)}d.uiOverlay.hide();log(i,l,k)},data:{}}),loading:function(h,g){h.proxy.options.data=a.extend(h.proxy.options.data,g.data);d.uiOverlay.add(d.uiOverlayText).show();if(a.isFunction(f.loading)){f.loading(h,g)}},loaded:function(h,g){if(a.isFunction(f.loaded)){f.loaded(h,g)}d.uiPager.wijpager("option",{pageCount:Math.ceil(h.data.totalRows/g.data.paging.pageSize),pageIndex:g.data.paging.pageIndex});d._data=h.data;d._display(h.data);d.uiOverlay.add(d.uiOverlayText).hide()},reader:f.reader});d._load()},_load:function(){var c=this,d=c.options;c.dataSource.load({data:{paging:{pageIndex:d.pageIndex,pageSize:d.pageSize}},afterRefresh:null,beforeRefresh:null});return c},_display:function(d){var c=this,f=c.options,e=c.uiContainer.empty().parent();c.uiContainer.detach();a.each(d,function(g){var h=this;if(a.isFunction(f.dataParser)){h={item:f.dataParser(f.thumbnailSize,h,g),noParseData:h}}else{h={item:h,noParseData:h}}c._displayItem(h,g)});c.uiContainer.appendTo(e);c._trigger("rendered");return c},_displayItem:function(h,i){var m=this,f=m.options,l=h.item,c=h.noParseData;l=a.extend({title:"",thumbnail:null,thumbnailAlternate:null},l);var e=a("<div></div>").addClass("nos-thumbnailsgrid-thumb wijmo-wijgrid ui-widget-content").data("thumbnail",{data:h,index:i}).appendTo(m.uiContainer),g=a('<table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td></td></tr></tbody></table>').addClass("nos-thumbnailsgrid-thumb-grid wijmo-wijgrid-root wijmo-wijgrid-table").attr("title",l.title).css({borderCollapse:"separate","-moz-user-select":"-moz-none"}).hover(function(){g.parent().addClass("ui-state-hover")},function(){g.parent().removeClass("ui-state-hover")}).click(function(){m.select(i)}).appendTo(e).find("tbody").addClass("ui-widget-content wijmo-wijgrid-data").find("tr").addClass("wijmo-wijgrid-row ui-widget-content wijmo-wijgrid-datarow").find("td").addClass("wijgridtd"),d=a("<div></div>").addClass("nos-thumbnailsgrid-thumb-container-img wijmo-wijgrid-innercell").appendTo(g),k=a("<div></div>").addClass("nos-thumbnailsgrid-thumb-title wijmo-wijgrid-innercell").text(l.title).appendTo(g);m._itemThumbnail(d,l,i);var j=a.nos.appdeskActions(f.actions,c);j.appendTo(e);if(a.isFunction(f.thumbFormatter)){f.thumbFormatter({"$container":e,item:{data:l,index:i}})}return m},_itemThumbnail:function(c,f,e){var d=this,g=d.options,h=f.thumbnail||f.thumbnailAlternate;if(h){d._loadImg(c,f,h)}else{d._loadImgDefault(c)}return d},_loadImg:function(c,e,g){var d=this,f=d.options;a("<img />").error(function(){if(g===e.thumbnail&&e.thumbnailAlternate){d._loadImg(c,e,e.thumbnailAlternate)}else{d._loadImgDefault(c)}}).load(function(){var h=a(this);h.prependTo(c).css({marginTop:"-"+(h.height()/2)+"px",marginLeft:"-"+(h.width()/2)+"px"})}).addClass("nos-thumbnailsgrid-thumb-img").attr("src",g);return d},_loadImgDefault:function(c){var d=this,e=d.options;a("<div></div>").addClass("nos-thumbnailsgrid-thumb-img-default").prependTo(c);return d},select:function(d){var c=this,g=c.options;if(d===b){var f=c.uiContainer.find(".nos-thumbnailsgrid-thumb:has(wijmo-wijgrid-current-cell)");if(f.length){var e=f.data("thumbnail");return e.index}return null}else{c.uiContainer.find("td").removeClass("wijmo-wijgrid-current-cell ui-state-highlight");var f=c.uiContainer.find(".nos-thumbnailsgrid-thumb").eq(d);if(f.length){var e=f.data("thumbnail");f.find(".wijgridtd").eq(0).addClass("wijmo-wijgrid-current-cell ui-state-highlight");c._trigger("selectionChanged",null,{item:e})}else{c._trigger("selectionChanged");return false}}return c},unselect:function(){this._trigger("selectionChanged")},setSize:function(e,c){var d=this;if(e!==null){d.element.width(e)}if(c!==null){d.element.height(c)}return d},data:function(){return this._data}});return a});
define("jquery-nos-appdesk",["jquery","log","order!jquery-ui","order!wijmo-open","order!wijmo-complete","order!jquery-nos","order!jquery-nos-thumbnailsgrid","order!jquery-nos-listgrid","order!jquery-nos-treegrid","order!jquery-nos-preview"],function(a){var b=void (0);a.widget("nos.appdesk",{options:{adds:[],inspectors:[],thumbnails:false,defaultView:"grid",locales:{},texts:{allLanguages:"All languages",addDropDown:"Select an action",columns:"Columns",showFiltersColumns:"Filters column header",visibility:"Visibility",settings:"Settings",vertical:"Vertical",horizontal:"Horizontal",hidden:"Hidden",save:"Save",cancel:"Cancel",mainView:"Main view",item:"item",items:"items",showNbItems:"Showing {{x}} items out of {{y}}",showOneItem:"Show 1 item",showNoItem:"No item",showAll:"Show all items",views:"Views",viewGrid:"Grid",viewTreeGrid:"Tree grid",viewThumbnails:"Thumbnails",loading:"Loading..."},values:{},columnVisibilityChange:null,slidersChange:null,splitters:{vertical:null,horizontal:null},views:{},selectedView:null,selectedLang:null,fromView:null,name:null,grid:{}},pageIndex:0,showFilter:false,gridRendered:false,resizing:true,init:false,itemSelected:null,variantColumnsProperties:{visible:true,width:true,showFilter:true},variantInspectorsProperties:{hide:true,vertical:true},_create:function(){var c=this,d=c.options;c.element.addClass("nos-appdesk");c.connector=c.element.closest(".nos-connector");if(!c.connector.size()){c.connector=c.element}c.uiHeaderBar=a("<div></div>").addClass("nos-appdesk-headerbar").appendTo(c.element);c.uiAdds=a("<div></div>").addClass("nos-appdesk-adds").appendTo(c.uiHeaderBar);c.uiAddsButton=a('<button type="button"></button>').addClass("primary").appendTo(c.uiAdds);c.uiViewsDropDownContainer=a("<div></div>").addClass("nos-appdesk-dropdownviews").appendTo(c.uiHeaderBar);c.uiLangsDropDownContainer=a("<div></div>").addClass("nos-appdesk-dropdownlang").appendTo(c.uiHeaderBar);c.uiSplitterVertical=a("<div></div>").addClass("nos-appdesk-splitter-v").appendTo(c.element);c.uiSplitterVerticalRight=a("<div></div>").appendTo(c.uiSplitterVertical);c.uiInspectorsVertical=a("<ul></ul>").addClass("nos-appdesk-inspectors nos-appdesk-inspectors-v").appendTo(c.uiSplitterVerticalRight);c.uiSplitterVerticalLeft=a("<div></div>").appendTo(c.uiSplitterVertical);c.uiSplitterHorizontal=a("<div></div>").appendTo(c.uiSplitterVerticalLeft);c.uiSplitterHorizontalTop=a("<div></div>").appendTo(c.uiSplitterHorizontal);c.uiInspectorsHorizontal=a("<ul></ul>").addClass("nos-appdesk-inspectors nos-appdesk-inspectors-h").appendTo(c.uiSplitterHorizontalTop);c.uiSplitterHorizontalBottom=a("<div></div>").appendTo(c.uiSplitterHorizontal);c.uiSearchBar=a("<div><form><div></div></form></div>").addClass("nos-appdesk-searchbar-container wijmo-wijgrid ui-widget ui-widget-header ui-state-default").appendTo(c.uiSplitterHorizontalBottom).find("form").addClass("wijmo-wijgrid-headerrow wijmo-wijgrid-innercell").find("div").addClass("nos-appdesk-searchbar wijmo-wijgrid-headertext");c.uiNbResult=a("<div></div>").addClass("nos-appdesk-nbresult").appendTo(c.uiSearchBar);c.uiInputContainer=a("<div></div>").addClass("nos-appdesk-input-container ui-widget-content ui-corner-all").appendTo(c.uiSearchBar);c.uiViewsButtons=a("<div></div>").addClass("nos-appdesk-views-button").appendTo(c.uiSearchBar);c.uiSearchIcon=a("<div></div>").addClass("nos-appdesk-search-icon ui-icon ui-icon-search").appendTo(c.uiInputContainer);c.uiSearchInput=a('<input type="search" name="search" placeholder="Search" value="" />').addClass("nos-appdesk-search-input ui-helper-reset").appendTo(c.uiInputContainer);c.uiInspectorsTags=a("<div></div>").addClass("nos-appdesk-inspectorstags").appendTo(c.uiInputContainer);c.uiResetSearch=a('<a href="#"></a>').text(d.texts.showAll).addClass("nos-appdesk-reset-search").appendTo(c.uiInputContainer);c.uiuiResetSearchIcon=a("<span></span>").text(d.texts.showAll).addClass("ui-icon").appendTo(c.uiResetSearch);c.uiGridTitle=a("<div></div>").addClass("nos-appdesk-title").appendTo(c.uiSearchBar);c.uiPaginationLabel=a("<span></span>").addClass("nos-appdesk-pagination");c.uiGrid=a("<table></table>").appendTo(c.uiSplitterHorizontalBottom);c.uiTreeGrid=a("<table></table>").appendTo(c.uiSplitterHorizontalBottom);c.uiThumbnail=a("<div></div>").appendTo(c.uiSplitterHorizontalBottom)},_init:function(){var c=this,d=c.options;if(!a.isPlainObject(d.thumbnails)){d.thumbnails=false}else{d.thumbnails=a.extend({thumbnailSize:128},d.thumbnails)}c._css()._uiAdds()._uiSplitters()._uiInspectors()._uiSearchBar()._uiList()._uiLangsDropDown()._uiViewsDropDown();c.init=true},_css:function(){var k=this,d=k.options;if(!a("style#inspectorsGrid").length){var f="";for(var i=0,e=document.styleSheets.length;i<e;i++){var g=document.styleSheets[i];if(g.href&&/wijmo/.test(g.href)){var h=g.rules?g.rules:g.cssRules;for(var c=0,j=h.length;c<j;c++){if(h[c].selectorText===".ui-widget-content"){f+=".nos-appdesk .nos-appdesk-splitter-v .wijmo-wijsplitter-v-panel2 .wijmo-wijsplitter-h-panel1 .wijmo-wijgrid-alternatingrow {background:"+h[c].style.background+";}";f+=".nos-appdesk .nos-appdesk-splitter-v .wijmo-wijsplitter-v-panel1 .wijmo-wijgrid-alternatingrow {background:"+h[c].style.background+";}"}if(h[c].selectorText===".wijmo-wijgrid tr.wijmo-wijgrid-row.ui-state-hover, .wijmo-wijgrid .wijmo-wijgrid-current-cell, .wijmo-wijgrid td.wijmo-wijgrid-rowheader.ui-state-active"){f+=".nos-appdesk .nos-appdesk-splitter-v .wijmo-wijsplitter-v-panel2 .wijmo-wijsplitter-h-panel1 .wijmo-wijgrid-alternatingrow.ui-state-hover {background:"+h[c].style.background+";}";f+=".nos-appdesk .nos-appdesk-splitter-v .wijmo-wijsplitter-v-panel1 .wijmo-wijgrid-alternatingrow.ui-state-hover {background:"+h[c].style.background+";}"}}}}a('<style type="text/css" id="inspectorsGrid">'+f+"</style>").appendTo("head")}return k},_uiAdds:function(){var c=this,e=c.options;if(!a.isArray(e.adds)||!e.adds.length){c.uiAdds.hide();return c}var d=e.adds.shift();c.uiAddsButton.button({label:d.label,icons:{primary:"ui-icon ui-icon-plus",secondary:null}}).click(function(f){f.preventDefault();f.stopImmediatePropagation();if(a.isFunction(d.action)){d.action()}else{a.nos.tabs.add({iframe:true,url:d.url,label:d.label})}});a.each(e.adds,function(f,g){a('<a href="#"></a>').addClass("nos-appdesk-action-secondary").text(this.label).appendTo(c.uiAdds).click(function(h){h.preventDefault();h.stopImmediatePropagation();if(a.isFunction(g.action)){g.action.apply(this)}else{a.nos.tabs.add({iframe:true,url:g.url,label:g.label})}})});return c},_uiLangsDropDown:function(){var c=this,d=c.options;if(a.isEmptyObject(d.locales)){return c}c.uiLangsDropDown=a("<select></select>").appendTo(c.uiLangsDropDownContainer);c.uiLangsDropDown.append(a("<option></option>").attr({value:"",selected:(!d.selectedLang)}).append(d.texts.allLanguages));a.each(d.locales,function(f,e){c.uiLangsDropDown.append(a("<option></option>").attr({value:f,selected:(d.selectedLang==f)}).append(e))});c.uiLangsDropDown.wijdropdown();c.uiLangsDropDown.change(function(){var e=a(this);d.selectedLang=e.val();a.nos.saveUserConfiguration(d.name+".selectedLang",d.selectedLang);c.gridReload();c.connector.data("nosLang",d.selectedLang).trigger("langChange")});return c},_uiViewsDropDown:function(){var c=this,d=c.options;if(d.views[d.selectedView]&&d.views[d.selectedView].virtual){return c}c.uiViewsDropDown=a("<select></select>").appendTo(c.uiViewsDropDownContainer);a.each(d.views,function(f,e){if(e.virtual){return}c.uiViewsDropDown.append(a("<option></option>").attr({value:f,selected:(d.selectedView==f)}).append(e.name))});c.uiViewsDropDown.append(a("<option></option>").attr({value:"custom",selected:(d.selectedView=="custom")}).append("Custom view"));c.uiViewsDropDown.append(a("<option></option>").attr("value","edit_custom").append("Edit custom view"));c.uiViewsDropDown.wijdropdown();c.uiViewsDropDown.change(function(){if(a(this).val()=="edit_custom"){var e=c._uiCustomViewDialog();c.uiCustomViewDialog=a.nos.dialog({title:d.texts.settings,contentUrl:null,content:e,onLoad:function(){e.css({height:"90%"});e.wijtabs({alignment:"left",scrollable:true,show:function(g,f){a(f.panel).find(".superpanel").wijsuperpanel({autoRefresh:true,hScroller:{scrollMode:"buttons"}});var h=a(f.panel).find("#layout_settings");c._uiCustomViewDialogRefreshLayout(h);h.find(".panels").sortable({connectWith:".panels",update:function(){c._uiCustomViewDialogRefreshLayout(h)},change:function(){c._uiCustomViewDialogRefreshLayout(h)},start:function(i,j){a(j.item).addClass("moving");c._uiCustomViewDialogRefreshLayout(h)},stop:function(i,j){a(j.item).removeClass("moving");c._uiCustomViewDialogRefreshLayout(h)},placeholder:"droping"});c._uiCustomViewDialogRefreshColumns(a(f.panel).find(".columns-settings"))}});e.after(a("<div></div>").css({textAlign:"right"}).append(a("<button />").button({label:d.texts.cancel,icons:{primary:"ui-icon-gear"}}).click(function(){c.uiCustomViewDialog.wijdialog("close");c.uiCustomViewDialog.remove()})).append(a("<button />").button({label:d.texts.save,icons:{primary:"ui-icon-gear"}}).click(function(){c._uiCustomViewDialogSave();c.uiCustomViewDialog.wijdialog("close");c.uiCustomViewDialog.remove()})))}});a(this).find("option").attr("selected","");a(this).find("option[value=custom]").attr("selected","selected");a(this).wijdropdown("refresh");a.nos.saveUserConfiguration(d.name+".selectedView",a(this).val())}else{a.nos.saveUserConfiguration(d.name+".selectedView",a(this).val());c.element.trigger("reloadView",{selectedView:a(this).val()})}});return c},_uiCustomViewDialog:function(){var c=this,e=c.options,d=a("<div><ul></ul></div>");c._uiCustomViewDialogAddLayoutTab(d);c._uiCustomViewDialogAddMainViewTab(d);c._uiCustomViewDialogAddInspectorsTab(d);return d},_uiCustomViewDialogAddMainViewTab:function(d){var c=this,e=c.options;c._uiCustomViewDialogAddItem(d,e.texts.mainView,c._uiCustomViewDialogGetWidgetContentSettings("settings-main-view",e.texts.mainView,c.options));d.find(" > ul > li:last").addClass("separator")},_uiCustomViewDialogAddInspectorsTab:function(e){var c=this,f=c.options;for(var d=0;d<f.inspectors.length;d++){c._uiCustomViewDialogAddItem(e,f.inspectors[d].label,c._uiCustomViewDialogGetWidgetContentSettings("settings-inspector-"+d,f.inspectors[d].label,f.inspectors[d]))}},_uiCustomViewDialogGetWidgetContentSettings:function(c,j,e){var m=this,d=m.options;var g=a('<div class="content-settings columns-settings"></div>').attr({id:c});g.append(a("<h1></h1>").append(j));if(e.grid){g.append(a("<h2></h2>").append("Columns"));var k=a('<ul class="widget-columns"></ul>');var f=e.grid.columns;var h;for(h=0;h<f.length;h++){if(f[h].visible!==false){k.append(a('<li style="float: left;"></li>').data("column-id",h).append(a('<div class="title-zone"></div>').append(f[h].headerText)))}}g.append(k);g.append(a("<h2></h2>").append("Invisible columns"));var l=a('<ul class="not-columns widget-columns"></ul>');for(h=0;h<f.length;h++){if(f[h].visible===false){l.append(a('<li style="float: left;"></li>').data("column-id",h).append(a('<div class="title-zone"></div>').append(f[h].headerText)))}}g.append(l);g.find(".widget-columns").sortable({placeholder:"placeholder",connectWith:".widget-columns",update:function(){m._uiCustomViewDialogRefreshColumns(a(this).parent())},change:function(){m._uiCustomViewDialogRefreshColumns(a(this).parent())},start:function(i,n){a(n.item).addClass("moving");m._uiCustomViewDialogRefreshColumns(a(this).parent())},stop:function(i,n){a(n.item).removeClass("moving");m._uiCustomViewDialogRefreshColumns(a(this).parent())}})}return g},_uiCustomViewDialogRefreshColumns:function(c){var d=c.find("ul");d.each(function(){var e=a(this).find("li").not(".moving");e.removeClass("last");e.last().addClass("last");e.css({width:(a(this).width()/e.length)-1})})},_uiCustomViewDialogAddLayoutTab:function(p){var n=this,f=n.options;var c=a('<form id="layout_settings"></form>');c.append(a("<h1></h1>").append("Layout"));c.append(a('<div class="layout"></div>').append(a('<ul class="left-panel panels"></ul>')).append(a('<div class="right-side"></div>').append(a('<div class="inside"></div>').append(a('<ul class="top-panel panels"></ul>')).append(a('<div class="content"></div>')))));var d=a('<div class="not-layout superpanel"></div>').append('<ul class="invisible-panel panels"></ul>');n._uiCustomViewDialogAddItem(p,"Layout",c);var e=c.find(".left-panel");var g=c.find(".top-panel");var m=d.find(".invisible-panel");c.find(".not-layout").wijsuperpanel({hScroller:{scrollMode:"buttons"}});for(var l=0;l<f.inspectors.length;l++){var h=!f.inspectors[l].hide;var j=f.inspectors[l].vertical;var k=a('<li class="layout-inspector"></li>').data("inspector-id",l).append(a("<div></div>").append(f.inspectors[l].label));if(h){if(j){e.append(k)}else{g.append(k)}}else{m.append(k)}}c.append(d);n._uiCustomViewDialogRefreshLayout(c)},_uiCustomViewDialogRefreshLayout:function(i){var e=i.find(".left-panel"),d=i.find(".top-panel"),c=i.find(".invisible-panel"),g=e.find("li").not(".moving");g.css({height:(e.height()-g.length)/g.length,width:""});g.removeClass("last");a(g[g.length-1]).addClass("last");var h=d.find("li").not(".moving");h.css({width:(d.width()-h.length)/h.length,height:""});h.removeClass("last");a(h[h.length-1]).addClass("last");var f=c.find("li").not(".moving");f.css({width:"",height:""});f.removeClass("last");a(f[f.length-1]).addClass("last");c.css({width:Math.max((f.length+1)*(f.width()+1),100)})},_uiCustomViewDialogSave:function(){var c=this,i=c.options;for(var d=0;d<i.inspectors.length;d++){if(i.inspectors[d].grid){var h=i.inspectors[d].grid.columns;var k=[];i.inspectors[d].grid.columnsOrder=[];c.uiCustomViewDialog.find("#settings-inspector-"+d+" > ul li").each(function(j,l){var n=a(this);var m=h[n.data("column-id")];m.visible=!n.closest("ul").hasClass("not-columns");k.push(m);i.inspectors[d].grid.columnsOrder.push(m.setupkey)});i.inspectors[d].grid.columns=k}}i.inspectorsOrder=[];var g=[];var f=c.uiCustomViewDialog.find("#layout_settings");f.find(".layout-inspector").each(function(){var j=c.options.inspectors[a(this).data("inspector-id")];var l=a(this).closest(".panels");j.hide=l.hasClass("invisible-panel");j.vertical=l.hasClass("left-panel");g.push(j);i.inspectorsOrder.push(j.setupkey)});c.options.inspectors=g;k=[];i.grid.columnsOrder=[];c.uiCustomViewDialog.find("#settings-main-view > ul li").each(function(j,l){var n=a(this),m=i.grid.columns[n.data("column-id")];i.grid.columnsOrder.push(m.setupkey);m.visible=!n.closest("ul").hasClass("not-columns");k.push(m)});c.options.grid.columns=k;c.element.find(".nos-appdesk-inspector").remove();var e=c._saveUserConfiguration();c.element.trigger("reloadView",{selectedView:"custom",custom:e})},_uiCustomViewDialogAddItem:function(c,e,d){if(typeof this.idMenu=="undefined"){this.idMenu=0}c.find("> ul").append('<li><a href="#settings_menu_popup_item_'+this.idMenu+'">'+e+"</a></li>");c.append(a('<div id="settings_menu_popup_item_'+this.idMenu+'"></div>').append(d));this.idMenu++},_saveUserConfiguration:function(){var c=this,e=c.options,d={from:e.selectedView!="custom"?e.selectedView:e.fromView,appdesk:c._getInspectorsConfiguration(e)};d.appdesk.grid=c._getGridConfiguration(e.grid);a.nos.saveUserConfiguration(e.name,{selectedView:"custom",custom:d});return d},_getGridConfiguration:function(e){var d={columns:{},columnsOrder:e.columnsOrder.join(",")};var f=this._getParameters(e.columns,this.variantColumnsProperties);for(var c=0;c<e.columns.length;c++){d.columns[e.columns[c].setupkey]=f[c]}return d},_getInspectorsConfiguration:function(c){var f={inspectors:{},inspectorsOrder:c.inspectorsOrder.join(",")};var e=this._getParameters(c.inspectors,this.variantInspectorsProperties);for(var d=0;d<this.options.inspectors.length;d++){if(!e[d]["vertical"]){e[d]["vertical"]=false}f.inspectors[c.inspectors[d].setupkey]=e[d];if(this.options.inspectors[d]["grid"]){f.inspectors[c.inspectors[d].setupkey]["grid"]=this._getGridConfiguration(this.options.inspectors[d]["grid"])}}return f},_getParameters:function(h,g){var c=[];for(var f=0;f<h.length;f++){var e={};for(var d in h[f]){if(g[d]){e[d]=h[f][d]}}c.push(e)}return c},_uiSplitters:function(){var e=this,g=function(){e.uiSplitterHorizontal.wijsplitter("refresh");e._resizeInspectorsV(true)._resizeInspectorsH(true)._resizeList(true)},c=function(){e._resizeInspectorsH(true)._resizeList(true)},f=a.extend(true,{orientation:"vertical",splitterDistance:200,showExpander:false,fullSplit:false,panel1:{minSize:150,scrollBars:"none"},panel2:{minSize:200,scrollBars:"none"},expanded:function(){g()},collapsed:function(){g()},sized:function(){e.resizing=true;g()}},e.options.splitters.vertical),d=a.extend(true,{orientation:"horizontal",fullSplit:true,splitterDistance:200,showExpander:false,panel1:{minSize:200,scrollBars:"none"},panel2:{minSize:200,scrollBars:"none"},expanded:function(){c()},collapsed:function(){c()},sized:function(){e.resizing=true;c()}},e.options.splitters.horizontal);e.uiSplitterVertical.wijsplitter(f).find(".ui-resizable-handle").mousedown(function(){e.resizing=false});e.uiSplitterHorizontal.wijsplitter(d).find(".ui-resizable-handle").mousedown(function(){e.resizing=false});return e},_uiInspectors:function(){var c=this,d=c.options;a.each(d.inspectors,function(){if(!this.hide){a("<li></li>").addClass("nos-appdesk-inspector ui-widget-content").data("inspector",this).appendTo(this.vertical?c.uiInspectorsVertical:c.uiInspectorsHorizontal)}});c._resizeInspectorsV(true)._resizeInspectorsH(true);c.uiInspectorsVertical.find("> li").add(c.uiInspectorsHorizontal.find("> li")).each(function(){c._loadInspector(a(this))});return c},_loadInspector:function(f){var c=this,e=f.data("inspector"),d=c.options;e.selectionChanged=function(k,i){var g=false,h=e.inputName;if(e.inputName.substr(-2,2)==="[]"){h=e.inputName.substr(0,e.inputName.length-2);g=true}if(!g){c.uiInspectorsTags.find("span."+h).remove()}else{var l=false;c.uiInspectorsTags.find("span."+h).each(function(){if(a(this).find("input").val()===k){l=true;return false}});if(l){return true}}c.pageIndex=0;c.uiInspectorsTags.wijsuperpanel("destroy");var j=a("<span></span>").addClass("nos-appdesk-inspectorstag ui-state-default ui-corner-all "+h).text(i).appendTo(c.uiInspectorsTags);a('<input type="hidden" name="'+e.inputName+'" />').val(k).appendTo(j);a('<a href="#"></a>').addClass("ui-icon ui-icon-close").click(function(m){m.preventDefault();a(this).parent().remove();c.gridReload()}).appendTo(j);c.uiInspectorsTags.wijsuperpanel({showRounder:false,hScroller:{scrollMode:"buttons"}});if(d.defaultView==="treeGrid"){c.uiViewsButtons.find("#view_grid").click().blur()}else{c.gridReload()}};f.data("inspector",e);if(a.isFunction(e.url)){e.url.call(c,f)}else{a.ajax({url:e.url,dataType:"html"}).done(function(g){a(g).appendTo(f)}).fail(function(g,i,h){log("error");log(i);log(h)})}return c},_uiSearchBar:function(){var d=this,e=d.options;d.uiResetSearch.hide();d.uiSearchInput.on("keypress",function(f){var g=a.ui.keyCode;d.pageIndex=0;if(d.timeoutSearchInput){clearTimeout(d.timeoutSearchInput)}if(a.inArray(f.keyCode,[g.ENTER,g.NUMPAD_ENTER])!=-1){if(e.defaultView==="treeGrid"){d.uiViewsButtons.find("#view_grid").click().blur()}else{d.gridReload()}return false}d.timeoutSearchInput=setTimeout(function(){if(e.defaultView==="treeGrid"){d.uiViewsButtons.find("#view_grid").click().blur()}else{d.gridReload()}},500)});d.uiResetSearch.click(function(f){f.preventDefault();d.uiSearchInput.val("");d.uiInspectorsTags.wijsuperpanel("destroy");d.uiInspectorsTags.empty();d.gridReload()});d.uiInspectorsTags.height(d.uiInputContainer.height()).width(parseInt(d.uiSearchBar.width()*0.3)).wijsuperpanel({showRounder:false,hScroller:{scrollMode:"buttons"}});var c=[{id:"treeGrid",text:e.texts.viewTreeGrid,icon:"view-tree"},{id:"grid",text:e.texts.viewGrid,icon:"view-list"},{id:"thumbnails",size:64,text:e.texts.viewThumbnails,icon:"view-thumbs-small"},{id:"thumbnails",size:128,text:e.texts.viewThumbnails,icon:"view-thumbs-big"}];a.each(c,function(){var f=this;if(e[f.id]){a('<label for="view_'+f.id.toLowerCase()+(f.size?"_"+f.size:"")+'"></label>').text(f.text+(f.size?" "+f.size+"px":"")).appendTo(d.uiViewsButtons);a('<input type="radio" id="view_'+f.id.toLowerCase()+(f.size?"_"+f.size:"")+'" name="view" '+(e.defaultView===f.id&&(!f.size||f.size===e.thumbnails.thumbnailSize)?'checked="checked"':"")+'" />').appendTo(d.uiViewsButtons).button({text:false,label:f.text+(f.size?" "+f.size+"px":""),icons:{primary:"ui-icon "+f.icon,secondary:null}}).click(function(){if(e.defaultView!==f.id||(f.id==="thumbnails"&&e.thumbnails.thumbnailSize!==f.size)){d.uiViewsButtons.find("button").removeClass("ui-state-active");a(this).addClass("ui-state-active");e.defaultView=f.id;if(f.size){e.thumbnails.thumbnailSize=f.size}d._uiList()}})}});if(d.uiViewsButtons.find("input").length>1){d.uiViewsButtons.buttonset()}else{d.uiViewsButtons.hide()}return d},_uiList:function(){var c=this,d=c.options;c.gridRendered=false;c.uiGridTitle.text(d.texts.item);c.uiThumbnail.thumbnailsgrid("destroy").empty().hide();c.uiGrid.noslistgrid("destroy").empty().hide();c.uiTreeGrid.nostreegrid("destroy").empty().hide();if(d.defaultView==="thumbnails"){c.uiThumbnail.show();c._uiThumbnail()}else{if(d.defaultView==="treeGrid"){c.uiTreeGrid.show();c._uiTreeGrid()}else{c.uiGrid.show();c._uiGrid()}}return c},_uiGrid:function(){var e=this,h=e.options,d=e.uiGrid.offset(),f=e.element.offset(),c=e.element.height()-d.top+f.top,g=a.nos.grid.getHeights();e.uiGrid.css({height:c,width:"100%"}).noslistgrid(a.extend({columnsAutogenerationMode:"none",selectionMode:"singleRow",showFilter:e.showFilter,allowSorting:true,scrollMode:"auto",allowPaging:true,pageIndex:e.pageIndex,pageSize:Math.floor((c-g.footer-g.header-(e.showFilter?g.filter:0))/g.row),allowColSizing:true,allowColMoving:true,data:new wijdatasource({dynamic:true,proxy:new wijhttpproxy({url:h.grid.proxyUrl,dataType:"json",error:function(i,k,j){log(i,k,j)},data:{}}),loading:function(k,i){var j=i.data.paging;e.pageIndex=j.pageIndex;if(e.gridRendered){e.uiGrid.noslistgrid("currentCell",-1,-1)}k.proxy.options.data.lang=h.selectedLang||"";k.proxy.options.data.inspectors=e._jsonInspectors();k.proxy.options.data.offset=j.pageIndex*j.pageSize;k.proxy.options.data.limit=j.pageSize},loaded:function(j,i){if(j.data.totalRows===0){e.uiPaginationLabel.text(h.texts.showNoItem);e.uiNbResult.text(h.texts.showNoItem)}else{if(j.data.totalRows===1){e.uiPaginationLabel.text(h.texts.showOneItem);e.uiNbResult.text("1 "+h.texts.item)}else{e.uiPaginationLabel.text(h.texts.showNbItems.replace("{{x}}",j.data.length).replace("{{y}}",j.data.totalRows));e.uiNbResult.text(j.data.totalRows+" "+h.texts.items)}}e.uiNbResult.show();e.uiResetSearch[e.uiInspectorsTags.find(".nos-appdesk-inspectorstag").length||e.uiSearchInput.val()?"show":"hide"]()},reader:{read:function(j){var i=parseInt(j.data.total,10);j.data=j.data.items;j.data.totalRows=i}}}),pageIndexChanging:function(){e.element.trigger("selectionChanged.appdesk",false)},cellStyleFormatter:function(i){if(i.$cell.is("th")){i.$cell.removeClass("ui-state-active")}if(i.state&a.wijmo.wijgrid.renderState.selected&&i.$cell.hasClass("ui-state-default")){i.$cell.removeClass("ui-state-highlight")}if(i.state&a.wijmo.wijgrid.renderState.selected){i.$cell.removeClass("wijmo-wijgrid-current-cell")}},currentCellChanging:function(){return e.gridRendered},currentCellChanged:function(j){if(j){var k=a(j.target).noslistgrid("currentCell").row(),i=k?k.data:false;if(i){e.itemSelected=a.extend({},i);e.element.trigger("selectionChanged.appdesk",i)}}return true},rendering:function(){e.gridRendered=false},rendered:function(){e.gridRendered=true;e.uiGrid.css("height","auto");var i=e.uiGrid.noslistgrid("selection");i&&i.clear();if(e.itemSelected!==null){a.each(e.uiGrid.noslistgrid("data")||[],function(j,k){if(k._model==e.itemSelected._model&&k._id==e.itemSelected._id){i.addRows(j)}})}},dataLoading:function(i){e.uiPaginationLabel.detach()},loaded:function(){e.uiSplitterHorizontalBottom.find(".wijmo-wijgrid-footer").prepend(e.uiPaginationLabel)}},h.grid));return e},_uiTreeGrid:function(){var e=this,g=e.options,d=e.uiTreeGrid.offset(),f=e.element.offset(),c=e.element.height()-d.top+f.top;e.uiTreeGrid.css({height:c,width:"100%"}).nostreegrid(a.extend(true,{treeUrl:g.treeGrid.proxyUrl,treeOptions:{lang:g.selectedLang||""},columnsAutogenerationMode:"none",selectionMode:"singleRow",allowSorting:true,scrollMode:"auto",allowColSizing:true,allowColMoving:true,sorting:function(i,h){a.each(g.grid.columns,function(){var j=this;if(j.headerText===h.column.headerText){j.sortDirection=h.sortDirection}else{j.sortDirection="none"}});e.uiViewsButtons.find("#view_grid").click().blur();return false},cellStyleFormatter:function(h){if(h.$cell.is("th")){h.$cell.removeClass("ui-state-active")}if(h.state&a.wijmo.wijgrid.renderState.selected&&h.$cell.hasClass("ui-state-default")){h.$cell.removeClass("ui-state-highlight")}if(h.state&a.wijmo.wijgrid.renderState.selected){h.$cell.removeClass("wijmo-wijgrid-current-cell")}},currentCellChanging:function(){return e.gridRendered},currentCellChanged:function(i){if(i){var j=a(i.target).nostreegrid("currentCell").row(),h=j?j.data:false;if(h){e.itemSelected=a.extend({},h);e.element.trigger("selectionChanged.appdesk",h)}}return true},rendering:function(){e.gridRendered=false},rendered:function(){e.gridRendered=true;e.uiTreeGrid.css("height","auto");var h=e.uiTreeGrid.nostreegrid("selection");h&&h.clear();if(e.itemSelected!==null){a.each(e.uiTreeGrid.nostreegrid("data")||[],function(i,j){if(j._model==e.itemSelected._model&&j._id==e.itemSelected._id){h.addRows(i)}})}},dataLoading:function(h){e.uiPaginationLabel.detach()},loaded:function(){e.uiSplitterHorizontalBottom.find(".wijmo-wijgrid-footer").prepend(e.uiPaginationLabel)}},g.grid));return e},_uiThumbnail:function(){var e=this,g=e.options,d=e.uiThumbnail.offset(),f=e.element.offset(),c=e.element.height()-d.top+f.top;e.uiThumbnail.css("height",c).thumbnailsgrid(a.extend({pageIndex:0,url:g.grid.proxyUrl,loading:function(j,h){var i=h.data.paging;e.pageIndex=i.pageIndex;j.proxy.options.data.lang=g.selectedLang||"";j.proxy.options.data.inspectors=e._jsonInspectors();j.proxy.options.data.offset=i.pageIndex*i.pageSize;j.proxy.options.data.limit=i.pageSize},loaded:function(i,h){if(i.data.totalRows===0){e.uiPaginationLabel.text(g.texts.showNoItem);e.uiNbResult.text(g.texts.showNoItem)}else{if(i.data.totalRows===1){e.uiPaginationLabel.text(g.texts.showOneItem);e.uiNbResult.text("1 "+g.texts.item)}else{e.uiPaginationLabel.text(g.texts.showNbItems.replace("{{x}}",i.data.length).replace("{{y}}",i.data.totalRows));e.uiNbResult.text(i.data.totalRows+" "+g.texts.items)}}e.uiNbResult.show();e.uiResetSearch[e.uiInspectorsTags.find(".nos-appdesk-inspectorstag").length||e.uiSearchInput.val()?"show":"hide"]()},rendered:function(){e.uiSplitterHorizontalBottom.find(".wijmo-wijpager").prepend(e.uiPaginationLabel);if(e.itemSelected!==null){var h=false;a.each(e.uiThumbnail.thumbnailsgrid("data")||[],function(i,j){if(j._model==e.itemSelected._model&&j._id==e.itemSelected._id){h=true;if(!e.uiThumbnail.thumbnailsgrid("select",i)){e.itemSelected=null}}});if(!h){e.uiThumbnail.thumbnailsgrid("unselect")}}},reader:{read:function(i){var h=parseInt(i.data.total,10);i.data=i.data.items;i.data.totalRows=h}},pageIndexChanging:function(){e.itemSelected=null;e.element.trigger("selectionChanged.appdesk",false)},selectionChanged:function(i,h){if(!h||a.isEmptyObject(h)){e.itemSelected=null;e.element.trigger("selectionChanged.appdesk",false)}else{e.itemSelected=a.extend({},h.item.data.noParseData);e.element.trigger("selectionChanged.appdesk",h.item.data.noParseData)}}},g.thumbnails));return e},_jsonInspectors:function(){var c=this,d=a.extend({},this.options.values||{});c.uiInspectorsTags.find("input").add(c.uiSearchInput).each(function(){var f=a(this),g=f.attr("name"),e=false;if(g.substr(-2,2)==="[]"){g=g.substr(0,g.length-2);e=true}if(!e){d[g]=f.val()}else{if(!a.isArray(d[g])){d[g]=[];d[g].push(f.val())}else{if(-1==a.inArray(f.val(),d[g])){d[g].push(f.val())}}}});return d},_resizeInspectorsV:function(d){var c=this;if(c.resizing){var e=c.uiInspectorsVertical.find(".wijmo-wijsplitter-v-bar").css({width:null,borderRightWidth:null}).end().find("> li").css({width:"100%",height:"auto"});if(e.length){e.css("height",(c.uiInspectorsVertical.height()/e.length)+"px").trigger(d?"widgetReload":"widgetResize")}else{c._hideSplitterV()}}return c},_resizeInspectorsH:function(d){var c=this;if(c.resizing){var e=c.uiInspectorsHorizontal.find(".wijmo-wijsplitter-h-bar").css({height:null,borderTopWidth:null}).end().find("> li").css({width:"auto",height:"100%"});if(e.length){e.css("width",(c.uiInspectorsHorizontal.width()/e.length)+"px").trigger(d?"widgetReload":"widgetResize")}else{c._hideSplitterH()}}c.uiSplitterVertical.wijsplitter("option","splitterDistance");c._trigger("slidersChange",null,c.slidersSettings());return c},_resizeList:function(e){var d=this,g=d.options;if(d.init){var c=d.uiSplitterHorizontalBottom.height()-d.uiSearchBar.outerHeight(true);if(g.defaultView==="thumbnails"){if(e){d._uiList()}else{d.uiThumbnail.thumbnailsgrid("setSize",d.uiSplitterHorizontalBottom.width(),c)}}else{if(g.defaultView==="treeGrid"){if(e){d._uiList()}else{d.uiTreeGrid.nostreegrid("setSize",null,c)}}else{d.uiGrid.noslistgrid("setSize",null,c);if(e){var f=a.nos.grid.getHeights();d.uiGrid.noslistgrid("option","pageSize",Math.floor((c-f.footer-f.header-(d.showFilter?f.filter:0))/f.row))}}}}return d},_hideSplitterV:function(){var c=this;c.uiSplitterVertical.find(".wijmo-wijsplitter-v-bar").css({width:"0px",borderRightWidth:"0px"}).end().wijsplitter("option","panel1",{collapsed:true}).wijsplitter("refresh",true,false);return c},_hideSplitterH:function(){var c=this;c.uiSplitterHorizontal.find(".wijmo-wijsplitter-h-bar").css({height:"0px",borderTopWidth:"0px"}).end().wijsplitter("option","panel1",{collapsed:true}).wijsplitter("refresh",true,false);return c},gridReload:function(){var c=this,d=c.options;if(c.init){if(d.defaultView==="thumbnails"){c._uiList()}else{if(d.defaultView==="treeGrid"){c._uiList()}else{c.uiGrid.noslistgrid("ensureControl",true)}}}return c},resize:function(){var c=this,d=c.options;c.uiSplitterVertical.wijsplitter("refresh",true,false);c.uiSplitterHorizontal.wijsplitter("refresh",true,false);c._resizeInspectorsV()._resizeInspectorsH()._resizeList();return c},slidersSettings:function(){return{vertical:{splitterDistance:this.uiSplitterVertical.wijsplitter("option","splitterDistance")/a(window).width()},horizontal:{splitterDistance:this.uiSplitterHorizontal.wijsplitter("option","splitterDistance")/a(window).height()}}}});a.extend(a.nos,{appdeskAdd:function(g,e){var d=this;var f=false;var c="";if(e.selectedView=="custom"){if(e.custom){c=e.views[e.custom.from].json;f=true}else{e.selectedView="default"}}if(e.selectedView!="custom"){c=e.views[e.selectedView].json}require(c,function(){var j=a.nos.appdeskSetup();a.extend(true,j.i18nMessages,e.i18n);for(var k=0;k<arguments.length;k++){a.extend(true,j,arguments[k](j))}a.extend(true,j.appdesk,{locales:e.locales,views:e.views,name:e.configuration_id,selectedView:e.selectedView,selectedLang:e.selectedLang});if(f){a.extend(true,j.appdesk,{fromView:e.custom.from},e.custom.appdesk)}var l,o=a("div#"+g),h=o.closest(".nos-connector"),n=j.build();if(a.isPlainObject(n.tab)&&!a.isEmptyObject(n.tab)){try{a.nos.tabs.update(o,n.tab)}catch(m){log("Could not update current tab. Maybe your config file should not try to update it.")}}o.removeAttr("id").appdesk(n.appdesk);h.on({resizePanel:function(){if(l){window.clearTimeout(l)}l=window.setTimeout(function(){o.appdesk("resize")},200)},showPanel:function(){o.appdesk("resize")}});if(n.reload){h.on("reload."+n.reload,function(){o.appdesk("gridReload")})}o.bind("reloadView",function(q,p){a.extend(e,p);var i=a('<div id="'+g+'"></div>');i.insertAfter(o);o.remove();d.appdeskAdd(g,e)})})},appdeskSetup:function(){var e={};var d=function(h,g){h.setupkey=g;return h},c=function(h,k){if(h[k+"Order"]){var l=h[k+"Order"].split(",");var g=[];for(var j=0;j<l.length;j++){if(h[k][l[j]]!=null){h[k][l[j]]["setupkey"]=l[j];g.push(h[k][l[j]])}}return g}else{return a.map(h[k],d)}},f=function(g){a.each(g,function(k,n){if(a.isPlainObject(n)){if(a.isFunction(n._)){g[k]=n._()}else{f(n)}}else{if(a.isArray(n)){f(n)}}if(k==="columns"){g[k]=c(g,k);for(var j=0;j<g[k].length;j++){if(g[k][j].lang){g[k][j]={headerText:"Languages",dataKey:"lang",setupkey:"lang",showFilter:false,cellFormatter:function(i){if(i.row.type&a.wijmo.wijgrid.rowType.data){i.$container.css("text-align","center").html(i.row.data.lang);return true}},width:1}}if(g[k][j].actions){var m=g[k][j].actions;var l;var h=g[k][j].showOnlyArrow?true:false;if(h){l=20}else{l=a.nos.grid.getActionWidth(m);if(m.length>1){}}g[k][j]={headerText:h?"":"",cellFormatter:function(i){if(a.isPlainObject(i.row.data)){var o=a.nos.appdeskActions(m,i.row.data,{showOnlyArrow:h});o.appendTo(i.$container);i.$container.parent().addClass("buttontd").css({width:l+1});return true}},allowSizing:false,allowSort:false,width:l,ensurePxWidth:true,showFilter:false,setupkey:"actions"}}}}})},e={tab:null,appdesk:{adds:{},grid:{proxyUrl:"",columns:{}},thumbnails:null,defaultView:"grid",inspectors:{},splittersVertical:null,splittersHorizontal:null},i18nMessages:{},i18n:function(h){var i={};var g=this;a.extend(i,{label:h,_:function(){return g.i18nMessages[i.label]||i.label}});return i},build:function(){var j=a.extend(true,{appdesk:{texts:this.i18nMessages,splitters:{},slidersChange:function(i,k){}}},this);if(j.appdesk.splittersVertical){j.appdesk.splitters.vertical={splitterDistance:j.appdesk.splittersVertical}}if(j.appdesk.splittersHorizontal){j.appdesk.splitters.horizontal={splitterDistance:j.appdesk.splittersHorizontal}}j.appdesk.adds=a.map(j.appdesk.adds,d);j.appdesk.inspectors=c(j.appdesk,"inspectors");if(j.actions){var g=j.actions;if(j.appdesk.grid.columns.actions&&j.appdesk.grid.columns.actions.actions){a.each(j.appdesk.grid.columns.actions.actions,function(k,l){if(a.type(l)=="string"){j.appdesk.grid.columns.actions.actions[k]=g[l]}})}if(j.appdesk.thumbnails&&j.appdesk.thumbnails.actions){a.each(j.appdesk.thumbnails.actions,function(k,l){if(a.type(l)=="string"){j.appdesk.thumbnails.actions[k]=g[l]}})}a.each(j.appdesk.inspectors,function(k,l){if(l.preview&&l.options.actions){a.each(l.options.actions,function(m,n){if(a.type(n)=="string"){l.options.actions[m]=g[n]}})}})}f(j);for(var h=0;h<j.appdesk.inspectors.length;h++){if(j.appdesk.inspectors[h].preview){j.appdesk.inspectors[h].url=function(l){var i=l.data("inspector"),k=a("<div></div>").appendTo(l).preview(i.options).parent().on({widgetResize:function(){k.preview("resize")}}).end()}}}return j}};return e},appdeskActionsList:[],appdeskActions:function(i,h,f){f=f||{};var c=a("<table><tr></tr></table>").addClass("buttontd wijgridtd");var e=[];var d=[];if(!f.showOnlyArrow){a.each(i,function(){if(this.primary){e.push(this)}else{d.push(this)}});if(d.length==1&&(d[0].icon||d[0].iconClasses)){e.push(d[0])}a.each(e,function(k,m){var j=false;if(m.iconClasses){j=m.iconClasses}else{if(m.icon){j="ui-icon ui-icon-"+m.icon}}var l=a("<th></th>").css("white-space","nowrap").addClass("ui-state-default").attr("title",m.label).html((j?'<span class="'+j+'"></span>':"")+(m.text||!j?"&nbsp;"+m.label+"&nbsp;":""));if(m.name&&h&&h.actions&&h.actions[m.name]==false){l.addClass("ui-state-disabled").click(function(n){n.stopImmediatePropagation();n.preventDefault()})}else{l.click(function(n){n.stopImmediatePropagation();n.preventDefault();m.action.apply(this,[h,l])}).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")})}if(j&&!m.text){l.css({width:20,textAlign:"center"}).children().css({margin:"auto"})}else{if(j&&m.text){l.find("span").css("float","left")}}l.appendTo(c.find("tr"))})}if(f.showOnlyArrow||d.length>=2||(d.length==1&&!(d[0].icon||d[0].iconClasses))){var g=a("<th></th>").addClass("ui-state-default").css({width:"20px"}).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});a("<span></span>").addClass("ui-icon ui-icon-triangle-1-s").appendTo(g);g.appendTo(c.find("tr")).click(function(l){a.each(a.nos.appdeskActionsList,function(){a(this).wijmenu("hideAllMenus")});if(!this.created){var k=a("<ul></ul>");a.each(i,function(o,p){var n;if(p.iconClasses){n=p.iconClasses}else{if(p.icon){n="ui-icon ui-icon-"+p.icon}}var q='<span class="'+(n?n:"nos-icon16 nos-icon16-empty")+' wijmo-wijmenu-icon-left"></span><span class="wijmo-wijmenu-text">'+p.label+"</span>";var m=a('<li><a href="#"></a></li>').appendTo(k).find("a").html(q);if(p.name&&h.actions&&h.actions[p.name]==false){m.addClass("ui-state-disabled").click(function(r){r.stopImmediatePropagation();r.preventDefault()})}else{m.click(function(r){r.stopImmediatePropagation();r.preventDefault();k.wijmenu("hideAllMenus");p.action.apply(this,[h,m])})}});var j=a.nos.$noviusos.ostabs?a.nos.$noviusos.ostabs("current").panel:g.parentsUntil(".ui-widget, body").last();k.appendTo(j);k.wijmenu({trigger:g,triggerEvent:"click",orientation:"vertical",showAnimation:{Animated:"slide",duration:50,easing:null},hideAnimation:{Animated:"hide",duration:0,easing:null},position:{my:"right top",at:"right bottom",collision:"flip",offset:"0 0"}});a.nos.appdeskActionsList.push(k);this.created=true;g.triggerHandler("click")}});g.click(false)}return c},grid:{getHeights:function(){if(this.heights===b){var c=a("<div></div>").appendTo("body");var d=a("<table></table>").addClass("nos-appdesk").appendTo(c).noslistgrid({scrollMode:"auto",showFilter:true,allowPaging:true,data:[["test"]]});this.heights={row:d.height(),footer:c.find(".wijmo-wijgrid-footer").outerHeight(),header:c.find(".wijmo-wijgrid-headerrow").outerHeight(),filter:c.find(".wijmo-wijgrid-filterrow").outerHeight()};d.noslistgrid("destroy");c.remove()}return this.heights},getActionWidth:function(f){var c=a("<div></div>").appendTo("body");var e=a("<table></table>").addClass("nos-appdesk").appendTo(c).noslistgrid({scrollMode:"none",showFilter:true,allowPaging:true,columns:[{headerText:"Actions",cellFormatter:function(g){if(a.isPlainObject(g.row.data)){var h=a.nos.appdeskActions(f,[]);h.appendTo(g.$container);g.$container.parent().addClass("buttontd");return true}},allowSizing:true,showFilter:false,ensurePxWidth:true}],data:[{key:"value"}]});c.find("table.buttontd.wijgridtd").css({"font-size":"1.05em",width:"auto"});var d=c.find(".buttontd .buttontd:first").outerWidth();e.noslistgrid("destroy");c.remove();return d}}});return a});
