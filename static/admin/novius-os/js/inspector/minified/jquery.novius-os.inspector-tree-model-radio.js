/**
 * NOVIUS OS - Web OS for digital communication
 *
 * @copyright  2011 Novius
 * @license    GNU Affero General Public License v3 or (at your option) any later version
 *             http://www.gnu.org/licenses/agpl-3.0.html
 * @link http://www.novius-os.org
 */
define("jquery-nos-inspector-tree-model-radio",["jquery","jquery-nos-treegrid"],function(a){a.fn.extend({nosInspectorTreeModelRadio:function(b){b=b||{};return this.each(function(){var d=a(this).css({height:b.height||"150px",width:b.width||""}),i=d.attr("id"),f=d.find("table"),c=d.closest(".nos-dispatcher, body").on("contextChange",function(){e();if(b.contextChange){f.nostreegrid("option","treeOptions",{context:c.data("nosContext")||""})}}),h=false,e=function(){if(b.reloadEvent){d.nosUnlistenEvent("inspector"+i);var j={name:b.reloadEvent};if(c.data("nosContext")){j.context=c.data("nosContext")}d.nosListenEvent(j,function(){f.nostreegrid("reload")},"inspector"+i)}},g=function(){e();var j=a.extend(true,{},b.treeOptions||{});if(!j.context){j.context=c.data("nosContext")||""}d.find('input[name="'+b.input_name+'"]').remove();f.nostreegrid({sortable:false,movable:false,urlJson:b.urlJson,treeColumnIndex:1,treeOptions:j,preOpen:b.selected||{},columnsAutogenerationMode:"none",scrollMode:"auto",cellStyleFormatter:function(k){if(k.$cell.is("td")){k.$cell.removeClass("ui-state-highlight")}},rowStyleFormatter:function(k){if(k.type==a.wijmo.wijgrid.rowType.header){k.$rows.hide()}},currentCellChanged:function(l){var m=a(l.target).nostreegrid("currentCell").row(),k=m?m.data:false;if(k&&h){b.selected.id=k._id;m.$rows.find(":radio[value="+b.selected.id+"]").prop("checked",true).triggerHandler("click")}},rendering:function(){h=false},rendered:function(){h=true;f.css("height","auto");if(a.isPlainObject(b.selected)&&b.selected.id){var l=d.find(":radio[value="+b.selected.id+"]").prop("checked",true),k=f.data("nostreegrid");k._view()._getSuperPanel().scrollChildIntoView(l)}},columns:b.columns})};b.columns.unshift({allowMoving:false,allowSizing:false,width:35,ensurePxWidth:true,cellFormatter:function(j){if(a.isPlainObject(j.row.data)){a('<input type="radio" />').attr({name:b.input_name,value:j.row.data._id}).click(function(){b.selected={id:j.row.data._id,model:j.row.data._model};a(this).trigger("selectionChanged",j.row.data)}).appendTo(j.$container);return true}}});if(a.isPlainObject(b.selected)&&b.selected.id){a('<input type="hidden" />').attr({name:b.input_name,value:b.selected.id}).appendTo(d)}f.css({height:"100%",width:"100%"});f.nosOnShow("one",g)})}});return a});