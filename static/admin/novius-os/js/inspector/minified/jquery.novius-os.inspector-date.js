/**
 * NOVIUS OS - Web OS for digital communication
 *
 * @copyright  2011 Novius
 * @license    GNU Affero General Public License v3 or (at your option) any later version
 *             http://www.gnu.org/licenses/agpl-3.0.html
 * @link http://www.novius-os.org
 */
define("jquery-nos-inspector-date",["jquery-nos-listgrid","jquery-ui.datepicker"],function(a){a.fn.extend({nosInspectorDate:function(b){b=b||{texts:{labelCustom:"Custom"},content:{}};return this.each(function(){var c=a(this).removeAttr("id").css({display:"inline-block"}).hide(),g=a("<table></table>").insertAfter(c),e=g.parent().bind({widgetResize:function(){c.appendTo(e);g.noslistgrid("setSize",e.width(),e.height())}}),d=e.data("inspector"),f=c.find(":input").datepicker("option","onSelect",function(m){var o=this===c.find(":input:first")[0]?"minDate":"maxDate",i=a(this).data("datepicker"),n=c.find(":input:first").val(),j=c.find(":input:last").val(),l=b.texts.labelCustom;var k=a.datepicker.parseDate(i.settings.dateFormat||a.datepicker._defaults.dateFormat,m,i.settings);f.not(this).datepicker("option",o,k);if(n||j){if(n){l=l.replace("xxxbeginxxx",n)}else{l="Until "+j}if(j){l=l.replace("xxxendxxx",j)}else{l="Since "+n}if(a.isFunction(d.selectionChanged)){d.selectionChanged(n+"|"+j,l)}}}),h=false;g.css({height:"100%",width:"100%"}).noslistgrid({columnsAutogenerationMode:"none",scrollMode:"auto",showGroupArea:false,columns:[{dataKey:"group",groupInfo:{groupSingleRow:false,position:"header",outlineMode:"startCollapsed",headerText:"<b>{0}</b>"},visible:false},{headerText:d.label,cellFormatter:function(i){if(a.isPlainObject(i.row.data)&&i.row.data.value==="custom"){i.$container.css({"white-space":"normal","padding-left":"10px"});a("<span></span>").text(i.row.data.title).css({"white-space":"nowrap","margin-right":"10px"}).appendTo(i.$container);c.appendTo(i.$container);return true}else{i.$container.css("padding-left","30px")}},dataKey:"title"},{visible:false}],data:b.content,currentCellChanged:function(j){var k=a(j.target).noslistgrid("currentCell").row(),i=k?k.data:false;if(i&&h){if(i.value!=="custom"){c.hide()}if(i.value==="custom"){c.show()}else{d.selectionChanged(i.value,i.title)}}g.noslistgrid("currentCell",-1,-1)},rendering:function(){h=false},rendered:function(){h=true;g.css("height","auto")}})})}});return a});