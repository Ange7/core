/**
 * NOVIUS OS - Web OS for digital communication
 *
 * @copyright  2011 Novius
 * @license    GNU Affero General Public License v3 or (at your option) any later version
 *             http://www.gnu.org/licenses/agpl-3.0.html
 * @link http://www.novius-os.org
 */
define("jquery-nos-validate",["jquery","static/novius-os/admin/vendor/jquery/jquery-validation/jquery.validate.min","wijmo.wijtooltip"],function(b){var a=function(f,g){var c=this;if(!c.counter){c.counter=1}var d=this.errorsFor(f);if(d.length){d.removeClass(this.settings.validClass).addClass(this.settings.errorClass);d.closest(".ui-accordion-content").prev().addClass(this.settings.errorClass)}else{d=b("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(f),generated:true}).addClass(this.settings.errorClass).css({background:"transparent",border:"0",padding:"0 4px",verticalAlign:"middle"}).html('<span class="ui-icon ui-icon-alert nos-icon16"></span>');d.wijtooltip({group:"group_"+c.counter++,showCallout:false,calloutFilled:true,closeBehavior:"sticky",position:{my:"right top",at:"center bottom",offset:"0 0"},triggers:"click",content:g,showing:function(k,j){b(j.element).addClass("ui-state-error")}});if(!this.labelContainer.append(d).length){this.settings.errorPlacement?this.settings.errorPlacement(d,b(f)):d.insertAfter(f)}var e=d.data("wijtooltip");e._tooltip.addClass("nos-tooltip-error");var h=e._tooltip;h.find(".wijmo-wijtooltip-close").click(function(){d.data("wijtooltip-manuallyclosed",true)}).removeClass("wijmo-wijtooltip-close").css({background:"none",border:"none",display:"block",height:"16px",position:"absolute",right:"3px",top:"3px",width:"16px"}).parent().removeClass("ui-state-default").addClass("ui-state-error");h.find(".wijmo-wijtooltip-container").addClass("ui-state-error ui-corner-all");d.click(function(){if(h.is(":hidden")){d.data("wijtooltip-manuallyclosed",false);d.wijtooltip("show")}else{d.data("wijtooltip-manuallyclosed",true);d.wijtooltip("hide")}});var i=b(f).closest(".ui-accordion-content").prev().addClass(this.settings.errorClass).removeClass(this.settings.validClass);i.closest(".ui-accordion").unbind("wijaccordionselectedindexchanged").bind("wijaccordionselectedindexchanged",function(m,k){var l=b(this).find(".ui-accordion-content");var j=l.eq(k.newIndex).find("label[generated=true]");log(j.data("wijtooltip-manuallyclosed"));if(j.data("wijtooltip-manuallyclosed")){}else{j.wijtooltip("show")}});i.closest(".ui-accordion").bind("wijaccordionbeforeselectedindexchanged",function(l,j){var k=b(this).find(".ui-accordion-content");k.eq(j.prevIndex).find("label[generated=true]").wijtooltip("hide")});if(d.is(":visible")){d.wijtooltip("show")}else{d.wijtooltip("hide")}}if(!g&&this.settings.success){d.wijtooltip("hide");d.wijtooltip("destroy");d.closest(".ui-accordion-content").prev().addClass(this.settings.validClass).removeClass(this.settings.errorClass);d.removeClass(this.settings.errorClass).addClass(this.settings.validClass);d.remove()}this.toShow=this.toShow.add(d)};b.extend(b.validator.prototype,{showLabel:a,optional:function(c){return !b.validator.methods.required.call(this,b.trim(c.value),c)}})});
define("jquery-nos-wysiwyg",["module","jquery-nos","jquery","tinymce"],function(a,c,b){c.fn.wysiwyg=function(e){var d=b(this);e=e||{};b.ajax({dataType:"json",url:"admin/nos/wysiwyg/enhancers",data:e.urlEnhancers?{urlEnhancers:true}:null,success:function(f){e=b.extend({script_url:"/static/novius-os/admin/vendor/tinymce/tiny_mce"+(a.config().minified?"":"_src")+".js",theme:"nos",plugins:"spellchecker,xhtmlxtras,style,table,advlist,inlinepopups,media,searchreplace,paste,noneditable,visualchars,nonbreaking",theme_nos_enhancers:f},e||{});b(d).tinymce(e)}})};return c});
define("jquery-nos",["jquery","jquery-nos-validate","jquery-form","jquery-ui.button","wijmo.wijtextbox","wijmo.wijcheckbox","wijmo.wijradio","wijmo.wijdropdown","wijmo.wijexpander","wijmo.wijaccordion","wijmo.wijdialog"],function(d){var f=void (0),e=window.$nos=d.sub(),a=f,b=function(){if(a===f){a=e(".nos-ostabs")}return a},c={dialogOpened:[],dialogFocused:-1,open:function(i){var g=this,h=i.data("callbacks.nosdialog");g.dialogOpened.push(i[0]);if(!d.isPlainObject(h)){i.data("callbacks.nosdialog",{})}},focus:function(j){var g=this,i=j.data("callbacks.nosdialog"),h=d.inArray(j[0],g.dialogOpened);if(h!==-1){g.dialogOpened.splice(h,1)}g.dialogOpened.push(j[0]);g.dialogFocused=j[0];if(d.isPlainObject(i)){d.each(i,function(k,l){g.fireDialogEvent(j,l)});j.data("callbacks.nosdialog",{})}},close:function(i){var g=this,h=d.inArray(i[0],g.dialogOpened);if(h!==-1){g.dialogOpened.splice(h,1)}if(h>0){g.focus(d(g.dialogOpened[h-1]))}},fireDialogEvent:function(h,g){var j=h.find("> iframe");if(j.size()){if(j[0].contentDocument.$){j[0].contentDocument.$("body").trigger(g)}}else{try{h.trigger(g)}catch(i){log("fireDialogEvent error",i,g)}}},dispatchEvent:function(h){var g=this;d.each(g.dialogOpened,function(){var j=d(this);if(this===g.dialogFocused){g.fireDialogEvent(j,h)}else{var i=j.data("callbacks.nosdialog");if(d.isPlainObject(i)){i[h.type+(h.namespace?"."+h.namespace:"")]=h}}})}};e.extend({dispatchEvent:function(h){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos.dispatchEvent(h)}var g=b();if(!d.isArray(h)){h=[h]}d.each(h,function(){var i=this;if(!(i instanceof jQuery.Event)){i=d.Event(i)}g.ostabs("dispatchEvent",i);c.dispatchEvent(i)});return e},notify:function(g,h){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos.notify(g,h)}if(!d.isPlainObject(g)){g={title:g}}if(h!==f){d.extend(g,d.isPlainObject(h)?h:{type:h})}if(d.isPlainObject(g)){require(["link!static/novius-os/admin/vendor/jquery/pnotify/jquery.pnotify.default.css","static/novius-os/admin/vendor/jquery/pnotify/jquery.pnotify"],function(){var i={pnotify_history:false,pnotify_addclass:"nos-notification"};d.each(g,function(j,k){if(j.substr(0,8)!=="pnotify_"){j="pnotify_"+j}i[j]=k});return d.pnotify(i)})}return false}});e.fn.extend({xhr:function(){var p=Array.prototype.slice.call(arguments),g="request";if(p.length>0&&d.inArray(p[0],["request","success","error","saveUserConfig"])!==-1){g=p.shift()}switch(g){case"request":var v=d.extend({dataType:"json",type:"POST",data:{}},p[0]||{}),j=v.success,n=v.error,u=this;if(v.dataType=="json"){v.success=function(i){if(d.isFunction(j)){i.user_success=j}u.xhr("success",i)};v.error=function(i){u.xhr("error",i);if(d.isFunction(n)){n.apply(this,p)}}}return d.ajax(v);break;case"success":var t=p[0];if(t.error){if(d.isArray(t.error)){d.each(t.error,function(){e.notify(this,"error")})}else{e.notify(t.error,"error")}}if(t.internal_server_error){var l=t.internal_server_error;var q="An internal server error has been detected.\n\n";q+=l.type+" [ "+l.severity+" ]: "+l.message+"\n";q+=l.filepath+" @ line "+l.error_line+"\n\n";q+="Backtrace:\n";for(var k=0;k<l.backtrace.length;k++){q+=(k+1)+": "+l.backtrace[k].file+" @ line "+l.backtrace[k].line+"\n"}if(console){console.error(q)}}if(t.notify){if(d.isArray(t.notify)){d.each(t.notify,function(){e.notify(this)})}else{e.notify(t.notify)}}if(d.isFunction(t.user_success)){t.user_success.apply(this,p)}var o=this.closest(".ui-dialog-content").size();if(o){if(t.closeTab){this.tab("close")}}else{if(t.redirect){document.location.href=t.redirect}if(t.replaceTab){this.tab("update",{url:t.replaceTab,reload:true})}}if(t.dispatchEvent){if(d.isArray(t.dispatchEvent)){d.each(t.dispatchEvent,function(w,x){e.dispatchEvent(x)})}else{e.dispatchEvent(t.dispatchEvent)}}break;case"error":var r=p[0],m=p[1];if(r.status!=0){e.notify("Connection error!","error")}else{if(m=="parsererror"){e.notify("Request seemed a success, but we could not read the answer.")}else{if(m=="timeout"){e.notify("Time out (server is busy?). Please try again.")}}}break;case"saveUserConfig":var s=p[0],h=p[1];this.xhr({url:"/admin/nos/noviusos/save_user_configuration",data:{key:s,configuration:h}});break}return this},media:function(j){j=j||{};var g={all:"/admin/nos/media/list",image:"/admin/nos/media/list?view=image_pick"},k=this;var i=null;var h=d.extend({title:k.attr("title")||"File",allowDelete:true,choose:function(){if(i===null){i=k.dialog({destroyOnClose:false,contentUrl:g[j.mode],ajax:true,title:"Choose a media file"});i.bind("select_media",function(m,l){k.inputFileThumb({file:l.thumbnail});k.val(l.id);i.dialog("close")})}else{i.dialog("open")}}},j.inputFileThumb||{});require(["static/novius-os/admin/vendor/jquery/jquery-ui-input-file-thumb/js/jquery.input-file-thumb","link!static/novius-os/admin/vendor/jquery/jquery-ui-input-file-thumb/css/jquery.input-file-thumb.css"],function(){d(function(){k.inputFileThumb(h)})})},form:function(){var h=Array.prototype.slice.call(arguments),j="ui",g=this;if(h.length>0&&d.inArray(h[0],["ui","validate","ajax"])!==-1){j=h.shift()}switch(j){case"ui":g.find(":input[type='text'],:input[type='password'],:input[type='email'],textarea").wijtextbox();g.find(":input[type='submit'],button").each(function(){var k={};var l=d(this).data("icon");if(l){k.icons={primary:"ui-icon-"+l}}d(this).button(k)});g.find("select").filter(":not(.notransform)").onShow("one",function(){d(this).wijdropdown()});g.find(":input[type=checkbox]").onShow("one",function(){d(this).wijcheckbox()});g.find(":input[type=radio]").filter(":not(.notransform)").onShow("one",function(){d(this).wijradio()});g.find(".expander").each(function(){var k=d(this);k.wijexpander(d.extend({expanded:true},k.data("wijexpander-options")))});g.find(".accordion").wijaccordion({header:"h3",selectedIndexChanged:function(l,k){e(l.target).find(".ui-accordion-content").eq(k.newIndex).onShow()}});break;case"validate":var i=h[0]||{};if(!g.is("form")){g=g.find("form")}require(["jquery-nos-validate"],function(){g.validate(d.extend({},i,{errorClass:"ui-state-error",success:true,ignore:"input[type=hidden]"}))});break;case"ajax":if(!g.is("form")){g=g.find("form")}require(["jquery-form"],function(){g.ajaxForm({dataType:"json",success:function(k){g.xhr("success",k).triggerHandler("ajax_success",[k])},error:function(){e.notify("An error occured","error")}})});break}return this},onShow:function(){var g=Array.prototype.slice.call(arguments),i="show";if(g.length>0&&d.inArray(g[0],["one","bind","show"])!==-1){i=g.shift()}switch(i){case"one":case"bind":var h=g[0];if(!d.isFunction(h)){return}this.each(function(){var k=e(this),j=k.data("nos-on-show")||0;k.addClass("nos-on-show").data("nos-on-show",j+(i==="bind"?1:0))[i]("nos-on-show",h);if(k.is(":visible")){k.onShow()}});break;case"show":this.not(".nos-on-show-exec").addClass("nos-on-show-exec").each(function(){var k=e(this),j=k.data("nos-on-show")||0;if(k.is(".nos-on-show")){k.css("display","block")}if(!k.is(":visible")){return true}if(k.is(".nos-on-show")){if(!j){k.removeClass("nos-on-show")}k.trigger("nos-on-show")}k.find(".nos-on-show").not(".nos-on-show-exec").onShow()}).removeClass("nos-on-show-exec");break}return this},confirmationDialog:function(h){var g=this;if(!h){h={}}h=d.extend({ajax:true,width:500,height:"auto","class":"nos-confirmation-dialog",dialogRendered:function(o){var l=e('<form class="fieldset standalone"></form>');var k=d("<p></p>");var j=d('<button type="submit" class="primary ui-state-error"></button>').data("icon","trash").append(h.appDesk.i18n("Confirm the deletion").label);var i=d('<a href="#"></a>').append(h.appDesk.i18n("Cancel").label);var n=d("<span></span>").text(" "+h.appDesk.i18n("or").label+" ");var m=o.find(".verification");j.appendTo(k);n.appendTo(k);i.appendTo(k);k.appendTo(o);j.click(function(p){p.preventDefault();var q=true;m.each(function(){if(m.val().length==0||m.val()!=m.data("verification")){q=false;return false}});if(q){if(d.isFunction(h.confirmed)){h.confirmed(o)}o.dialog("close")}else{e.notify(h.appDesk.i18n("Wrong confirmation").label,"error")}});i.click(function(p){p.preventDefault();o.dialog("close")});o.wrapInner(l);o.parent().form()}},h);g.dialog(h)},dialog:function(){var k=Array.prototype.slice.call(arguments),g="open";if(k.length>0&&d.inArray(k[0],["open","close"])!==-1){g=k.shift()}switch(g){case"open":if(this.is(".ui-dialog")){this.wijdialog("open");return this}var o=k[0]||{},p=d.extend(true,{},{destroyOnClose:true,width:window.innerWidth-200,height:window.innerHeight-100,modal:true,captionButtons:{pin:{visible:false},refresh:{visible:o.contentUrl!=null&&!o.ajax},toggle:{visible:false},minimize:{visible:false},maximize:{visible:false}}},o),l={open:p.open,close:p.close,focus:p.focus},m=this.closest(".nos-dispatcher, body"),n=this,h=e("<div></div>").addClass("nos-dispatcher").appendTo(m);d.extend(p,{close:function(r,q){c.close(h);if(d.isFunction(l.close)){l.close.apply(h,arguments)}if(p.destroyOnClose){h.wijdialog("destroy").remove()}else{h.closest(".ui-dialog").hide().appendTo(m)}},focus:function(r,q){c.focus(h);if(d.isFunction(l.focus)){l.focus.apply(h,arguments)}},open:function(r,q){c.open(h);if(d.isFunction(l.open)){l.open.apply(h,arguments)}if(!p.destroyOnClose){h.closest(".ui-dialog").appendTo("body")}}});if(p.content!==f){h.append(p.content)}if(p["class"]!==f){h.addClass(p["class"])}var j=true;if(p.ajax){var i=p.contentUrl;delete p.contentUrl;p.autoOpen=false;h.wijdialog(p);d.ajax({url:i,type:"GET",dataType:"html",data:p.ajaxData||{},complete:function(s,q,t){t=s.responseText;if(s.isResolved()){s.done(function(v){t=v});try{var r=d.parseJSON(t);j=false}catch(u){}if(j){h.wijdialog("open").html(t);d.isFunction(p.dialogRendered)&&p.dialogRendered(h)}else{h.empty().wijdialog("destroy").remove();n.xhr("success",r)}}}})}else{h.wijdialog(p)}if(j&&d.isFunction(p.onLoad)){p.onLoad()}return h;break;case"close":this.closest(":wijmo-wijdialog").wijdialog("close");break}return this},listenEvent:function(g,h){this.closest(".nos-dispatcher, body").on(g,h)},refreshNosPanel:function(){d.ajax({url:"/admin/nos/noviusos/appstab",success:function(g){var h=d("#noviusospanel > .nos-ostabs-panel-content");if(h.length){h.html(g)}}})},tab:function(){var h=Array.prototype.slice.call(arguments),j="open",i=function(k){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos(window.frameElement).data("nos-ostabs-index")}var l=d(k).parents(".nos-ostabs-panel-content");if(l.size()){return l.data("nos-ostabs-index")}return false},g=this;if(h.length>0&&d.inArray(h[0],["open","close","add","update","init"])!==-1){j=h.shift()}switch(j){case"open":(function(){var n=h[0]||{},m=h[1]||{},l=g.closest(".ui-dialog-content").size();if(l){g.dialog(d.extend({contentUrl:n.url,ajax:!n.iframe,title:n.label},m))}else{if(window.parent!=window&&window.parent.$nos){window.parent.$nos(window.frameElement).tab("open",n,m)}else{if(b().length){var k=b().ostabs("tabs"),o=false;d.each(k,function(q,p){if(p.url===n.url){o=q;return false}});if(o!==false){return b().ostabs("select",o+4)}else{g.tab("add",n)}}else{if(n.url){window.open(n.url)}}}}})();break;case"add":(function(){var m=h[0],k=h[1]||"end";if(window.parent!=window&&window.parent.$nos){window.parent.$nos(window.frameElement).tab("add",m,k)}else{var l;if(d.inArray(k,["before","after"])!==-1){l=i(g)+(k==="before"?-1:1)}if(b().length){l=b().ostabs("add",m,l);b().ostabs("select",l)}else{if(m.url){window.open(m.url)}}}})();break;case"close":(function(){var l=g.closest(":wijmo-wijdialog");if(l.size()){g.dialog("close")}else{if(window.parent!=window&&window.parent.$nos){window.parent.$nos(window.frameElement).tab("close")}else{var k=i(g);if(b().length){b().ostabs("remove",k)}}}})();break;case"update":(function(){var l=h[0];if(window.parent!=window&&window.parent.$nos){window.parent.$nos(window.frameElement).tab("update",l)}else{if(g.size()&&!g.closest(".ui-dialog-content").size()&&b().length){var k=i(g);b().ostabs("update",k,l)}}})();break;case"init":(function(){var m=h[0],l=false,k=function(){if(b().length){if(l){clearTimeout(l)}l=setTimeout(function(){b().xhr("saveUserConfig","tabs",{selected:b().ostabs("option","selected"),tabs:b().ostabs("tabs")})},500)}};a=g;d.extend(m,{add:k,remove:k,select:k,show:k,drag:k,update:k});if(m.user_configuration["tabs"]){if(!m.options){m.options={}}m.initTabs=m.user_configuration["tabs"]["tabs"];m.selected=m.user_configuration["tabs"]["selected"]}a.ostabs(m)})();break}return this}});d.fn.nos=function(){return e(this)};return e});
define("jquery-nos-loadspinner",["jquery","jquery-nos","jquery-ui.widget"],function(a,b){a.widget("nos.loadspinner",{options:{diameter:40,color:null,density:40,range:1.3,scaling:false,fading:true,shape:"circle",speed:2,fps:24},shapes:["circle","square","rectangle","roundedRectangle"],colorReg:/^\#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,colorRgb:/^rgb\((\d+)[ \,]+(\d+)[ \,]+(\d+)\)$/,UISpinnerCanvas:null,UISpinnerContext:null,UISpinnerCacheCanvas:null,UISpinnerCacheContext:null,running:false,ready:false,timer:null,activeId:0,colorRGB:null,_create:function(){this.UISpinnerCanvas=a("<canvas></canvas>").attr("id","CanvasLoader").get(0);this.UISpinnerContext=this.UISpinnerCanvas.getContext("2d");this.element.append(this.UISpinnerCanvas);this.UISpinnerCanvas.width=this.UISpinnerCanvas.height=this.options.diameter;this.UISpinnerCacheCanvas=a("<canvas></canvas>").get(0);a("body").append(this.UISpinnerCacheCanvas);this.UISpinnerCacheContext=this.UISpinnerCacheCanvas.getContext("2d");this.UISpinnerCacheCanvas.width=this.UISpinnerCacheCanvas.height=this.options.diameter;a(this.UISpinnerCacheCanvas).hide()},_init:function(){if(!this.options.color){this.options.color=this.element.css("color")}this._setOption("color",this.options.color);this.ready=true;this._draw();this.start()},_setOption:function(d,e){var c=this;switch(d){case"diameter":if(isNaN(e)){return}e=Math.round(Math.abs(e));break;case"color":this.colorRGB=this._RGB(e);break;case"shape":if(a.inArray(e,this.shapes)==-1){return}break;case"density":if(isNaN(e)){return}e=Math.round(Math.abs(e));break;case"range":if(isNaN(e)){return}e=Math.abs(e);break;case"speed":if(isNaN(e)&&Math.abs(e)>0){return}e=Math.round(Math.abs(e));break;case"fps":if(isNaN(e)){return}e=Math.round(Math.abs(e));break}a.Widget.prototype._setOption.apply(c,arguments);if(a.inArray(d,["diameter","color","shape","density","range","scaling","fading"])!=-1){this._redraw()}else{if(a.inArray(d,["speed","fps"])!=-1){this._reset()}}},_RGB:function(d){var c={};if(this.colorReg.test(d)){d=d.charAt(0)==="#"?d.substring(1,7):d;if(d.length==3){d=d+d}c.r=parseInt(d.substring(0,2),16);c.g=parseInt(d.substring(2,4),16);c.b=parseInt(d.substring(4,6),16)}else{if(this.colorRgb.exec(d)){c.r=parseInt(RegExp.$1);c.g=parseInt(RegExp.$2);c.b=parseInt(RegExp.$3)}else{c.r=0;c.g=0;c.b=0}}return c},_draw:function(){var f=0,p=this.options.diameter*0.07,e,l,o,k,n,m,d,j=0.1,c=Math.round(this.options.density*this.options.range),g;this.UISpinnerCacheContext.clearRect(0,0,this.UISpinnerCacheCanvas.width,this.UISpinnerCacheCanvas.height);this.UISpinnerCanvas.width=this.UISpinnerCanvas.height=this.UISpinnerCacheCanvas.width=this.UISpinnerCacheCanvas.height=this.options.diameter;switch(this.options.shape){case this.shapes[0]:while(f<this.options.density){if(f<=c){g=1-((1-j)/c*f)}else{g=j}e=(this.options.density-f)*((Math.PI*2)/this.options.density);n=this.UISpinnerCanvas.width*0.5+Math.cos(e)*(this.options.diameter*0.45-p)-this.UISpinnerCanvas.width*0.5;m=this.UISpinnerCanvas.height*0.5+Math.sin(e)*(this.options.diameter*0.45-p)-this.UISpinnerCanvas.height*0.5;this.UISpinnerCacheContext.beginPath();if(this.options.fading){this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+g.toString()+")"}else{this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}if(this.options.scaling){this.UISpinnerCacheContext.arc(this.options.diameter*0.5+n,this.options.diameter*0.5+m,p*g,0,Math.PI*2,false)}else{this.UISpinnerCacheContext.arc(this.options.diameter*0.5+n,this.options.diameter*0.5+m,p,0,Math.PI*2,false)}this.UISpinnerCacheContext.closePath();this.UISpinnerCacheContext.fill();f+=1}break;case this.shapes[1]:p=this.UISpinnerCanvas.width*0.12;while(f<this.options.density){if(f<=c){g=1-((1-j)/c*f)}else{g=j}d=360-360/this.options.density*f;e=d/180*Math.PI;n=Math.cos(e)*p*3+this.UISpinnerCacheCanvas.width*0.5;m=Math.sin(e)*p*3+this.UISpinnerCacheCanvas.height*0.5;this.UISpinnerCacheContext.save();this.UISpinnerCacheContext.translate(n,m);this.UISpinnerCacheContext.rotate(e);this.UISpinnerCacheContext.translate(-n,-m);this.UISpinnerCacheContext.beginPath();if(this.options.fading){this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+g.toString()+")"}else{this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}this.UISpinnerCacheContext.fillRect(n,m-p*0.5,p,p);this.UISpinnerCacheContext.closePath();this.UISpinnerCacheContext.fill();this.UISpinnerCacheContext.restore();f+=1}break;case this.shapes[2]:o=this.UISpinnerCacheCanvas.width*0.24;k=o*0.35;while(f<this.options.density){if(f<=c){g=1-((1-j)/c*f)}else{g=j}d=360-360/this.options.density*f;e=d/180*Math.PI;n=Math.cos(e)*(k+(this.UISpinnerCacheCanvas.height-k)*0.13)+this.UISpinnerCacheCanvas.width*0.5;m=Math.sin(e)*(k+(this.UISpinnerCacheCanvas.height-k)*0.13)+this.UISpinnerCacheCanvas.height*0.5;this.UISpinnerCacheContext.save();this.UISpinnerCacheContext.translate(n,m);this.UISpinnerCacheContext.rotate(e);this.UISpinnerCacheContext.translate(-n,-m);this.UISpinnerCacheContext.beginPath();if(this.options.fading){this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+g.toString()+")"}else{this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}this.UISpinnerCacheContext.fillRect(n,m-k*0.5,o,k);this.UISpinnerCacheContext.closePath();this.UISpinnerCacheContext.fill();this.UISpinnerCacheContext.restore();f+=1}break;case this.shapes[3]:o=this.UISpinnerCacheCanvas.width*0.24;k=o*0.35;l=k*0.65;while(f<this.options.density){if(f<=c){g=1-((1-j)/c*f)}else{g=j}d=360-360/this.options.density*f;e=d/180*Math.PI;n=Math.cos(e)*(k+(this.UISpinnerCacheCanvas.height-k)*0.13)+this.UISpinnerCacheCanvas.width*0.5;m=Math.sin(e)*(k+(this.UISpinnerCacheCanvas.height-k)*0.13)+this.UISpinnerCacheCanvas.height*0.5;this.UISpinnerCacheContext.save();this.UISpinnerCacheContext.translate(n,m);this.UISpinnerCacheContext.rotate(e);this.UISpinnerCacheContext.translate(-n,-m);if(this.options.fading){this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+g.toString()+")"}else{this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}this.UISpinnerCacheContext.beginPath();this.UISpinnerCacheContext.moveTo(n+l,m-k*0.5);this.UISpinnerCacheContext.lineTo(n+o-l,m-k*0.5);this.UISpinnerCacheContext.quadraticCurveTo(n+o,m-k*0.5,n+o,m-k*0.5+l);this.UISpinnerCacheContext.lineTo(n+o,m-k*0.5+k-l);this.UISpinnerCacheContext.quadraticCurveTo(n+o,m-k*0.5+k,n+o-l,m-k*0.5+k);this.UISpinnerCacheContext.lineTo(n+l,m-k*0.5+k);this.UISpinnerCacheContext.quadraticCurveTo(n,m-k*0.5+k,n,m-k*0.5+k-l);this.UISpinnerCacheContext.lineTo(n,m-k*0.5+l);this.UISpinnerCacheContext.quadraticCurveTo(n,m-k*0.5,n+l,m-k*0.5);this.UISpinnerCacheContext.closePath();this.UISpinnerCacheContext.fill();this.UISpinnerCacheContext.restore();f+=1}break}this._tick(true);return this},_clean:function(){this.UISpinnerContext.clearRect(0,0,this.UISpinnerCanvas.width,this.UISpinnerCanvas.height);return this},_redraw:function(){if(this.ready){this._clean();this._draw()}return this},_reset:function(){if(this.running){this.stop();this.start()}return this},_tick:function(c){var d=this.options.density>360?this.options.density/360:360/this.options.density;d*=this.options.speed;if(!c){this.activeId+=d}if(this.activeId>360){this.activeId-=360}this.UISpinnerContext.clearRect(0,0,this.options.diameter,this.options.diameter);this.UISpinnerContext.save();this.UISpinnerContext.translate(this.options.diameter*0.5,this.options.diameter*0.5);this.UISpinnerContext.rotate(Math.PI/180*this.activeId);this.UISpinnerContext.translate(-this.options.diameter*0.5,-this.options.diameter*0.5);this.UISpinnerContext.drawImage(this.UISpinnerCacheCanvas,0,0,this.options.diameter,this.options.diameter);this.UISpinnerContext.restore();return this},start:function(){if(!this.running){this.running=true;var c=this;this.timer=window.setInterval(function(){c._tick()},Math.round(1000/this.options.fps))}return this},stop:function(){if(this.running){this.running=false;clearInterval(this.timer);this.timer=null;delete this.timer}return this},destroy:function(){if(this.running){this.stop()}a(this.UISpinnerCanvas).remove();a(this.UISpinnerCacheCanvas).remove();a.Widget.prototype.destroy.apply(this);return this}});return b});
define("jquery-nos-ostabs",["jquery","jquery-nos","jquery-ui.widget","jquery-nos-loadspinner","jquery-ui.sortable","wijmo.wijsuperpanel"],function(a,c){var b=void (0);a.widget("nos.ostabs",{options:{initTabs:[],newTab:"appsTab",trayTabs:[],appsTab:{},fx:null,labelMinWidth:100,labelMaxWidth:200,selected:null,texts:{scrollLeft:"Scroll left",scrollRight:"Scroll right",newTab:"New tab",removeTab:"Remove tab",closeTab:"Close tab",reloadTab:"Reload tab",spinner:"Loading..."},add:null,remove:null,select:null,show:null,drag:null},tabId:0,openRank:0,_create:function(){var d=this,e=d.options;d._tabify(true);a(window).resize(function(){if(e.selected){d._firePanelEvent(d.panels.eq(e.selected),a.Event("resizePanel"))}})},_setOption:function(e,f){var d=this;if(e=="selected"){d.select(f)}else{d.options[e]=f;d._tabify()}},_getNextTabId:function(){var d=this;return ++d.tabId},_tabId:function(d){var e=this;return a(d).data("panelid.tabs")||"nos-ostabs-"+e._getNextTabId()},_sanitizeSelector:function(d){return d.replace(/:/g,"\\:")},_ui:function(d,e){var f=this,g=f.lis.index(d);if(e===b){e=f.element.find(f._sanitizeSelector(f.anchors[g].hash))[0]}return{tab:d,panel:e,index:g}},_cleanup:function(){var d=this;d.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span.nos-ostabs-icon").removeClass("nos-ostabs-loader").each(function(){if(a.isFunction(a.fn.loadspinner)){a(this).loadspinner("destroy")}}).html(" ").parent().find("span.nos-ostabs-label").each(function(){var f=a(this),e=f.data("label.tabs");if(e){f.html(e).removeData("label.tabs")}});return d},_tabify:function(q){var r=this,g=r.options,e=/^#.+/;if(q){r.element.addClass("nos-ostabs ui-widget ui-widget-content");r.uiOstabsHeader=a("<div></div>").addClass("ui-widget-header").appendTo(r.element);r.uiOstabsSuperPanel=a("<div></div>").addClass("nos-ostabs-tabs").appendTo(r.uiOstabsHeader);r.uiOstabsTray=a("<ul></ul>").addClass("nos-ostabs-tray nos-ostabs-nav");if(a.isArray(g.trayTabs)){a.each(g.trayTabs,function(o,s){if(a.isPlainObject(s)){r._add(s,r.uiOstabsTray).addClass("nos-ostabs-tray")}})}r.uiOstabsTray.prependTo(r.uiOstabsHeader);if(a.isPlainObject(g.appsTab)){r.uiOstabsAppsTab=a("<ul></ul>").addClass("nos-ostabs-appstab  nos-ostabs-nav").prependTo(r.uiOstabsHeader);r._add(g.appsTab,r.uiOstabsAppsTab).addClass("nos-ostabs-appstab").removeClass("ui-state-default");r.uiOstabsAppsTab.find("> li > a:first").click(function(){c().refreshNosPanel()})}else{r.uiOstabsAppsTab=a("<ul></ul>")}r.uiOstabsSuperPanel.css("left",r.uiOstabsAppsTab.outerWidth(true)+25).css("right",r.uiOstabsTray.outerWidth(true)+35).wijsuperpanel({allowResize:false,autoRefresh:true,hScroller:{scrollBarVisibility:"hidden",scrollMode:"buttons",increaseButtonPosition:{my:"left bottom",at:"right bottom"},decreaseButtonPosition:{my:"right bottom",at:"left bottom"}},vScroller:{scrollBarVisibility:"hidden"},showRounder:false}).removeClass("ui-widget ui-widget-content").css("overflow","visible");r.uiOstabsSuperPanelContent=r.uiOstabsSuperPanel.wijsuperpanel("getContentElement");r.uiOstabsTabs=a("<ul></ul>").appendTo(r.uiOstabsSuperPanelContent);if(a.isArray(g.initTabs)){a.each(g.initTabs,function(o,s){r._add(s)})}var f=g.newTab;if(a.isPlainObject(f)){f=a.extend({label:g.texts.newTab,iconClasses:"ui-icon ui-icon-circle-plus"},f)}else{if(f&&a.isPlainObject(g.appsTab)){f=a.extend({},g.appsTab,{label:g.texts.newTab,iconClasses:"ui-icon ui-icon-circle-plus",iconUrl:"",iconSize:16})}else{f=false}}if(f){r.uiOstabsNewTab=r._add(f).addClass("nos-ostabs-newtab")}else{r.uiOstabsNewTab=a("<li>/<li>")}r.uiOstabsNewTab.hover(function(){a(this).find(".nos-ostabs-label").css("display","inline-block");r._tabsWidth()},function(){a(this).find(".nos-ostabs-label").css("display","none");r._tabsWidth()});r.uiOstabsTabs.sortable({items:"li:not(.nos-ostabs-newtab)",appendTo:r.uiOstabsSuperPanelContent,cursor:"move",delay:250,scroll:false,helper:"clone",tolerance:"pointer",axis:"x",zIndex:100000,placeholder:"ui-state-highlight",forcePlaceholderSize:true,start:function(){r.sorting=true},stop:function(){r.sorting=false},update:function(){r._trigger("drag",null);r.lis=r.uiOstabsAppsTab.add(r.uiOstabsTray).add(r.uiOstabsTabs).find("li:has(a[href])");r.anchors=r.lis.map(function(s){var o=a("a",this)[0];r.element.find(r._sanitizeSelector(o.hash)).find(".nos-ostabs-panel-content").data("nos-ostabs-index",s);return o});r._tabsWidth()}});r.tabsWidth=r.uiOstabsSuperPanelContent.width();r.labelWidth=g.labelMaxWidth;r.uiOstabsTabs.width(r.tabsWidth)}var m=[];r.lis=r.uiOstabsAppsTab.add(r.uiOstabsTray).add(r.uiOstabsTabs).find("li:has(a[href])").each(function(o){var t=a(this),s=t.data("ui-ostab")||{};if(s.openRank!==false){m[s.openRank]=t}});r.openRank=1;a.each(m,function(o,t){if(t){var s=t.data("ui-ostab")||{};s.openRank=r.openRank++}});r.anchors=r.lis.map(function(){return a("a",this)[0]});r.panels=a([]);r.anchors.each(function(t,o){var s=a(o).attr("href");var v=s.split("#")[0],w,x;if(v&&(v===location.toString().split("#")[0]||(w=a("base")[0])&&v===w.href)){s=o.hash;o.href=s}if(e.test(s)){x=r.element.find(r._sanitizeSelector(s));r.panels=r.panels.add(x)}else{if(s&&s!=="#"){a.data(o,"href.tabs",s);a.data(o,"load.tabs",s.replace(/#.*$/,""));var y=r._tabId(o);o.href="#"+y;x=r.element.find("#"+y);if(!x.length){var u=r.lis.eq(t).data("ui-ostab");x=a("<div></div>").attr("id",y).addClass("nos-ostabs-panel ui-widget-content ui-corner-bottom nos-ostabs-hide").appendTo(r.element);r._actions(x,t,u.actions||[])}r.panels=r.panels.add(x)}}x.find(".nos-ostabs-panel-content").data("nos-ostabs-index",t)});if(q){r.uiOstabsTray.add(r.uiOstabsAppsTab).addClass("nos-ostabs-nav ui-helper-reset ui-helper-clearfix");r.lis.addClass("ui-corner-top");r.panels.addClass("nos-ostabs-panel ui-widget-content");if(g.selected===b){if(location.hash){r.anchors.each(function(s,o){if(o.hash==location.hash){g.selected=s;return false}})}if(typeof g.selected!=="number"&&r.lis.filter(".nos-ostabs-selected").length){g.selected=r.lis.index(r.lis.filter(".nos-ostabs-selected"))}g.selected=g.selected||(r.lis.length?0:-1)}g.selected=((g.selected>=0&&r.anchors[g.selected])||g.selected<0)?g.selected:0;r.panels.addClass("nos-ostabs-hide");r.lis.removeClass("nos-ostabs-selected ui-state-active");if(g.selected>=0&&r.anchors.length){r.element.find(r._sanitizeSelector(r.anchors[g.selected].hash)).removeClass("nos-ostabs-hide");r.lis.eq(g.selected).addClass("nos-ostabs-selected ui-state-active ui-state-open");r.element.queue("tabs",function(){r._trigger("show",null,r._ui(r.lis[g.selected]))});r.title(g.selected,r.title(g.selected));r._load(g.selected)}a(window).bind("unload",function(){r.lis.add(r.anchors).unbind(".tabs");r.lis=r.anchors=r.panels=null})}else{g.selected=r.lis.index(r.lis.filter(".nos-ostabs-selected"))}r.anchors.removeData("cache.tabs");r.lis.add(r.anchors).unbind(".tabs");var i=function(s,o){o.addClass("ui-state-"+s)};var l=function(s,o){o.removeClass("ui-state-"+s)};r.lis.bind("mouseover.tabs",function(){i("hover",a(this))});r.lis.bind("mouseout.tabs",function(){l("hover",a(this))});r.anchors.bind("focus.tabs",function(){i("focus",a(this).closest("li"))});r.anchors.bind("blur.tabs",function(){l("focus",a(this).closest("li"))});var d,j;if(g.fx){if(a.isArray(g.fx)){d=g.fx[0];j=g.fx[1]}else{d=j=g.fx}}function h(o,s){o.css("display","");if(!a.support.opacity&&s.opacity){o[0].style.removeAttribute("filter")}}function k(t){var s=t.data("callbacks.ostabs"),o=t.find(".nos-dispatcher");if(a.isPlainObject(s)){a.each(s,function(u,v){r._firePanelEvent(o,v)});s={}}}var n=j?function(o,s){var t=a(o).closest("li").addClass("nos-ostabs-selected ui-state-active");s.hide().removeClass("nos-ostabs-hide").animate(j,j.duration||"normal",function(){if(t.hasClass("nos-ostabs-newtab")){r._tabsWidth()}r.uiOstabsSuperPanel.wijsuperpanel("scrollChildIntoView",t.find("a"));h(s,j);k(s);r._firePanelEvent(s,a.Event("showPanel"))})}:function(o,s){var t=a(o).closest("li");if(t.hasClass("nos-ostabs-newtab")){r._tabsWidth()}r.uiOstabsSuperPanel.wijsuperpanel("scrollChildIntoView",t.find("a"));t.addClass("nos-ostabs-selected ui-state-active");s.removeClass("nos-ostabs-hide");k(s);r._firePanelEvent(s,a.Event("showPanel"))};var p=d?function(s,o){o.animate(d,d.duration||"normal",function(){if(r.uiOstabsNewTab.hasClass("ui-state-active")){r._tabsWidth()}r.lis.removeClass("nos-ostabs-selected ui-state-active");o.addClass("nos-ostabs-hide");h(o,d);r.element.dequeue("tabs");o.trigger("hidePanel.ostabs")})}:function(s,o){if(r.uiOstabsNewTab.hasClass("ui-state-active")){r._tabsWidth()}r.lis.removeClass("nos-ostabs-selected ui-state-active");o.addClass("nos-ostabs-hide");r.element.dequeue("tabs");o.trigger("hidePanel.ostabs")};r.anchors.bind("click.tabs",function(){var t=this,v=a(t).closest("li"),o=r.panels.filter(":not(.nos-ostabs-hide)"),u=r.element.find(r._sanitizeSelector(t.hash)),s=v.data("ui-ostab");v.addClass("ui-state-open");r.uiOstabsNewTab.removeClass("ui-state-open");g.selected=r.anchors.index(this);if(v.hasClass("nos-ostabs-selected")||v.hasClass("ui-state-processing")||r.panels.filter(":animated").length||r._trigger("select",null,r._ui(v[0],u[0]))===false){this.blur();return false}r._abort();if(u.length){if(o.length){r.element.queue("tabs",function(){p(t,o)})}r.element.queue("tabs",function(){s.openRank=r.openRank++;n(t,u)});a("title").text(v.find(".nos-ostabs-label").text());r._load(r.anchors.index(this))}else{throw"jQuery UI Tabs: Mismatching fragment identifier."}this.blur()});r.anchors.bind("click.tabs",function(){return false});r._tabsWidth()},_getIndex:function(e){var d=this;if(typeof e=="string"){e=d.anchors.index(d.anchors.filter("[href$="+e+"]"))}return e},_actions:function(r,i,k){var q=this,f=q.options;var l=q.lis.eq(i),j=q.anchors.eq(i);r.find(".nos-ostabs-actions").remove();var g=a("<div></div>").addClass("nos-ostabs-actions ui-state-active").prependTo(r);var n=a("<div></div>").addClass("nos-ostabs-actions-links").prependTo(g);var e=l.not(".nos-ostabs-tray").not(".nos-ostabs-appstab").not(".nos-ostabs-newtab").length;var m=l.not(".nos-ostabs-appstab").length;var h=j.data("iframe.tabs");if(m){var p=a('<a href="#"></a>').addClass("nos-ostabs-close").click(function(){q.remove(q.lis.index(l));return false}).appendTo(n);a("<span></span>").addClass("ui-icon ui-icon-closethick").text(e?f.texts.removeTab:f.texts.closeTab).appendTo(p);a("<span></span>").text(e?f.texts.removeTab:f.texts.closeTab).appendTo(p)}if(h){var d=a('<a href="#"></a>').addClass("nos-ostabs-reload").click(function(){var o=r.find("iframe.nos-ostabs-panel-content");if(o!==b){o.attr("src",o.attr("src"))}return false}).text(f.texts.reloadTab).appendTo(n);a("<span></span>").addClass("ui-icon ui-icon-refresh").text(f.texts.reloadTab).appendTo(d)}a.each(k,function(){var t=this;var o=a('<a href="#"></a>').addClass("nos-ostabs-action").click(function(u){u.preventDefault();if(a.isFunction(t.click)){t.click(u,{ui:o,action:t})}}).appendTo(n);var s=a("<span></span>").addClass("ui-icon").text(t.label||"").appendTo(o);if(t.iconUrl){s.css("background-image",'url("'+t.iconUrl+'") !important')}else{s.addClass(t.iconClasses)}a("<span></span>").text(t.label||"").appendTo(o)})},_tabsWidth:function(){var d=this,h=d.options,f=0;d.uiOstabsTabs.width(10000000);d.uiOstabsTabs.find("li").each(function(){f+=a(this).outerWidth(true)});d.uiOstabsTabs.width(f);var e=d.uiOstabsTabs.find(".nos-ostabs-label:visible").length,g;if(d.tabsWidth<d.uiOstabsTabs.width()){while(d.tabsWidth<d.uiOstabsTabs.width()&&d.labelWidth>h.labelMinWidth){g=d.labelWidth-h.labelMinWidth;g=g>10?10:g;f=f-e*g;d.uiOstabsTabs.width(f);d.labelWidth=d.labelWidth-g;a("head .tabswidth").remove();a('<style type="text/css" class="tabswidth">.nos-ostabs .ui-widget-header .nos-ostabs-label {width : '+d.labelWidth+"px !important;}</style>").appendTo("head")}}else{do{g=h.labelMaxWidth-d.labelWidth;g=g>10?10:g;if(d.tabsWidth>(f+e*10)){f=f+e*g;d.uiOstabsTabs.width(f);d.labelWidth=d.labelWidth+g;a("head .tabswidth").remove();a('<style type="text/css" class="tabswidth">.nos-ostabs .ui-widget-header .nos-ostabs-label {width : '+d.labelWidth+"px !important;}</style>").appendTo("head")}}while(d.tabsWidth>(f+e*10)&&d.labelWidth<h.labelMaxWidth)}if(d.tabsWidth<d.uiOstabsTabs.width()){d.uiOstabsSuperPanel.find(".wijmo-wijsuperpanel-buttonleft, .wijmo-wijsuperpanel-buttonright").show()}else{d.uiOstabsSuperPanel.find(".wijmo-wijsuperpanel-buttonleft, .wijmo-wijsuperpanel-buttonright").hide()}},add:function(f,e){var d=this;if(!a.isPlainObject(f)||f.url===b){return false}if(e===b){e=d.anchors.length-1}var g=d._add(f);if(e<d.lis.length){g.insertBefore(d.lis[e])}else{e=d.lis.eq(g)}d.uiOstabsTabs.sortable("refresh");d._tabify();if(d.anchors.length==1){d.select(0)}d._trigger("add",f,d._ui(g[0]));return e},_add:function(i,j){var f=this;if(!a.isPlainObject(i)||i.url===b){return false}j=j||f.uiOstabsTabs;i=a.extend({url:"",iframe:false,label:"",labelDisplay:true,iconClasses:"ui-icon ui-icon-document",iconUrl:"",openRank:false,iconSize:16,panelId:false,actions:[]},i);if(i.openRank!==false&&i.openRank>=f.openRank){f.openRank=i.openRank+1}var e=a('<a href="'+i.url+'"></a>');if(i.iframe){e.data("iframe.tabs",true)}if(i.panelId){e.data("panelid.tabs",i.panelId)}var h=f._icon(i).appendTo(e);var g=a("<span></span>").addClass("nos-ostabs-label").text(i.label?i.label:"New tab").appendTo(e);if(!i.labelDisplay){g.hide()}var d=a("<li></li>").append(e).attr("title",i.label).addClass("ui-corner-top ui-state-default").data("ui-ostab",i).appendTo(j);if(!isNaN(i.iconSize)&&i.iconSize!==16&&j!==f.uiOstabsTabs){d.css({height:(i.iconSize+4)+"px",bottom:(i.iconSize-35)+"px"});h.css("top","2px")}return d},remove:function(f){var e=this;f=e._getIndex(f);var k=e.lis.eq(f),i=e.anchors.eq(f),j=e.element.find(e._sanitizeSelector(e.anchors[f].hash)),d=0,g=0;if(f==0&&!k.hasClass("nos-ostabs-selected")){var h=e.lis.filter(".nos-ostabs-newtab");if(h.hasClass("nos-ostabs-selected")){k=h}}if(k.not(".nos-ostabs-tray").not(".nos-ostabs-appstab").not(".nos-ostabs-newtab").length){k.remove();j.remove()}k.removeClass("ui-state-active ui-state-open");e.lis.each(function(m){var l=a(this),n=l.data("ui-ostab")||{};if(l[0]!=k[0]&&n.openRank&&n.openRank>g){g=n.openRank;d=m}});e.select(d);if(k.not(".nos-ostabs-appstab").not(".nos-ostabs-newtab").length){a("> *",j).not(".nos-ostabs-actions").remove()}j.addClass("nos-ostabs-hide").removeData("callbacks.ostabs");k.removeClass("nos-ostabs-selected");e._tabify();e._trigger("remove",null,e._ui(k[0],j[0]));return e},title:function(e,g){var d=this,f=d.options;e=d._getIndex(e);var h=d.lis.eq(e);if(g===b){return h.find(".nos-ostabs-label").text()}else{h.find(".nos-ostabs-label").text(g);if(f.selected==e){a("title").text(g)}d._trigger("title",null,d._ui(h[0]));return d}},update:function(g,h){var f=this;g=f._getIndex(g);if(!a.isPlainObject(h)){return false}var d=!!h.url&&h.reload,k=f.lis.eq(g);h=a.extend({},k.data("ui-ostab"),h);if(d){delete h.reload;this.remove(g);this.add(h,g);this.select(g)}else{if(f.options.selected==g){a("title").text(h.label)}var e=f._add(h),i=e.find("a"),j=f.panels.eq(g);k.data("ui-ostab",h).attr("title",h.label||"").addClass(e.attr("class")).css({height:e.css("height"),bottom:e.css("bottom")}).find("a").empty().append(i.children());f._actions(j,g,h.actions||[]);e.remove();f._trigger("update",null,f._ui(k[0],j[0]))}return f},_icon:function(e){var d=a("<span></span>").addClass("nos-ostabs-icon");if(e.iconUrl){d.css("background-image",'url("'+e.iconUrl+'")')}else{d.addClass(e.iconClasses)}if(!isNaN(e.iconSize)&&e.iconSize!==16){d.css({width:e.iconSize+"px",height:e.iconSize+"px",lineHeight:e.iconSize+"px",top:(e.iconSize>22?22-e.iconSize:10-e.iconSize/2)+"px"})}return d},select:function(e){var d=this;e=d._getIndex(e);if(e==-1){return d}d.anchors.eq(e).trigger("click.tabs");return d},_load:function(h){var f=this;h=f._getIndex(h);var k=f.options,e=f.anchors.eq(h)[0],g=a.data(e,"load.tabs"),i=a.data(e,"iframe.tabs");f._abort();if((!g&&i)||f.element.queue("tabs").length!==0&&a.data(e,"cache.tabs")){f.element.dequeue("tabs");return}var d=f.element.find(f._sanitizeSelector(e.hash)),j=a("> *",d).not(".nos-ostabs-actions").length;if(j!==0){f.element.dequeue("tabs");return}f.lis.eq(h).addClass("ui-state-processing");a("span.nos-ostabs-label",e).each(function(){var l=a(this);l.data("label.tabs",l.html()).html(l.data("label.tabs")?k.texts.spinner:"")});if(a.isFunction(a.fn.loadspinner)){a("span.nos-ostabs-icon",e).each(function(){var l=a(this);l.addClass("ui-state-processing").loadspinner({diameter:l.width(),scaling:true})})}if(!i){f.xhr=a.ajax({url:g,success:function(l){a("<div></div>").addClass("nos-ostabs-panel-content nos-dispatcher").data("nos-ostabs-index",h).prependTo(d.data("callbacks.ostabs",{})).html(l);a.data(e,"cache.tabs",true)},complete:function(){f._cleanup();f._trigger("load",null,f._ui(f.lis[h]))}})}else{a("<iframe "+(a.browser.msie?'allowTransparency="true" ':"")+'src="'+g+'" frameborder="0"></iframe>').data("nos-ostabs-index",h).addClass("nos-ostabs-panel-content nos-dispatcher").bind("load",function(){f._cleanup();f._trigger("load",null,f._ui(f.lis[h]))}).prependTo(d.data("callbacks.ostabs",{}));a.data(e,"cache.tabs",true)}f.element.dequeue("tabs");return f},_abort:function(){var d=this;d.element.queue([]);d.panels.stop(false,true);d.element.queue("tabs",d.element.queue("tabs").splice(-2,2));d._cleanup();return d},tabs:function(){var d=this,e=[];d.uiOstabsTabs.find("li:not(.nos-ostabs-newtab)").each(function(){var f=a.extend({},a(this).data("ui-ostab"));delete f.actions;e.push(f)});return e},dispatchEvent:function(e){var d=this,f=d.options;a.each(d.panels,function(g){var j=a(this);if(g===f.selected){d._firePanelEvent(j,e)}else{var h=j.data("callbacks.ostabs");if(a.isPlainObject(h)){h[e.type+(e.namespace?"."+e.namespace:"")]=e}}});return d},_firePanelEvent:function(d,f){d=d.is(".nos-dispatcher")?d:d.find(".nos-dispatcher");if(d.is("iframe")){if(d[0].contentDocument.$){d[0].contentDocument.$("body").trigger(f)}}else{try{d.trigger(f)}catch(g){log("_firePanelEvent error",g,f)}}},current:function(){var d=this,e=d.options;return{tab:a(d.lis.get(e.selected)),panel:a(d.panels.get(e.selected)),index:e.selected}}});return c});
define("jquery-nos-preview",["jquery","jquery-nos","jquery-ui.widget","wijmo.wijsuperpanel"],function(a,c){var b=void (0);a.widget("nos.preview",{options:{meta:{},actions:[],data:null,dataParser:null,texts:{headerDefault:"Preview",selectItem:"No item selected"}},data:null,_create:function(){var d=this,e=d.options;d.element.addClass("nos-preview ui-widget ui-widget-content wijmo-wijgrid").parents(".nos-appdesk").bind("selectionChanged.appdesk",function(g,f){if(a.isPlainObject(f)){d.select(f)}else{d.unselect()}})},_init:function(){var d=this,e=d.options;d.data=d.data||e.data;if(a.isPlainObject(d.data)){d.select(d.data)}else{d.unselect()}},_uiHeader:function(h){var d=this,g=d.options;var e=a('<table cellspacing="0" cellpadding="0" border="0"><thead></thead></table>').addClass("nos-preview-header wijmo-wijsuperpanel-header wijmo-wijgrid-root wijmo-wijgrid-table").css({borderCollapse:"separate","-moz-user-select":"-moz-none"}).appendTo(d.element);var f=a("<tr></tr>").addClass("wijmo-wijgrid-headerrow").appendTo(e);a("<th><div><span></span></div></th>").addClass("wijgridth ui-widget wijmo-c1basefield ui-state-default wijmo-c1field").appendTo(f).find("div").addClass("wijmo-wijgrid-innercell").find("span").addClass("wijmo-wijgrid-headertext").text(h);return d},_uiFooter:function(){var d=this,e=d.options;if(e.actions.length>0){d.uiFooter=a("<div></div>").addClass("nos-preview-footer").appendTo(d.uiContainer);a.each(e.actions,function(){var g=this;var f=false;if(g.iconClasses){f=g.iconClasses}else{if(g.icon){f="nos-icon16 ui-icon ui-icon-"+g.icon}}var h;if(g.primary){h=(f?'<span class="ui-button-icon-primary '+f+' wijmo-wijmenu-icon-left"></span>':"");h+='<span class="ui-button-text">'+g.label+"</span>";a("<button></button>").addClass("ui-button ui-button-text"+(g.icon?"-icon-primary":"")+" ui-widget ui-state-default ui-corner-all").css({marginBottom:"5px"}).appendTo(d.uiFooter).html(h).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}).click(function(i){i.preventDefault();i.stopImmediatePropagation();g.action.apply(this,[d.data,a(this)])})}else{h=(f?'<span class="'+f+'"></span> ':"");h+='<span class="ui-button-text">'+g.label+"</span>";a('<a href="#"></a>').css({display:"inline-block",marginBottom:"5px"}).appendTo(d.uiFooter).html(h).click(function(i){i.preventDefault();i.stopImmediatePropagation();g.action.apply(this,[d.data,a(this)])})}})}return d},_uiThumbnail:function(e){var d=this,f=d.options,g=e.thumbnail.replace(/64-64/g,"256-256")||e.thumbnailAlternate;if(g){d._loadImg(e,g)}return d},_loadImg:function(e,g){var d=this,f=d.options;a("<img />").error(function(){a(this).remove();if(g===e.thumbnail&&e.thumbnailAlternate){d._loadImg(e,e.thumbnailAlternate)}}).load(function(){var i=a(this),h=i.height();var k=a("<div></div>").addClass("nos-preview-thumb").css({backgroundImage:'url("'+i.attr("src")+'")',height:(h<=100?h:100)+"px"}).prependTo(d.uiContainer);var j=null;a.each(f.actions,function(){if(this.name==f.actionThumbnail){j=this}});if(j!==null){k.attr({title:j.label}).css({cursor:"pointer"}).click(function(l){l.preventDefault();l.stopImmediatePropagation();j.action.apply(this,[d.data])})}i.remove()}).css({position:"absolute",visibility:"hidden"}).attr("src",g).appendTo("body");return d},_uiMetaData:function(g){var d=this,h=d.options,e=0;var f=a('<table cellspacing="0" cellpadding="0" border="0"><tbody></tbody></table>').addClass("nos-preview-metadata wijmo-wijgrid-root wijmo-wijgrid-table").css({borderCollapse:"separate","-moz-user-select":"-moz-none"}).appendTo(d.uiContainer).find("tbody").addClass("ui-widget-content wijmo-wijgrid-data");a.each(h.meta,function(i,k){var j=a("<tr></tr>").addClass("wijmo-wijgrid-row ui-widget-content wijmo-wijgrid-datarow"+(e%2?" wijmo-wijgrid-alternatingrow":"")).appendTo(f);a("<th><div></div></th>").addClass("wijgridtd wijdata-type-string").appendTo(j).find("div").addClass("wijmo-wijgrid-innercell").text(k.label||"");a("<td><div></div></td>").addClass("wijgridtd wijdata-type-string").appendTo(j).find("div").addClass("wijmo-wijgrid-innercell").text(g[i]||"");e++});return d},unselect:function(){var d=this,e=d.options;d.element.wijsuperpanel("destroy").empty();d._uiHeader(e.texts.headerDefault);d.uiContainer=a("<div></div>").addClass("nos-preview-noitem").text(e.texts.selectItem).appendTo(d.element);d.element.wijsuperpanel({showRounder:false});return d},select:function(e){var d=this,f=d.options;if(e===b){return d.data}else{d.data=e;if(a.isFunction(f.dataParser)){e=f.dataParser(e)}d.element.wijsuperpanel("destroy").empty().css("height","100%");d._uiHeader(e.title);d.uiContainer=a("<div></div>").addClass("nos-preview-container").appendTo(d.element);d._uiThumbnail(e)._uiMetaData(e.meta)._uiFooter();d.element.wijsuperpanel({showRounder:false,autoRefresh:true})}return d},resize:function(){var d=this;d._init();return d}});return c});
define("jquery-nos-listgrid",["jquery","jquery-nos","jquery-ui.widget","wijmo.wijgrid"],function(a,b){a.widget("nos.noslistgrid",a.wijmo.wijgrid,{options:{loadingText:"Loading..."},_create:function(){var c=this;a.wijmo.wijgrid.prototype._create.call(c)},_init:function(){var e=this,f=e.options;if(a.isFunction(f.columnResized)){var c=f.columnResized}f.columnResized=function(i,g){var h=e.option("columns");a.extend(h[g.column.thX],{ensurePxWidth:true,width:g.column.width});e.setSize(e.outerDiv.parent().width());if(a.isFunction(c)){c.apply(this,arguments)}};if(a.isFunction(f.dataLoaded)){var d=f.ajaxError}f.ajaxError=function(k,g){var j=g.XMLHttpRequest;if(j.status==403){var i={title:"You've been inactive for too long",text:"Please log-in again.",type:"error"};try{var h=a.parseJSON(j.responseText);if(h.login_page){i.text=i.text.replace("log-in again",'<a href="'+h.login_page+'">log-in again</a>')}}catch(k){}b.notify(i)}if(a.isFunction(d)){d.apply(this,arguments)}};a.wijmo.wijgrid.prototype._init.call(e)}});return b});
define("jquery-nos-treegrid",["jquery","jquery-nos","jquery-ui.widget","jquery-nos-listgrid","wijmo.wijgrid","wijmo.wijdatasource"],function(a,c){var b=void (0);a.widget("nos.nostreegrid",a.nos.noslistgrid,{options:{treeUrl:"",treeOptions:null,treeColumnIndex:0,sortable:true,movable:true,data:[],preOpen:null},oldFirstColumn:null,treeData:{},treeDataSource:null,dragged:false,dropTarget:false,dragHelper:false,mousePressed:false,mouseMoved:false,timer:false,_create:function(){var e=this,g=e.options;if(a.isFunction(g.rendered)){var f=g.rendered}g.rendered=function(){if(a.isFunction(f)){f.apply(this,arguments)}e._dragInit()};if(a.isFunction(g.rowStyleFormatter)){var d=g.rowStyleFormatter}g.rowStyleFormatter=function(h){if(a.isFunction(d)){d.apply(this,arguments)}if(e.draggedIndex&&h.state&a.wijmo.wijgrid.renderState.hovered){h.$rows.removeClass("ui-state-hover")}};g.allowPaging=false;a.nos.noslistgrid.prototype._create.call(e)},_init:function(){var d=this,e=d.options;d.oldFirstColumn=a.extend(true,{},e.columns[e.treeColumnIndex]);e.columns[e.treeColumnIndex].cellFormatter=function(f){if(a.isPlainObject(f.row.data)){var h=f.$container.closest("tr"),g=f.row.data;if(f.column.dataKey){a("<span></span>").text(f.row.data[f.column.dataKey]).appendTo(f.$container)}else{if(a.isFunction(d.oldFirstColumn.cellFormatter)){d.oldFirstColumn.cellFormatter(f)}}if(g.treeChilds){a('<div class="nostreegrid-toggle"></div>').css({marginLeft:(g.treeLevel*20)+"px",cursor:"pointer"}).addClass("ui-icon").addClass(a.isPlainObject(g.treeChilds)?"ui-icon-triangle-1-se":"ui-icon-triangle-1-e").click(function(i){i.stopImmediatePropagation();if(a.isPlainObject(g.treeChilds)){d._toggle(h,false)}else{d._toggle(h,true)}}).prependTo(f.$container)}else{a('<div class="nostreegrid-toggle"></div>').css({marginLeft:(g.treeLevel*20)+"px"}).addClass("nos-icon16 nos-icon16-empty").prependTo(f.$container)}h.data("treeNode",g);return true}};if(e.movable){e.columns.unshift({allowSort:false,allowMoving:false,allowSizing:false,width:25,ensurePxWidth:true,cellFormatter:function(f){if(a.isPlainObject(f.row.data)){f.$container.append('<div class="ui-icon ui-icon-grip-dotted-vertical nostreegrid-move-handle"></div>');return true}}})}a.each(e.columns,function(){this.sortDirection="none"});a.nos.noslistgrid.prototype._init.call(d);d._activateSpinner();d._datasource();d.treeDataSource.proxy.options.data.deep=2;if(a.isPlainObject(e.preOpen)){d.treeDataSource.proxy.options.data.preOpen=e.preOpen}d.treeDataSource.load();e.preOpen=null;delete d.treeDataSource.proxy.options.data.preOpen},_setOption:function(e,f){var d=this;a.nos.noslistgrid.prototype._setOption.apply(d,arguments);if(e==="treeOptions"){d._datasource().reload()}},_datasource:function(){var d=this,e=d.options;d.treeDataSource=new wijdatasource({dynamic:true,proxy:new wijhttpproxy({url:e.treeUrl,dataType:"json",error:function(f,h,g){log(f,h,g)},data:e.treeOptions||{}}),loaded:function(k,h){var j=d.data(),g=function(l){return a.map(l,function(n,m){if(m==="length"){return null}var o=n;if(a.isPlainObject(n.treeChilds)){o=[n].concat(g(n.treeChilds))}return o})};if(!a.isPlainObject(h)){d.treeData=d._completeChilds(null,k.items);Array.prototype.splice.apply(j,[0,j.length].concat(g(d.treeData)))}else{var f=a.inArray(h.node,j);d._removeNode(h.node);if(h.close){h.node.treeChilds=k.data.total;Array.prototype.splice.apply(j,[f,0,h.node])}else{h.node.treeChilds=d._completeChilds(h.node,k.items);Array.prototype.splice.apply(j,[f,0,h.node].concat(g(h.node.treeChilds)))}}try{d.ensureControl(true)}catch(i){}d._deactivateSpinner()},reader:{read:function(f){f.items=f.data.items}}});return d},_dragInit:function(){var d=this,f=d.options;if(!f.movable){return d}d.element.find("tr.wijmo-wijgrid-row").each(function(){var i=a(this),h=i.data("treeNode"),j=i.find(".nostreegrid-move-handle");if(!d._trigger("movabled",null,{node:h,$tr:i})){return false}j.mousedown(function(l){if(l.which!=1){return true}l.stopImmediatePropagation();d.mousePressed=new Date().getTime();var k=i.clone();d.dragHelper=a('<div class="nostreegrid-drag-helper ui-state-highlight"></div>').hide().css("opacity","0.8").append(k.find("td:eq(1)").find(">div")).appendTo("body");d.helperInsert=a('<div class="nostreegrid-drag-inserthelper ui-state-highlight"></div>');a(document).on("mousemove",{treeGrid:d,node:h,$tr:i},d._dragStart).on("mouseup",{treeGrid:d},d._dragDestroy)});i.mouseup(function(){if(d.mousePressed&&d.mouseMoved&&d.dragged&&d.dropTarget){if(d._trigger("dropped",null,{dragged:d.dragged,dropped:i,notification:true})){d._move(i)}}d._dragDestroy()})});if(d.draggedIndex){var g=d.mousePressed,e=d.element.find("tr.wijmo-wijgrid-row").eq(d.draggedIndex);d._dragDestroy();e.find(".nostreegrid-move-handle").trigger(jQuery.Event("mousedown",{which:1}));d.mousePressed=g;d.dragOpen.event.target=d.element.find("tr.wijmo-wijgrid-row")[d.dragOpen.index];d.dragOpen.event.data.$tr=e;e.trigger(d.dragOpen.event)}return d},_dragStart:function(d){var r=d.data.treeGrid,f=r.options,g=d.data.node,l=d.data.$tr;if(!f.movable){return r}if(r.mousePressed&&(new Date().getTime()-r.mousePressed)>500){if(!r._scroller){r._scroller={superpanel:r._view()._scroller.data("wijsuperpanel")};var q=r._scroller.superpanel.getContentElement(),j=q.parent(),h=j.offset();r._scroller.contentElement=r._scroller.superpanel.getContentElement();r._scroller.contentWrapper=r._scroller.contentElement.parent();a.extend(r._scroller,r._scroller.contentElement.offset(),{bottom:h.top+j.height()})}if(d.pageY<r._scroller.top){r._scroller.superpanel._doScrolling("top",r._scroller.superpanel,true)}else{if(d.pageY<(r._scroller.top+20)){r._scroller.superpanel._doScrolling("top",r._scroller.superpanel)}else{if(d.pageY>r._scroller.bottom){r._scroller.superpanel._doScrolling("bottom",r._scroller.superpanel,true)}else{if(d.pageY>(r._scroller.bottom-20)){r._scroller.superpanel._doScrolling("bottom",r._scroller.superpanel)}}}}if(!r.mouseMoved){var k=a("body");if(k.css("cursor")){r._cursor=k.css("cursor")}k.css("cursor","move");r.mouseMoved=true}if(r.timer){clearTimeout(r.timer)}if(!r.dragHelper.is(":visible")){r.dragHelper.show();r.dragged=l;r.draggedIndex=l.data("wijgriddataItemIndex")}r.dragHelper.css({left:(d.pageX+5),top:(d.pageY+15)});l.css("visibility","hidden");r.dropTarget=false;var e=a(d.target).parents("tr:first");if(a(d.target).closest(r.element).size()&&(a(d.target).is("tr.wijmo-wijgrid-row")||a(d.target).parents("tr.wijmo-wijgrid-row").size())){var m=e.data("treeNode"),i=a.extend({width:e.width(),height:e.height()},e.offset()),n=e.find(".nostreegrid-toggle"),p=a.inArray(g.treeHash,m.treePath)!==-1;if(!p&&f.sortable&&d.pageY<(i.top+5)){r.dropTarget="before";e.removeClass("ui-state-hover");r.helperInsert.css({marginLeft:(parseInt(n.css("margin-left").replace("px",""))+n.width())+"px",marginBottom:""}).insertBefore(n)}else{if(!p&&f.sortable&&d.pageY>(i.top+i.height-5)){r.dropTarget="after";e.removeClass("ui-state-hover");r.helperInsert.css({marginLeft:(parseInt(n.css("margin-left").replace("px",""))+n.width())+"px",marginTop:""}).appendTo(e.find("td:eq(1)").find(">div"))}else{r.helperInsert.detach();if(p||!r._trigger("dropped",null,{dragged:l,dropped:e,notification:false})){e.removeClass("ui-state-hover")}else{r.dropTarget="in";if(a(d.target).hasClass("nostreegrid-toggle")&&a(d.target).hasClass("ui-icon-triangle-1-e")){r.timer=setTimeout(function(){r.dragOpen={event:d,index:e.data("wijgriddataItemIndex")};a(d.target).click()},700)}e.addClass("ui-state-hover")}}}}else{e.removeClass("ui-state-hover");r.dragHelper.hide();r.helperInsert.detach()}}return r},_dragDestroy:function(e){var d=e?e.data.treeGrid:this,f=d.options;if(!f.movable){return d}if(d.timer){clearTimeout(d.timer)}if(d.dragHelper){a(document).off("mousemove",d._dragStart).off("mouseup").off("mousedown");a("body").css("cursor",d._cursor||"auto");d.dragHelper.remove();d.helperInsert.remove();if(d.dragged){d.dragged.css("visibility","visible")}d.dragged=d.mousePressed=d.mouseMoved=d.dragHelper=d.timer=d._scroller=false}return d},_completeChilds:function(f,g){var e=this,d=0,h={};a.each(g,function(j,i){a.extend(i,{treeHash:i._model+"|"+i._id,treeLevel:!f?0:f.treeLevel+1,treePath:!f?[]:f.treePath.concat([f.treeHash])});if(a.isArray(i.treeChilds)||a.isPlainObject(i.treeChilds)){i.treeChilds=e._completeChilds(i,i.treeChilds)}d++;h[i.treeHash]=i});return a.extend({length:d},h)},_getTreeNode:function(f){var d=this,e=null;a.each(f,function(g,h){e=!e?d.treeData[h]:e.treeChilds[h]});return e},_move:function(h){var d=this,g=d.options,f=d.dragged.data("treeNode"),e=h.data("treeNode");a.ajax({async:true,url:g.treeUrl,data:{move:true,itemModel:f._model,itemId:f._id,targetModel:e._model,targetId:e._id,targetType:d.dropTarget},dataType:"json",success:function(m,n){if(m.success){d.draggedIndex=false;if(d.dropTarget==="in"){d._removeNode(f);d._toggle(h,true)}else{var j=d._getTreeNode(f.treePath),l=d._getTreeNode(e.treePath),i=a.inArray(l,d.data()),k=d.element.find("tr.wijmo-wijgrid-row").eq(i);d._removeNode(f);delete j.treeChilds[f.treeHash];delete j.treeChilds.length;j.treeChilds=d._completeChilds(j,j.treeChilds);d._toggle(k,true)}}if(m.error){c.notify(m.error,"error")}},error:function(i,k,j){log("error",k,j)}});return d},_toggle:function(g,e){var d=this,h=d.options,f=g.data("treeNode");e=e===b?g.hasClass("ui-icon-triangle-1-e"):e;g.find(".nostreegrid-toggle").addClass(e?"ui-icon-clock":"ui-icon-triangle-1-e").removeClass(e?"ui-icon-triangle-1-e":"ui-icon-triangle-1-se");d.treeDataSource.proxy.options.data.deep=e?1:-1;d.treeDataSource.proxy.options.data.id=f._id;d.treeDataSource.proxy.options.data.model=f._model;d.treeDataSource.load({close:e?false:true,node:f});return d},_removeNode:function(f){var d=this,e=false,h=0,g=d.data();a.each(g,function(k,l){var j=f.treeHash===l.treeHash||a.inArray(f.treeHash,l.treePath)!==-1;if(j){if(e===false){e=k}h++}if(!j&&e){return false}});if(e!==false){Array.prototype.splice.apply(g,[e,h])}return h},reload:function(){var d=this;d.treeDataSource.proxy.options.data.deep=2;delete d.treeDataSource.proxy.options.data.id;delete d.treeDataSource.proxy.options.data.model;d.treeDataSource.load();return d}});return c});
define("jquery-nos-thumbnailsgrid",["jquery","jquery-nos","jquery-ui.widget","wijmo.wijsuperpanel","wijmo.wijpager"],function(a,c){var b=void (0);a.widget("nos.thumbnailsgrid",{options:{thumbnailSize:128,pageIndex:0,pageSize:null,url:"",texts:{loading:"Loading..."},actions:[],loading:null,loaded:null,reader:null,dataParser:null,thumbFormatter:null},_data:null,_create:function(){var d=this;d.uiPager=a("<div></div>").addClass("wijmo-wijsuperpanel-footer  ui-state-default").appendTo(d.element)},destroy:function(){var d=this,e=d.options;d.uiPager.wijpager("destroy");d.uiPager.remove();d.element.removeClass("nos-thumbnailsgrid nos-thumbnailsgrid-size-"+e.thumbnailSize).wijsuperpanel("destroy");a.Widget.prototype.destroy.apply(this,arguments)},_init:function(){var e=this,g=e.options;if(a.inArray(g.thumbnailSize,[64,128])===-1){g.thumbnailSize=128}e.uiPager.wijpager({pageIndexChanging:function(i,h){e._trigger("pageIndexChanging",null,h);g.pageIndex=h.newPageIndex;e._load()},pageIndexChanged:function(i,h){e._trigger("pageIndexChanged");g.pageIndex=h.newPageIndex;e._load()}});e.element.addClass("nos-thumbnailsgrid nos-thumbnailsgrid-size-"+g.thumbnailSize).wijsuperpanel({showRounder:false,autoRefresh:true});e.uiContainer=a(e.element.wijsuperpanel("getContentElement"));e.uiOverlay=a("<div></div>").addClass("nos-thumbnailsgrid-overlay ui-widget-overlay").appendTo(e.element);e.uiOverlayText=a("<span><span></span>"+g.texts.loading+"</span>").addClass("nos-thumbnailsgrid-loadingtext ui-widget-content ui-corner-all").find("span").addClass("ui-icon ui-icon-clock").end().appendTo(e.element);e.uiOverlayText.css({marginLeft:(e.uiOverlayText.width()*-1/2)+"px",marginTop:(e.uiOverlayText.height()*-1/2)+"px"});if(g.pageSize===null){e._displayItem({title:"Test"});var f=e.uiContainer.find(".nos-thumbnailsgrid-thumb"),d=e.uiContainer.parent();e.itemDimension={width:f.outerWidth(true),height:f.outerHeight(true)};e.uiContainer.empty();g.pageSize=Math.floor(d.width()/e.itemDimension.width)*Math.max(1,Math.floor(d.height()/e.itemDimension.height))}e.dataSource=new wijdatasource({dynamic:true,proxy:new wijhttpproxy({url:g.url,dataType:"json",error:function(j,m,l){if(j.status==403){var i={title:"You've been inactive for too long",text:"Please log-in again.",type:"error"};try{var h=a.parseJSON(j.responseText);if(h.login_page){i.text=i.text.replace("log-in again",'<a href="'+h.login_page+'">log-in again</a>')}}catch(k){}c.notify(i)}e.uiOverlay.hide();log(j,m,l)},data:{}}),loading:function(i,h){i.proxy.options.data=a.extend(i.proxy.options.data,h.data);e.uiOverlay.add(e.uiOverlayText).show();if(a.isFunction(g.loading)){g.loading(i,h)}},loaded:function(i,h){if(a.isFunction(g.loaded)){g.loaded(i,h)}e.uiPager.wijpager("option",{pageCount:Math.ceil(i.data.totalRows/h.data.paging.pageSize),pageIndex:h.data.paging.pageIndex});e._data=i.data;e._display(i.data);e.uiOverlay.add(e.uiOverlayText).hide()},reader:g.reader});e._load()},_load:function(){var d=this,e=d.options;d.dataSource.load({data:{paging:{pageIndex:e.pageIndex,pageSize:e.pageSize}},afterRefresh:null,beforeRefresh:null});return d},_display:function(e){var d=this,g=d.options,f=d.uiContainer.empty().parent();d.uiContainer.detach();a.each(e,function(h){var j=this;if(a.isFunction(g.dataParser)){j={item:g.dataParser(g.thumbnailSize,j,h),noParseData:j}}else{j={item:j,noParseData:j}}d._displayItem(j,h)});d.uiContainer.appendTo(f);d._trigger("rendered");return d},_displayItem:function(i,j){var n=this,g=n.options,m=i.item,d=i.noParseData;m=a.extend({title:"",thumbnail:null,thumbnailAlternate:null},m);var f=a("<div></div>").addClass("nos-thumbnailsgrid-thumb wijmo-wijgrid ui-widget-content").data("thumbnail",{data:i,index:j}).appendTo(n.uiContainer),h=a('<table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td></td></tr></tbody></table>').addClass("nos-thumbnailsgrid-thumb-grid wijmo-wijgrid-root wijmo-wijgrid-table").attr("title",m.title).css({borderCollapse:"separate","-moz-user-select":"-moz-none"}).hover(function(){h.parent().addClass("ui-state-hover")},function(){h.parent().removeClass("ui-state-hover")}).click(function(){n.select(j)}).appendTo(f).find("tbody").addClass("ui-widget-content wijmo-wijgrid-data").find("tr").addClass("wijmo-wijgrid-row ui-widget-content wijmo-wijgrid-datarow").find("td").addClass("wijgridtd"),e=a("<div></div>").addClass("nos-thumbnailsgrid-thumb-container-img wijmo-wijgrid-innercell").appendTo(h),l=a("<div></div>").addClass("nos-thumbnailsgrid-thumb-title wijmo-wijgrid-innercell").text(m.title).appendTo(h);n._itemThumbnail(e,m,j);var k=c.appdeskActions(g.actions,d);k.appendTo(f);if(a.isFunction(g.thumbFormatter)){g.thumbFormatter({"$container":f,item:{data:m,index:j}})}return n},_itemThumbnail:function(d,g,f){var e=this,i=e.options,j=g.thumbnail||g.thumbnailAlternate,h=g.colour;if(h){e._loadColour(d,h)}else{if(j){e._loadImg(d,g,j)}else{e._loadImgDefault(d)}}return e},_loadImg:function(d,f,h){var e=this,g=e.options;a("<img />").error(function(){if(h===f.thumbnail&&f.thumbnailAlternate){e._loadImg(d,f,f.thumbnailAlternate)}else{e._loadImgDefault(d)}}).load(function(){var i=a(this);i.prependTo(d).css({marginTop:"-"+(i.height()/2)+"px",marginLeft:"-"+(i.width()/2)+"px"})}).addClass("nos-thumbnailsgrid-thumb-img").attr("src",h);return e},_loadImgDefault:function(d){var e=this,f=e.options;a("<div></div>").addClass("nos-thumbnailsgrid-thumb-img-default").prependTo(d);return e},_loadColour:function(d,f){var e=this;a(d).css("backgroundColor",f);return e},select:function(e){var d=this,h=d.options;if(e===b){var g=d.uiContainer.find(".nos-thumbnailsgrid-thumb:has(wijmo-wijgrid-current-cell)");if(g.length){var f=g.data("thumbnail");return f.index}return null}else{d.uiContainer.find("td").removeClass("wijmo-wijgrid-current-cell ui-state-highlight");var g=d.uiContainer.find(".nos-thumbnailsgrid-thumb").eq(e);if(g.length){var f=g.data("thumbnail");g.find(".wijgridtd").eq(0).addClass("wijmo-wijgrid-current-cell ui-state-highlight");d._trigger("selectionChanged",null,{item:f})}else{d._trigger("selectionChanged");return false}}return d},unselect:function(){this._trigger("selectionChanged")},setSize:function(f,d){var e=this;if(f!==null){e.element.width(f)}if(d!==null){e.element.height(d)}return e},data:function(){return this._data}});return c});
define("jquery-nos-appdesk",["jquery","jquery-nos","jquery-ui.widget","jquery-nos-thumbnailsgrid","jquery-nos-listgrid","jquery-nos-treegrid","jquery-nos-preview","jquery-ui.button","wijmo.wijdropdown","wijmo.wijtabs","wijmo.wijsuperpanel","wijmo.wijsplitter","wijmo.wijgrid","wijmo.wijmenu"],function(a,c){var b=void (0);a.widget("nos.appdesk",{options:{adds:[],inspectors:[],thumbnails:false,defaultView:"grid",locales:{},hideLocales:false,texts:{allLanguages:"All",addDropDown:"Select an action",columns:"Columns",showFiltersColumns:"Filters column header",visibility:"Visibility",settings:"Settings",vertical:"Vertical",horizontal:"Horizontal",hidden:"Hidden",save:"Save",cancel:"Cancel",mainView:"Main view",item:"item",items:"items",showNbItems:"Showing {{x}} items out of {{y}}",showOneItem:"Show 1 item",showNoItem:"No item",showAll:"Show all items",views:"Views",viewGrid:"Grid",viewTreeGrid:"Tree grid",viewThumbnails:"Thumbnails",loading:"Loading..."},values:{},columnVisibilityChange:null,slidersChange:null,splitters:{vertical:null,horizontal:null},views:{},selectedView:null,selectedLang:null,fromView:null,name:null,grid:{}},pageIndex:0,showFilter:false,gridRendered:false,resizing:true,init:false,itemSelected:null,variantColumnsProperties:{visible:true,width:true,showFilter:true},variantInspectorsProperties:{hide:true,vertical:true},_create:function(){var d=this,e=d.options;d.element.addClass("nos-appdesk");d.dispatcher=d.element.closest(".nos-dispatcher");if(!d.dispatcher.size()){d.dispatcher=d.element}d.uiHeaderBar=a("<div></div>").addClass("nos-appdesk-headerbar").appendTo(d.element);d.uiAdds=a("<div></div>").addClass("nos-appdesk-adds").appendTo(d.uiHeaderBar);d.uiAddsButton=a('<button type="button"></button>').addClass("primary").appendTo(d.uiAdds);d.uiViewsDropDownContainer=a("<div></div>").addClass("nos-appdesk-dropdownviews").appendTo(d.uiHeaderBar);d.uiLangsDropDownContainer=a("<div></div>").addClass("nos-appdesk-dropdownlang").appendTo(d.uiHeaderBar);d.uiSplitterVertical=a("<div></div>").addClass("nos-appdesk-splitter-v").appendTo(d.element);d.uiSplitterVerticalRight=a("<div></div>").appendTo(d.uiSplitterVertical);d.uiInspectorsVertical=a("<ul></ul>").addClass("nos-appdesk-inspectors nos-appdesk-inspectors-v").appendTo(d.uiSplitterVerticalRight);d.uiSplitterVerticalLeft=a("<div></div>").appendTo(d.uiSplitterVertical);d.uiSplitterHorizontal=a("<div></div>").appendTo(d.uiSplitterVerticalLeft);d.uiSplitterHorizontalTop=a("<div></div>").appendTo(d.uiSplitterHorizontal);d.uiInspectorsHorizontal=a("<ul></ul>").addClass("nos-appdesk-inspectors nos-appdesk-inspectors-h").appendTo(d.uiSplitterHorizontalTop);d.uiSplitterHorizontalBottom=a("<div></div>").appendTo(d.uiSplitterHorizontal);d.uiSearchBar=a("<div><form><div></div></form></div>").addClass("nos-appdesk-searchbar-container wijmo-wijgrid ui-widget ui-widget-header ui-state-default").appendTo(d.uiSplitterHorizontalBottom).find("form").addClass("wijmo-wijgrid-headerrow wijmo-wijgrid-innercell").find("div").addClass("nos-appdesk-searchbar wijmo-wijgrid-headertext");d.uiNbResult=a("<div></div>").addClass("nos-appdesk-nbresult").appendTo(d.uiSearchBar);d.uiInputContainer=a("<div></div>").addClass("nos-appdesk-input-container ui-widget-content ui-corner-all").appendTo(d.uiSearchBar);d.uiViewsButtons=a("<div></div>").addClass("nos-appdesk-views-button").appendTo(d.uiSearchBar);d.uiSearchIcon=a("<div></div>").addClass("nos-appdesk-search-icon ui-icon ui-icon-search").appendTo(d.uiInputContainer);d.uiSearchInput=a('<input type="search" name="search" placeholder="Search" value="" />').addClass("nos-appdesk-search-input ui-helper-reset").appendTo(d.uiInputContainer);d.uiInspectorsTags=a("<div></div>").addClass("nos-appdesk-inspectorstags").appendTo(d.uiInputContainer);d.uiResetSearch=a('<a href="#"></a>').text(e.texts.showAll).addClass("nos-appdesk-reset-search").appendTo(d.uiInputContainer);d.uiuiResetSearchIcon=a("<span></span>").text(e.texts.showAll).addClass("ui-icon").appendTo(d.uiResetSearch);d.uiGridTitle=a("<div></div>").addClass("nos-appdesk-title").appendTo(d.uiSearchBar);d.uiPaginationLabel=a("<span></span>").addClass("nos-appdesk-pagination");d.uiGrid=a("<table></table>").appendTo(d.uiSplitterHorizontalBottom);d.uiTreeGrid=a("<table></table>").appendTo(d.uiSplitterHorizontalBottom);d.uiThumbnail=a("<div></div>").appendTo(d.uiSplitterHorizontalBottom)},_init:function(){var d=this,e=d.options;if(!a.isPlainObject(e.thumbnails)){e.thumbnails=false}else{e.thumbnails=a.extend({thumbnailSize:128},e.thumbnails)}if(!a.isEmptyObject(e.locales)){if(e.selectedLang&&e.selectedLang.length){e.selectedLang=null}if(e.selectedLang==null){e.selectedLang=Object.keys(e.locales)[0]}}d._css()._uiAdds()._uiSplitters()._uiInspectors()._uiSearchBar()._uiList()._uiLangsDropDown()._uiViewsDropDown();d.init=true},_css:function(){var l=this,e=l.options;if(!a("style#inspectorsGrid").length){var g="";for(var j=0,f=document.styleSheets.length;j<f;j++){var h=document.styleSheets[j];if(h.href&&/wijmo/.test(h.href)){var i=h.rules?h.rules:h.cssRules;for(var d=0,k=i.length;d<k;d++){if(i[d].selectorText===".ui-widget-content"){g+=".nos-appdesk .nos-appdesk-splitter-v .wijmo-wijsplitter-v-panel2 .wijmo-wijsplitter-h-panel1 .wijmo-wijgrid-alternatingrow {background:"+i[d].style.background+";}";g+=".nos-appdesk .nos-appdesk-splitter-v .wijmo-wijsplitter-v-panel1 .wijmo-wijgrid-alternatingrow {background:"+i[d].style.background+";}"}if(i[d].selectorText===".wijmo-wijgrid tr.wijmo-wijgrid-row.ui-state-hover, .wijmo-wijgrid .wijmo-wijgrid-current-cell, .wijmo-wijgrid td.wijmo-wijgrid-rowheader.ui-state-active"){g+=".nos-appdesk .nos-appdesk-splitter-v .wijmo-wijsplitter-v-panel2 .wijmo-wijsplitter-h-panel1 .wijmo-wijgrid-alternatingrow.ui-state-hover {background:"+i[d].style.background+";}";g+=".nos-appdesk .nos-appdesk-splitter-v .wijmo-wijsplitter-v-panel1 .wijmo-wijgrid-alternatingrow.ui-state-hover {background:"+i[d].style.background+";}"}}}}a('<style type="text/css" id="inspectorsGrid">'+g+"</style>").appendTo("head")}return l},_uiAdds:function(){var d=this,f=d.options;if(!a.isArray(f.adds)||!f.adds.length){d.uiAdds.hide();return d}var e=f.adds.shift();d.uiAddsButton.button({label:e.label,icons:{primary:"ui-icon ui-icon-plus",secondary:null}}).click(function(g){g.preventDefault();g.stopImmediatePropagation();if(a.isFunction(e.action)){e.action(a(this),{lang:f.selectedLang})}else{c(this).tab("add",{iframe:true,url:e.url,label:e.label})}});a.each(f.adds,function(g,h){a('<a href="#"></a>').addClass("nos-appdesk-action-secondary").text(this.label).appendTo(d.uiAdds).click(function(i){i.preventDefault();i.stopImmediatePropagation();if(a.isFunction(h.action)){h.action(a(this),{lang:f.selectedLang})}else{c(this).tab("add",{iframe:true,url:h.url,label:h.label})}})});return d},_uiLangsDropDown:function(){var d=this,h=d.options;if(h.hideLocales){d.uiLangsDropDownContainer.hide();return d}if(a.isEmptyObject(h.locales)){return d}if(h.selectedLang&&h.selectedLang.length){h.selectedLang=null}if(h.selectedLang==null){var g=true;a.each(h.locales,function(j,i){if(g){h.selectedLang=j;g=false}})}var e=new Date();var f=e.getDate()+"_"+e.getHours()+"_"+e.getMinutes()+"_"+e.getSeconds()+"_"+e.getMilliseconds();a.each(h.locales,function(k,i){var j=k.split("_")[1].toLowerCase();d.uiLangsDropDownContainer.append(a('<input type="radio" name="'+f+'" id="'+k+"_"+f+'" value="'+k+'" '+(h.selectedLang==k?"checked":"")+'/> <label for="'+k+"_"+f+'" title="'+i+'"><img src="static/novius-os/admin/novius-os/img/flags/'+j+'.png" /></label>'))});d.uiLangsDropDownContainer.append(a('<input type="radio" name="'+f+'" id="all_'+f+'" value="" '+(h.selectedLang==""?"checked":"")+'/> <label for="all_'+f+'">'+h.texts.allLanguages+"</label>"));d.uiLangsDropDownContainer.buttonset();d.uiLangsDropDownContainer.find("input[name="+f+"]").change(function(){var i=c(this);h.selectedLang=i.val();i.xhr("saveUserConfig",h.name+".selectedLang",h.selectedLang);d.gridReload();d.dispatcher.data("nosLang",h.selectedLang).trigger("langChange")}).filter(function(){return a(this).val()==h.selectedlang});return d},_uiViewsDropDown:function(){var d=this,e=d.options;if(e.views[e.selectedView]&&e.views[e.selectedView].virtual){return d}d.uiViewsDropDown=a("<select></select>").appendTo(d.uiViewsDropDownContainer);a.each(e.views,function(g,f){if(f.virtual){return}d.uiViewsDropDown.append(a("<option></option>").attr({value:g,selected:(e.selectedView==g)}).append(f.name))});d.uiViewsDropDown.append(a("<option></option>").attr({value:"custom",selected:(e.selectedView=="custom")}).append("Custom view"));d.uiViewsDropDown.append(a("<option></option>").attr("value","edit_custom").append("Edit custom view"));d.uiViewsDropDown.wijdropdown();d.uiViewsDropDown.change(function(){var g=c(this);if(g.val()=="edit_custom"){var f=d._uiCustomViewDialog();d.uiCustomViewDialog=c(d.uiViewsDropDown).dialog({title:e.texts.settings,contentUrl:null,content:f,onLoad:function(){f.css({height:"90%"});f.wijtabs({alignment:"left",scrollable:true,show:function(i,h){a(h.panel).find(".superpanel").wijsuperpanel({autoRefresh:true,hScroller:{scrollMode:"buttons"}});var j=a(h.panel).find("#layout_settings");d._uiCustomViewDialogRefreshLayout(j);j.find(".panels").sortable({connectWith:".panels",update:function(){d._uiCustomViewDialogRefreshLayout(j)},change:function(){d._uiCustomViewDialogRefreshLayout(j)},start:function(k,l){a(l.item).addClass("moving");d._uiCustomViewDialogRefreshLayout(j)},stop:function(k,l){a(l.item).removeClass("moving");d._uiCustomViewDialogRefreshLayout(j)},placeholder:"droping"});d._uiCustomViewDialogRefreshColumns(a(h.panel).find(".columns-settings"))}});f.after(a("<div></div>").css({textAlign:"right"}).append(a("<button />").button({label:e.texts.cancel,icons:{primary:"ui-icon-gear"}}).click(function(){d.uiCustomViewDialog.dialog("close")})).append(a("<button />").button({label:e.texts.save,icons:{primary:"ui-icon-gear"}}).click(function(){d._uiCustomViewDialogSave();d.uiCustomViewDialog.dialog("close")})))}});g.find("option").attr("selected","");g.find("option[value=custom]").attr("selected","selected");g.wijdropdown("refresh");g.xhr("saveUserConfig",e.name+".selectedView",a(this).val())}else{g.xhr("saveUserConfig",e.name+".selectedView",a(this).val());d.element.trigger("reloadView",{selectedView:a(this).val()})}});return d},_uiCustomViewDialog:function(){var d=this,f=d.options,e=a("<div><ul></ul></div>");d._uiCustomViewDialogAddLayoutTab(e);d._uiCustomViewDialogAddMainViewTab(e);d._uiCustomViewDialogAddInspectorsTab(e);return e},_uiCustomViewDialogAddMainViewTab:function(e){var d=this,f=d.options;d._uiCustomViewDialogAddItem(e,f.texts.mainView,d._uiCustomViewDialogGetWidgetContentSettings("settings-main-view",f.texts.mainView,d.options));e.find(" > ul > li:last").addClass("separator")},_uiCustomViewDialogAddInspectorsTab:function(f){var d=this,g=d.options;for(var e=0;e<g.inspectors.length;e++){d._uiCustomViewDialogAddItem(f,g.inspectors[e].label,d._uiCustomViewDialogGetWidgetContentSettings("settings-inspector-"+e,g.inspectors[e].label,g.inspectors[e]))}},_uiCustomViewDialogGetWidgetContentSettings:function(d,k,f){var n=this,e=n.options;var h=a('<div class="content-settings columns-settings"></div>').attr({id:d});h.append(a("<h1></h1>").append(k));if(f.grid){h.append(a("<h2></h2>").append("Columns"));var l=a('<ul class="widget-columns"></ul>');var g=f.grid.columns;var j;for(j=0;j<g.length;j++){if(g[j].visible!==false){l.append(a('<li style="float: left;"></li>').data("column-id",j).append(a('<div class="title-zone"></div>').append(g[j].headerText)))}}h.append(l);h.append(a("<h2></h2>").append("Invisible columns"));var m=a('<ul class="not-columns widget-columns"></ul>');for(j=0;j<g.length;j++){if(g[j].visible===false){m.append(a('<li style="float: left;"></li>').data("column-id",j).append(a('<div class="title-zone"></div>').append(g[j].headerText)))}}h.append(m);h.find(".widget-columns").sortable({placeholder:"placeholder",connectWith:".widget-columns",update:function(){n._uiCustomViewDialogRefreshColumns(a(this).parent())},change:function(){n._uiCustomViewDialogRefreshColumns(a(this).parent())},start:function(i,o){a(o.item).addClass("moving");n._uiCustomViewDialogRefreshColumns(a(this).parent())},stop:function(i,o){a(o.item).removeClass("moving");n._uiCustomViewDialogRefreshColumns(a(this).parent())}})}return h},_uiCustomViewDialogRefreshColumns:function(d){var e=d.find("ul");e.each(function(){var f=a(this).find("li").not(".moving");f.removeClass("last");f.last().addClass("last");f.css({width:(a(this).width()/f.length)-1})})},_uiCustomViewDialogAddLayoutTab:function(q){var p=this,g=p.options;var d=a('<form id="layout_settings"></form>');d.append(a("<h1></h1>").append("Layout"));d.append(a('<div class="layout"></div>').append(a('<ul class="left-panel panels"></ul>')).append(a('<div class="right-side"></div>').append(a('<div class="inside"></div>').append(a('<ul class="top-panel panels"></ul>')).append(a('<div class="content"></div>')))));var e=a('<div class="not-layout superpanel"></div>').append('<ul class="invisible-panel panels"></ul>');p._uiCustomViewDialogAddItem(q,"Layout",d);var f=d.find(".left-panel");var h=d.find(".top-panel");var n=e.find(".invisible-panel");d.find(".not-layout").wijsuperpanel({hScroller:{scrollMode:"buttons"}});for(var m=0;m<g.inspectors.length;m++){var j=!g.inspectors[m].hide;var k=g.inspectors[m].vertical;var l=a('<li class="layout-inspector"></li>').data("inspector-id",m).append(a("<div></div>").append(g.inspectors[m].label));if(j){if(k){f.append(l)}else{h.append(l)}}else{n.append(l)}}d.append(e);p._uiCustomViewDialogRefreshLayout(d)},_uiCustomViewDialogRefreshLayout:function(j){var f=j.find(".left-panel"),e=j.find(".top-panel"),d=j.find(".invisible-panel"),h=f.find("li").not(".moving");h.css({height:(f.height()-h.length)/h.length,width:""});h.removeClass("last");a(h[h.length-1]).addClass("last");var i=e.find("li").not(".moving");i.css({width:(e.width()-i.length)/i.length,height:""});i.removeClass("last");a(i[i.length-1]).addClass("last");var g=d.find("li").not(".moving");g.css({width:"",height:""});g.removeClass("last");a(g[g.length-1]).addClass("last");d.css({width:Math.max((g.length+1)*(g.width()+1),100)})},_uiCustomViewDialogSave:function(){var d=this,k=d.options;for(var e=0;e<k.inspectors.length;e++){if(k.inspectors[e].grid){var i=k.inspectors[e].grid.columns;var l=[];k.inspectors[e].grid.columnsOrder=[];d.uiCustomViewDialog.find("#settings-inspector-"+e+" > ul li").each(function(j,m){var o=a(this);var n=i[o.data("column-id")];n.visible=!o.closest("ul").hasClass("not-columns");l.push(n);k.inspectors[e].grid.columnsOrder.push(n.setupkey)});k.inspectors[e].grid.columns=l}}k.inspectorsOrder=[];var h=[];var g=d.uiCustomViewDialog.find("#layout_settings");g.find(".layout-inspector").each(function(){var j=d.options.inspectors[a(this).data("inspector-id")];var m=a(this).closest(".panels");j.hide=m.hasClass("invisible-panel");j.vertical=m.hasClass("left-panel");h.push(j);k.inspectorsOrder.push(j.setupkey)});d.options.inspectors=h;l=[];k.grid.columnsOrder=[];d.uiCustomViewDialog.find("#settings-main-view > ul li").each(function(j,m){var o=a(this),n=k.grid.columns[o.data("column-id")];k.grid.columnsOrder.push(n.setupkey);n.visible=!o.closest("ul").hasClass("not-columns");l.push(n)});d.options.grid.columns=l;d.element.find(".nos-appdesk-inspector").remove();var f=d._saveUserConfiguration();d.element.trigger("reloadView",{selectedView:"custom",custom:f})},_uiCustomViewDialogAddItem:function(d,f,e){if(typeof this.idMenu=="undefined"){this.idMenu=0}d.find("> ul").append('<li><a href="#settings_menu_popup_item_'+this.idMenu+'">'+f+"</a></li>");d.append(a('<div id="settings_menu_popup_item_'+this.idMenu+'"></div>').append(e));this.idMenu++},_saveUserConfiguration:function(){var d=this,f=d.options,e={from:f.selectedView!="custom"?f.selectedView:f.fromView,appdesk:d._getInspectorsConfiguration(f)};e.appdesk.grid=d._getGridConfiguration(f.grid);d.element.nos().xhr("saveUserConfig",f.name,{selectedView:"custom",custom:e});return e},_getGridConfiguration:function(f){var e={columns:{},columnsOrder:f.columnsOrder.join(",")};var g=this._getParameters(f.columns,this.variantColumnsProperties);for(var d=0;d<f.columns.length;d++){e.columns[f.columns[d].setupkey]=g[d]}return e},_getInspectorsConfiguration:function(d){var g={inspectors:{},inspectorsOrder:d.inspectorsOrder.join(",")};var f=this._getParameters(d.inspectors,this.variantInspectorsProperties);for(var e=0;e<this.options.inspectors.length;e++){if(!f[e]["vertical"]){f[e]["vertical"]=false}g.inspectors[d.inspectors[e].setupkey]=f[e];if(this.options.inspectors[e]["grid"]){g.inspectors[d.inspectors[e].setupkey]["grid"]=this._getGridConfiguration(this.options.inspectors[e]["grid"])}}return g},_getParameters:function(j,h){var d=[];for(var g=0;g<j.length;g++){var f={};for(var e in j[g]){if(h[e]){f[e]=j[g][e]}}d.push(f)}return d},_uiSplitters:function(){var f=this,h=function(){f.uiSplitterHorizontal.wijsplitter("refresh");f._resizeInspectorsV(true)._resizeInspectorsH(true)._resizeList(true)},d=function(){f._resizeInspectorsH(true)._resizeList(true)},g=a.extend(true,{orientation:"vertical",splitterDistance:200,showExpander:false,fullSplit:false,panel1:{minSize:150,scrollBars:"none"},panel2:{minSize:200,scrollBars:"none"},expanded:function(){h()},collapsed:function(){h()},sized:function(){f.resizing=true;h()}},f.options.splitters.vertical),e=a.extend(true,{orientation:"horizontal",fullSplit:true,splitterDistance:200,showExpander:false,panel1:{minSize:200,scrollBars:"none"},panel2:{minSize:200,scrollBars:"none"},expanded:function(){d()},collapsed:function(){d()},sized:function(){f.resizing=true;d()}},f.options.splitters.horizontal);f.uiSplitterVertical.wijsplitter(g).find(".ui-resizable-handle").mousedown(function(){f.resizing=false});f.uiSplitterHorizontal.wijsplitter(e).find(".ui-resizable-handle").mousedown(function(){f.resizing=false});return f},_uiInspectors:function(){var d=this,e=d.options;a.each(e.inspectors,function(){if(!this.hide){a("<li></li>").addClass("nos-appdesk-inspector ui-widget-content").data("inspector",this).appendTo(this.vertical?d.uiInspectorsVertical:d.uiInspectorsHorizontal)}});d._resizeInspectorsV(true)._resizeInspectorsH(true);d.uiInspectorsVertical.find("> li").add(d.uiInspectorsHorizontal.find("> li")).each(function(){d._loadInspector(a(this))});return d},_loadInspector:function(g){var d=this,f=g.data("inspector"),e=d.options;f.selectionChanged=function(l,j){var h=false,i=f.inputName;if(f.inputName.substr(-2,2)==="[]"){i=f.inputName.substr(0,f.inputName.length-2);h=true}if(!h){d.uiInspectorsTags.find("span."+i).remove()}else{var m=false;d.uiInspectorsTags.find("span."+i).each(function(){if(a(this).find("input").val()===l){m=true;return false}});if(m){return true}}d.pageIndex=0;d.uiInspectorsTags.wijsuperpanel("destroy");var k=a("<span></span>").addClass("nos-appdesk-inspectorstag ui-state-default ui-corner-all "+i).text(j).appendTo(d.uiInspectorsTags);a('<input type="hidden" name="'+f.inputName+'" />').val(l).appendTo(k);a('<a href="#"></a>').addClass("ui-icon ui-icon-close").click(function(n){n.preventDefault();a(this).parent().remove();d.gridReload()}).appendTo(k);d.uiInspectorsTags.wijsuperpanel({showRounder:false,hScroller:{scrollMode:"buttons"}});if(e.defaultView==="treeGrid"){d.uiViewsButtons.find("#view_grid").click().blur()}else{d.gridReload()}};g.data("inspector",f);if(a.isFunction(f.url)){f.url.call(d,g)}else{a.ajax({url:f.url,dataType:"html"}).done(function(h){a(h).appendTo(g)}).fail(function(h,j,i){log("error");log(j);log(i)})}return d},_uiSearchBar:function(){var e=this,f=e.options;e.uiResetSearch.hide();e.uiSearchInput.on("keypress",function(g){var h=a.ui.keyCode;e.pageIndex=0;if(e.timeoutSearchInput){clearTimeout(e.timeoutSearchInput)}if(a.inArray(g.keyCode,[h.ENTER,h.NUMPAD_ENTER])!=-1){if(f.defaultView==="treeGrid"){e.uiViewsButtons.find("#view_grid").click().blur()}else{e.gridReload()}return false}e.timeoutSearchInput=setTimeout(function(){if(f.defaultView==="treeGrid"){e.uiViewsButtons.find("#view_grid").click().blur()}else{e.gridReload()}},500)});e.uiResetSearch.click(function(g){g.preventDefault();e.uiSearchInput.val("");e.uiInspectorsTags.wijsuperpanel("destroy");e.uiInspectorsTags.empty();e.gridReload()});e.uiInspectorsTags.height(e.uiInputContainer.height()).width(parseInt(e.uiSearchBar.width()*0.3)).wijsuperpanel({showRounder:false,hScroller:{scrollMode:"buttons"}});var d=[{id:"treeGrid",text:f.texts.viewTreeGrid,icon:"view-tree"},{id:"grid",text:f.texts.viewGrid,icon:"view-list"},{id:"thumbnails",size:64,text:f.texts.viewThumbnails,icon:"view-thumbs-small"},{id:"thumbnails",size:128,text:f.texts.viewThumbnails,icon:"view-thumbs-big"}];a.each(d,function(){var g=this;if(f[g.id]){a('<label for="view_'+g.id.toLowerCase()+(g.size?"_"+g.size:"")+'"></label>').text(g.text+(g.size?" "+g.size+"px":"")).appendTo(e.uiViewsButtons);a('<input type="radio" id="view_'+g.id.toLowerCase()+(g.size?"_"+g.size:"")+'" name="view" '+(f.defaultView===g.id&&(!g.size||g.size===f.thumbnails.thumbnailSize)?'checked="checked"':"")+'" />').appendTo(e.uiViewsButtons).button({text:false,label:g.text+(g.size?" "+g.size+"px":""),icons:{primary:"ui-icon "+g.icon,secondary:null}}).click(function(){if(f.defaultView!==g.id||(g.id==="thumbnails"&&f.thumbnails.thumbnailSize!==g.size)){e.uiViewsButtons.find("button").removeClass("ui-state-active");a(this).addClass("ui-state-active");f.defaultView=g.id;if(g.size){f.thumbnails.thumbnailSize=g.size}e._uiList()}})}});if(e.uiViewsButtons.find("input").length>1){e.uiViewsButtons.buttonset()}else{e.uiViewsButtons.hide()}return e},_uiList:function(){var d=this,e=d.options;d.gridRendered=false;d.uiGridTitle.text(e.texts.item);d.uiThumbnail.thumbnailsgrid("destroy").empty().hide();d.uiGrid.noslistgrid("destroy").empty().hide();d.uiTreeGrid.nostreegrid("destroy").empty().hide();if(e.defaultView==="thumbnails"){d.uiThumbnail.show();d._uiThumbnail()}else{if(e.defaultView==="treeGrid"){d.uiTreeGrid.show();d._uiTreeGrid()}else{d.uiGrid.show();d._uiGrid()}}return d},_uiGrid:function(){var f=this,i=f.options,e=f.uiGrid.offset(),g=f.element.offset(),d=f.element.height()-e.top+g.top,h=c.grid.getHeights();f.uiGrid.css({height:d,width:"100%"}).noslistgrid(a.extend({columnsAutogenerationMode:"none",selectionMode:"singleRow",showFilter:f.showFilter,allowSorting:true,scrollMode:"auto",allowPaging:true,pageIndex:f.pageIndex,pageSize:Math.floor((d-h.footer-h.header-(f.showFilter?h.filter:0))/h.row),allowColSizing:true,allowColMoving:true,data:new wijdatasource({dynamic:true,proxy:new wijhttpproxy({url:i.grid.proxyUrl,dataType:"json",error:function(j,l,k){log(j,l,k)},data:{}}),loading:function(l,j){var k=j.data.paging;f.pageIndex=k.pageIndex;if(f.gridRendered){f.uiGrid.noslistgrid("currentCell",-1,-1)}l.proxy.options.data.lang=i.selectedLang||"";l.proxy.options.data.inspectors=f._jsonInspectors();l.proxy.options.data.offset=k.pageIndex*k.pageSize;l.proxy.options.data.limit=k.pageSize},loaded:function(k,j){if(k.data.totalRows===0){f.uiPaginationLabel.text(i.texts.showNoItem);f.uiNbResult.text(i.texts.showNoItem)}else{if(k.data.totalRows===1){f.uiPaginationLabel.text(i.texts.showOneItem);f.uiNbResult.text("1 "+i.texts.item)}else{f.uiPaginationLabel.text(i.texts.showNbItems.replace("{{x}}",k.data.length).replace("{{y}}",k.data.totalRows));f.uiNbResult.text(k.data.totalRows+" "+i.texts.items)}}f.uiNbResult.show();f.uiResetSearch[f.uiInspectorsTags.find(".nos-appdesk-inspectorstag").length||f.uiSearchInput.val()?"show":"hide"]()},reader:{read:function(k){var j=parseInt(k.data.total,10);k.data=k.data.items;k.data.totalRows=j}}}),pageIndexChanging:function(){f.element.trigger("selectionChanged.appdesk",false)},cellStyleFormatter:function(j){if(j.$cell.is("th")){j.$cell.removeClass("ui-state-active")}if(j.state&a.wijmo.wijgrid.renderState.selected&&j.$cell.hasClass("ui-state-default")){j.$cell.removeClass("ui-state-highlight")}if(j.state&a.wijmo.wijgrid.renderState.selected){j.$cell.removeClass("wijmo-wijgrid-current-cell")}},currentCellChanging:function(){return f.gridRendered},currentCellChanged:function(k){if(k){var l=a(k.target).noslistgrid("currentCell").row(),j=l?l.data:false;if(j){f.itemSelected=a.extend({},j);f.element.trigger("selectionChanged.appdesk",j)}}return true},rendering:function(){f.gridRendered=false},rendered:function(){f.gridRendered=true;f.uiGrid.css("height","auto");var j=f.uiGrid.noslistgrid("selection");j&&j.clear();if(f.itemSelected!==null){a.each(f.uiGrid.noslistgrid("data")||[],function(k,l){if(l._model==f.itemSelected._model&&l._id==f.itemSelected._id){j.addRows(k)}})}},dataLoading:function(j){f.uiPaginationLabel.detach()},loaded:function(){f.uiSplitterHorizontalBottom.find(".wijmo-wijgrid-footer").prepend(f.uiPaginationLabel)}},i.grid));return f},_uiTreeGrid:function(){var f=this,h=f.options,e=f.uiTreeGrid.offset(),g=f.element.offset(),d=f.element.height()-e.top+g.top;f.uiTreeGrid.css({height:d,width:"100%"}).nostreegrid(a.extend(true,{treeUrl:h.treeGrid.proxyUrl,treeOptions:{lang:h.selectedLang||""},columnsAutogenerationMode:"none",selectionMode:"singleRow",allowSorting:true,scrollMode:"auto",allowColSizing:true,allowColMoving:true,sorting:function(j,i){a.each(h.grid.columns,function(){var k=this;if(k.headerText===i.column.headerText){k.sortDirection=i.sortDirection}else{k.sortDirection="none"}});f.uiViewsButtons.find("#view_grid").click().blur();return false},cellStyleFormatter:function(i){if(i.$cell.is("th")){i.$cell.removeClass("ui-state-active")}if(i.state&a.wijmo.wijgrid.renderState.selected&&i.$cell.hasClass("ui-state-default")){i.$cell.removeClass("ui-state-highlight")}if(i.state&a.wijmo.wijgrid.renderState.selected){i.$cell.removeClass("wijmo-wijgrid-current-cell")}},currentCellChanging:function(){return f.gridRendered},currentCellChanged:function(j){if(j){var k=a(j.target).nostreegrid("currentCell").row(),i=k?k.data:false;if(i){f.itemSelected=a.extend({},i);f.element.trigger("selectionChanged.appdesk",i)}}return true},rendering:function(){f.gridRendered=false},rendered:function(){f.gridRendered=true;f.uiTreeGrid.css("height","auto");var i=f.uiTreeGrid.nostreegrid("selection");i&&i.clear();if(f.itemSelected!==null){a.each(f.uiTreeGrid.nostreegrid("data")||[],function(j,k){if(k._model==f.itemSelected._model&&k._id==f.itemSelected._id){i.addRows(j)}})}},dataLoading:function(i){f.uiPaginationLabel.detach()},loaded:function(){f.uiSplitterHorizontalBottom.find(".wijmo-wijgrid-footer").prepend(f.uiPaginationLabel)}},h.grid));return f},_uiThumbnail:function(){var f=this,h=f.options,e=f.uiThumbnail.offset(),g=f.element.offset(),d=f.element.height()-e.top+g.top;f.uiThumbnail.css("height",d).thumbnailsgrid(a.extend({pageIndex:0,url:h.grid.proxyUrl,loading:function(k,i){var j=i.data.paging;f.pageIndex=j.pageIndex;k.proxy.options.data.lang=h.selectedLang||"";k.proxy.options.data.inspectors=f._jsonInspectors();k.proxy.options.data.offset=j.pageIndex*j.pageSize;k.proxy.options.data.limit=j.pageSize},loaded:function(j,i){if(j.data.totalRows===0){f.uiPaginationLabel.text(h.texts.showNoItem);f.uiNbResult.text(h.texts.showNoItem)}else{if(j.data.totalRows===1){f.uiPaginationLabel.text(h.texts.showOneItem);f.uiNbResult.text("1 "+h.texts.item)}else{f.uiPaginationLabel.text(h.texts.showNbItems.replace("{{x}}",j.data.length).replace("{{y}}",j.data.totalRows));f.uiNbResult.text(j.data.totalRows+" "+h.texts.items)}}f.uiNbResult.show();f.uiResetSearch[f.uiInspectorsTags.find(".nos-appdesk-inspectorstag").length||f.uiSearchInput.val()?"show":"hide"]()},rendered:function(){f.uiSplitterHorizontalBottom.find(".wijmo-wijpager").prepend(f.uiPaginationLabel);if(f.itemSelected!==null){var i=false;a.each(f.uiThumbnail.thumbnailsgrid("data")||[],function(j,k){if(k._model==f.itemSelected._model&&k._id==f.itemSelected._id){i=true;if(!f.uiThumbnail.thumbnailsgrid("select",j)){f.itemSelected=null}}});if(!i){f.uiThumbnail.thumbnailsgrid("unselect")}}},reader:{read:function(j){var i=parseInt(j.data.total,10);j.data=j.data.items;j.data.totalRows=i}},pageIndexChanging:function(){f.itemSelected=null;f.element.trigger("selectionChanged.appdesk",false)},selectionChanged:function(j,i){if(!i||a.isEmptyObject(i)){f.itemSelected=null;f.element.trigger("selectionChanged.appdesk",false)}else{f.itemSelected=a.extend({},i.item.data.noParseData);f.element.trigger("selectionChanged.appdesk",i.item.data.noParseData)}}},h.thumbnails));return f},_jsonInspectors:function(){var d=this,e=a.extend({},this.options.values||{});d.uiInspectorsTags.find("input").add(d.uiSearchInput).each(function(){var g=a(this),h=g.attr("name"),f=false;if(h.substr(-2,2)==="[]"){h=h.substr(0,h.length-2);f=true}if(!f){e[h]=g.val()}else{if(!a.isArray(e[h])){e[h]=[];e[h].push(g.val())}else{if(-1==a.inArray(g.val(),e[h])){e[h].push(g.val())}}}});return e},_resizeInspectorsV:function(e){var d=this;if(d.resizing){var f=d.uiInspectorsVertical.find(".wijmo-wijsplitter-v-bar").css({width:null,borderRightWidth:null}).end().find("> li").css({width:"100%",height:"auto"});if(f.length){f.css("height",(d.uiInspectorsVertical.height()/f.length)+"px").trigger(e?"widgetReload":"widgetResize")}else{d._hideSplitterV()}}return d},_resizeInspectorsH:function(e){var d=this;if(d.resizing){var f=d.uiInspectorsHorizontal.find(".wijmo-wijsplitter-h-bar").css({height:null,borderTopWidth:null}).end().find("> li").css({width:"auto",height:"100%"});if(f.length){f.css("width",(d.uiInspectorsHorizontal.width()/f.length)+"px").trigger(e?"widgetReload":"widgetResize")}else{d._hideSplitterH()}}d.uiSplitterVertical.wijsplitter("option","splitterDistance");d._trigger("slidersChange",null,d.slidersSettings());return d},_resizeList:function(f){var e=this,h=e.options;if(e.init){var d=e.uiSplitterHorizontalBottom.height()-e.uiSearchBar.outerHeight(true);if(h.defaultView==="thumbnails"){if(f){e._uiList()}else{e.uiThumbnail.thumbnailsgrid("setSize",e.uiSplitterHorizontalBottom.width(),d)}}else{if(h.defaultView==="treeGrid"){if(f){e._uiList()}else{e.uiTreeGrid.nostreegrid("setSize",null,d)}}else{e.uiGrid.noslistgrid("setSize",null,d);if(f){var g=c.grid.getHeights();e.uiGrid.noslistgrid("option","pageSize",Math.floor((d-g.footer-g.header-(e.showFilter?g.filter:0))/g.row))}}}}return e},_hideSplitterV:function(){var d=this;d.uiSplitterVertical.find(".wijmo-wijsplitter-v-bar").css({width:"0px",borderRightWidth:"0px"}).end().wijsplitter("option","panel1",{collapsed:true}).wijsplitter("refresh",true,false);return d},_hideSplitterH:function(){var d=this;d.uiSplitterHorizontal.find(".wijmo-wijsplitter-h-bar").css({height:"0px",borderTopWidth:"0px"}).end().wijsplitter("option","panel1",{collapsed:true}).wijsplitter("refresh",true,false);return d},gridReload:function(){var d=this,e=d.options;if(d.init){if(e.defaultView==="thumbnails"){d._uiList()}else{if(e.defaultView==="treeGrid"){d._uiList()}else{d.uiGrid.noslistgrid("ensureControl",true)}}}return d},resize:function(){var d=this,e=d.options;d.uiSplitterVertical.wijsplitter("refresh",true,false);d.uiSplitterHorizontal.wijsplitter("refresh",true,false);d._resizeInspectorsV()._resizeInspectorsH()._resizeList();return d},slidersSettings:function(){return{vertical:{splitterDistance:this.uiSplitterVertical.wijsplitter("option","splitterDistance")/a(window).width()},horizontal:{splitterDistance:this.uiSplitterHorizontal.wijsplitter("option","splitterDistance")/a(window).height()}}}});c.extend({appdeskAdd:function(h,f){var e=this;var g=false;var d="";if(f.selectedView=="custom"){if(f.custom){d=f.views[f.custom.from].json;g=true}else{f.selectedView="default"}}if(f.selectedView!="custom"){d=f.views[f.selectedView].json}require(d,function(){var j=c.appdeskSetup(f);a.extend(true,j.i18nMessages,f.i18n);for(var k=0;k<arguments.length;k++){a.extend(true,j,arguments[k](j))}a.extend(true,j.appdesk,{locales:f.locales,hideLocales:f.hideLocales,views:f.views,name:f.configuration_id,selectedView:f.selectedView,selectedLang:f.selectedLang});if(g){a.extend(true,j.appdesk,{fromView:f.custom.from},f.custom.appdesk)}var m,p=a("div#"+h),l=p.closest(".nos-dispatcher"),o=j.build();if(a.isPlainObject(o.tab)&&!a.isEmptyObject(o.tab)){try{c(p).tab("update",o.tab)}catch(n){log("Could not update current tab. Maybe your config file should not try to update it.")}}p.removeAttr("id").appdesk(o.appdesk);l.on({resizePanel:function(){if(m){window.clearTimeout(m)}m=window.setTimeout(function(){p.appdesk("resize")},200)},showPanel:function(){p.appdesk("resize")}});if(o.reloadEvent){l.on("reload."+o.reloadEvent,function(){p.appdesk("gridReload")})}p.bind("reloadView",function(r,q){a.extend(f,q);var i=a('<div id="'+h+'"></div>');i.insertAfter(p);p.remove();e.appdeskAdd(h,f)})})},appdeskSetup:function(h){var f={},e=function(k,j){k.setupkey=j;return k},d=function(k,m){if(k[m+"Order"]){var n=k[m+"Order"].split(",");var j=[];for(var l=0;l<n.length;l++){if(k[m][n[l]]!=null){k[m][n[l]]["setupkey"]=n[l];j.push(k[m][n[l]])}}return j}else{return a.map(k[m],e)}},g=function(i){a.each(i,function(l,o){if(a.isPlainObject(o)){if(a.isFunction(o._)){i[l]=o._()}else{g(o)}}else{if(a.isArray(o)){g(o)}}if(l==="columns"){i[l]=d(i,l);for(var k=0;k<i[l].length;k++){if(i[l][k].lang){if(h.hideLocales){i[l].splice(k,1);continue}i[l][k]={headerText:"Languages",dataKey:"lang",setupkey:"lang",showFilter:false,cellFormatter:function(p){if(p.row.type&a.wijmo.wijgrid.rowType.data){p.$container.css("text-align","center").html(p.row.data.lang);return true}},width:1}}if(i[l][k].actions){var n=i[l][k].actions;var m;var j=i[l][k].showOnlyArrow?true:false;if(j){m=20}else{m=c.grid.getActionWidth(n);if(n.length>1){}}i[l][k]={headerText:j?"":"",cellFormatter:function(p){if(a.isPlainObject(p.row.data)){var q=c.appdeskActions(n,p.row.data,{showOnlyArrow:j});q.appendTo(p.$container);p.$container.parent().addClass("buttontd").css({width:m+1});return true}},allowSizing:false,allowSort:false,width:m,ensurePxWidth:true,showFilter:false,setupkey:"actions"}}}}})},f={tab:null,appdesk:{adds:{},grid:{proxyUrl:"",columns:{}},thumbnails:null,defaultView:"grid",inspectors:{},splittersVertical:null,splittersHorizontal:null},i18nMessages:{},i18n:function(j){var k={};var i=this;a.extend(k,{label:j,_:function(){return i.i18nMessages[k.label]||k.label}});return k},build:function(){var l=a.extend(true,{appdesk:{texts:this.i18nMessages,splitters:{},slidersChange:function(i,m){}}},this);if(l.appdesk.splittersVertical){l.appdesk.splitters.vertical={splitterDistance:l.appdesk.splittersVertical}}if(l.appdesk.splittersHorizontal){l.appdesk.splitters.horizontal={splitterDistance:l.appdesk.splittersHorizontal}}l.appdesk.adds=a.map(l.appdesk.adds,e);l.appdesk.inspectors=d(l.appdesk,"inspectors");if(l.actions){var j=l.actions;if(l.appdesk.grid.columns.actions&&l.appdesk.grid.columns.actions.actions){a.each(l.appdesk.grid.columns.actions.actions,function(m,n){if(a.type(n)=="string"){l.appdesk.grid.columns.actions.actions[m]=j[n]}})}if(l.appdesk.thumbnails&&l.appdesk.thumbnails.actions){a.each(l.appdesk.thumbnails.actions,function(m,n){if(a.type(n)=="string"){l.appdesk.thumbnails.actions[m]=j[n]}})}a.each(l.appdesk.inspectors,function(m,n){if(n.preview&&n.options.actions){a.each(n.options.actions,function(o,p){if(a.type(p)=="string"){n.options.actions[o]=j[p]}})}})}g(l);for(var k=0;k<l.appdesk.inspectors.length;k++){if(l.appdesk.inspectors[k].preview){l.appdesk.inspectors[k].url=function(n){var i=n.data("inspector"),m=a("<div></div>").appendTo(n).preview(i.options).parent().on({widgetResize:function(){m.preview("resize")}}).end()}}}return l}};return f},appdeskActionsList:[],appdeskActions:function(j,i,g){g=g||{};var d=a("<table><tr></tr></table>").addClass("buttontd wijgridtd");var f=[];var e=[];if(!g.showOnlyArrow){a.each(j,function(){if(this.primary){f.push(this)}else{e.push(this)}});if(e.length==1&&(e[0].icon||e[0].iconClasses)){f.push(e[0])}a.each(f,function(l,n){var k=false;if(n.iconClasses){k=n.iconClasses}else{if(n.icon){k="ui-icon ui-icon-"+n.icon}}var m=a("<th></th>").css("white-space","nowrap").addClass("ui-state-default").attr("title",n.label).html((k?'<span class="'+k+'"></span>':"")+(n.text||!k?"&nbsp;"+n.label+"&nbsp;":""));if(n.name&&i&&i.actions&&i.actions[n.name]==false){m.addClass("ui-state-disabled").click(function(o){o.stopImmediatePropagation();o.preventDefault()})}else{m.click(function(o){o.stopImmediatePropagation();o.preventDefault();n.action.apply(this,[i,m])}).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")})}if(k&&!n.text){m.css({width:20,textAlign:"center"}).children().css({margin:"auto"})}else{if(k&&n.text){m.find("span").css("float","left")}}m.appendTo(d.find("tr"))})}if(g.showOnlyArrow||e.length>=2||(e.length==1&&!(e[0].icon||e[0].iconClasses))){var h=a("<th></th>").addClass("ui-state-default").css({width:"20px"}).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});a("<span></span>").addClass("ui-icon ui-icon-triangle-1-s").appendTo(h);h.appendTo(d.find("tr")).click(function(m){a.each(c.appdeskActionsList,function(){a(this).wijmenu("hideAllMenus")});if(!this.created){var l=a("<ul></ul>");a.each(j,function(p,q){var o;if(q.iconClasses){o=q.iconClasses}else{if(q.icon){o="ui-icon ui-icon-"+q.icon}}var r='<span class="'+(o?o:"nos-icon16 nos-icon16-empty")+' wijmo-wijmenu-icon-left"></span><span class="wijmo-wijmenu-text">'+q.label+"</span>";var n=a('<li><a href="#"></a></li>').appendTo(l).find("a").html(r);if(q.name&&i.actions&&i.actions[q.name]==false){n.addClass("ui-state-disabled").click(function(s){s.stopImmediatePropagation();s.preventDefault()})}else{n.click(function(s){s.stopImmediatePropagation();s.preventDefault();l.wijmenu("hideAllMenus");q.action.apply(this,[i,n])})}});var k=h.closest(".ui-dialog-content, .nos-dispatcher, body");l.appendTo(k);l.wijmenu({trigger:h,triggerEvent:"click",orientation:"vertical",showAnimation:{Animated:"slide",duration:50,easing:null},hideAnimation:{Animated:"hide",duration:0,easing:null},position:{my:"right top",at:"right bottom",collision:"flip",offset:"0 0"}});c.appdeskActionsList.push(l);this.created=true;h.triggerHandler("click")}});h.click(false)}return d},grid:{getHeights:function(){if(this.heights===b){var d=a("<div></div>").appendTo("body");var e=a("<table></table>").addClass("nos-appdesk").appendTo(d).noslistgrid({scrollMode:"auto",showFilter:true,allowPaging:true,data:[["test"]]});this.heights={row:e.height(),footer:d.find(".wijmo-wijgrid-footer").outerHeight(),header:d.find(".wijmo-wijgrid-headerrow").outerHeight(),filter:d.find(".wijmo-wijgrid-filterrow").outerHeight()};e.noslistgrid("destroy");d.remove()}return this.heights},getActionWidth:function(g){var d=a("<div></div>").appendTo("body");var f=a("<table></table>").addClass("nos-appdesk").appendTo(d).noslistgrid({scrollMode:"none",showFilter:true,allowPaging:true,columns:[{headerText:"Actions",cellFormatter:function(h){if(a.isPlainObject(h.row.data)){var i=c.appdeskActions(g,[]);i.appendTo(h.$container);h.$container.parent().addClass("buttontd");return true}},allowSizing:true,showFilter:false,ensurePxWidth:true}],data:[{key:"value"}]});d.find("table.buttontd.wijgridtd").css({"font-size":"1.05em",width:"auto"});var e=d.find(".buttontd .buttontd:first").outerWidth();f.noslistgrid("destroy");d.remove();return e}}});return c});
